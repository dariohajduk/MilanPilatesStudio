(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{6743:(e,t,n)=>{"use strict";n.d(t,{FA:()=>S,Fy:()=>w,Ku:()=>D,T9:()=>y,Uj:()=>u,ZQ:()=>b,bD:()=>function e(t,n){if(t===n)return!0;let r=Object.keys(t),i=Object.keys(n);for(let s of r){if(!i.includes(s))return!1;let r=t[s],a=n[s];if(C(r)&&C(a)){if(!e(r,a))return!1}else if(r!==a)return!1}for(let e of i)if(!r.includes(e))return!1;return!0},cY:()=>v,eX:()=>T,g:()=>x,nr:()=>I,yU:()=>p,zW:()=>E});var r=n(7836);let i=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},s=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,h=(3&i)<<4|a>>4,c=(15&a)<<2|l>>6,f=63&l;o||(f=64,s||(c=64)),r.push(n[u],n[h],n[c],n[f])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):s(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,l=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==l)throw new o;let u=i<<2|s>>4;if(r.push(u),64!==a){let e=s<<4&240|a>>2;if(r.push(e),64!==l){let e=a<<6&192|l;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let l=function(e){let t=i(e);return a.encodeByteArray(t,!0)},u=function(e){return l(e).replace(/\./g,"")},h=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},c=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,f=()=>{if(void 0===r||void 0===r.env)return;let e=r.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},d=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&h(e[1]);return t&&JSON.parse(t)},g=()=>{try{return c()||f()||d()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},m=e=>{var t,n;return null===(n=null===(t=g())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},p=e=>{let t=m(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},y=()=>{var e;return null===(e=g())||void 0===e?void 0:e.config};class v{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function w(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(s)),""].join(".")}function b(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function I(){return!function(){var e;let t=null===(e=g())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function E(){try{return"object"==typeof indexedDB}catch(e){return!1}}function T(){return new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}class x extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,x.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,S.prototype.create)}}class S{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?i.replace(_,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`}):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new x(r,a,n)}}let _=/\{\$([^}]+)}/g;function C(e){return null!==e&&"object"==typeof e}function D(e){return e&&e._delegate?e._delegate:e}},9847:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var r=n(8916),i=n(9416);n(3683);var s=n(4848);function a({Component:e,pageProps:t}){return(0,s.jsx)(i.v,{children:(0,s.jsx)(r.V,{children:(0,s.jsx)(e,{...t})})})}},8916:(e,t,n)=>{"use strict";n.d(t,{V:()=>a,x:()=>o});var r=n(6540),i=n(4848);let s=(0,r.createContext)(null),a=({children:e})=>{let[t,n]=(0,r.useState)("https://your-default-logo-url.com/logo.png");return(0,i.jsx)(s.Provider,{value:{logoUrl:t,setLogoUrl:n},children:e})},o=()=>{let e=(0,r.useContext)(s);if(!e)throw Error("useLogo must be used within a LogoProvider");return e}},9416:(e,t,n)=>{"use strict";n.d(t,{J:()=>u,v:()=>l});var r=n(6540),i=n(2942),s=n(6430),a=n(4848);let o=(0,r.createContext)(),l=({children:e})=>{let[t,n]=(0,r.useState)(null),[l,u]=(0,r.useState)(!1),h=async e=>{try{let t=(0,s.H9)(i.db,"Users",e.phone),r=await (0,s.x7)(t);if(r.exists()){let t=r.data();n({...t,phone:e.phone,isAdmin:!!t.isAdmin}),u(!0)}else console.error("User not found in Firebase")}catch(e){console.error("Error fetching user data from Firebase:",e)}},c=async e=>{if(!e){console.error("Cannot refresh user data: phone is undefined");return}try{let t=(0,s.H9)(i.db,"Users",e),r=await (0,s.x7)(t);if(r.exists()){let t=r.data();n({...t,phone:e})}else console.error("User not found in Firebase")}catch(e){console.error("Error refreshing user data:",e)}};return(0,a.jsx)(o.Provider,{value:{userData:t,isLoggedIn:l,updateUserData:h,refreshUserData:c,logout:()=>{n(null),u(!1)}},children:e})},u=()=>(0,r.useContext)(o)},2942:(e,t,n)=>{"use strict";n.d(t,{db:()=>H});var r,i,s=n(9928);(0,s.KO)("firebase","9.23.0","app");var a=n(6430),o=n(6743),l=n(5125);let u="firebasestorage.googleapis.com";class h extends o.g{constructor(e,t,n=0){super(c(e),`Firebase Storage: ${t} (${c(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,h.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return c(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function c(e){return"storage/"+e}function f(){return new h(r.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function d(e){return new h(r.INVALID_ARGUMENT,e)}function g(){return new h(r.APP_DELETED,"The Firebase app was deleted.")}function m(e,t){return new h(r.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(r||(r={}));class p{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=p.makeFromUrl(e,t)}catch(t){return new p(e,"")}if(""===n.path)return n;throw new h(r.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null,i="([A-Za-z0-9.\\-_]+)",s=RegExp("^gs://"+i+"(/(.*))?$","i");function a(e){e.path_=decodeURIComponent(e.path)}let o=t.replace(/[.]/g,"\\."),l=RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${i}/o(/([^?#]*).*)?$`,"i"),c=t===u?"(?:storage.googleapis.com|storage.cloud.google.com)":t,f=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:l,indices:{bucket:1,path:3},postModify:a},{regex:RegExp(`^https?://${c}/${i}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:a}];for(let t=0;t<f.length;t++){let r=f[t],i=r.regex.exec(e);if(i){let e=i[r.indices.bucket],t=i[r.indices.path];t||(t=""),n=new p(e,t),r.postModify(n);break}}if(null==n)throw new h(r.INVALID_URL,"Invalid URL '"+e+"'.");return n}}class y{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function v(e){return"string"==typeof e||e instanceof String}function w(e){return b()&&e instanceof Blob}function b(){return"undefined"!=typeof Blob&&!isNode()}function I(e,t,n,r){if(r<t)throw d(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw d(`Invalid value for '${e}'. Expected ${n} or less.`)}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(i||(i={}));class E{constructor(e,t,n,r,i,s,a,o,l,u,h,c=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=c,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{let n=this.resolve_,i=this.reject_,s=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(s,s.getResponse());void 0!==e?n(e):n()}catch(e){i(e)}else if(null!==s){let e=f();e.serverResponse=s.getErrorText(),i(this.errorCallback_?this.errorCallback_(s,e):e)}else i(t.canceled?this.appDelete_?g():new h(r.CANCELED,"User canceled the upload/download."):new h(r.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(!1,new T(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,a=!1,o=0,l=!1;function u(...e){l||(l=!0,t.apply(null,e))}function h(t){i=setTimeout(()=>{i=null,e(f,2===o)},t)}function c(){s&&clearTimeout(s)}function f(e,...t){let n;if(l){c();return}if(e||2===o||a){c(),u.call(null,e,...t);return}r<64&&(r*=2),1===o?(o=2,n=0):n=(r+Math.random())*1e3,h(n)}let d=!1;function g(e){!d&&(d=!0,c(),!l&&(null!==i?(e||(o=2),clearTimeout(i),h(0)):e||(o=1)))}return h(0),s=setTimeout(()=>{a=!0,g(!0)},n),g}((e,t)=>{if(t){e(!1,new T(!1,null,!0));return}let n=this.connectionFactory_();this.pendingConnection_=n;let r=e=>{let t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;let t=n.getErrorCode()===i.NO_ERROR,s=n.getStatus();if(!t||function(e,t){let n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return n||r||i}(s,this.additionalRetryCodes_)&&this.retry){e(!1,new T(!1,null,n.getErrorCode()===i.ABORT));return}e(!0,new T(-1!==this.successCodes_.indexOf(s),n))})},e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class T{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function x(...e){let t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){let n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(b())return new Blob(e);throw new h(r.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}let S={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class _{constructor(e,t){this.data=e,this.contentType=t||null}}function C(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):(64512&r)==55296?n<e.length-1&&(64512&e.charCodeAt(n+1))==56320?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):(64512&r)==56320?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function D(e,t){let n;switch(e){case S.BASE64:{let n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw m(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case S.BASE64URL:{let n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw m(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}}try{n=function(e){if("undefined"==typeof atob)throw new h(r.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw m(e,"Invalid character found")}let i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return i}class A{constructor(e){this.base64=!1,this.contentType=null;let t=e.match(/^data:([^,]+)?,/);if(null===t)throw m(S.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let n=t[1]||null;null!=n&&(this.base64=function(e,t){return e.length>=t.length&&e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class N{constructor(e,t){let n=0,r="";w(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(!w(this.data_))return new N(new Uint8Array(this.data_.buffer,e,t-e),!0);{var n;let r=(n=this.data_).webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null;return null===r?null:new N(r)}}static getBlob(...e){if(b()){let t=e.map(e=>e instanceof N?e.data_:e);return new N(x.apply(null,t))}{let t=e.map(e=>v(e)?function(e,t){switch(e){case S.RAW:return new _(C(t));case S.BASE64:case S.BASE64URL:return new _(D(e,t));case S.DATA_URL:return new _(function(e){let t=new A(e);return t.base64?D(S.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw m(S.DATA_URL,"Malformed data URL.")}return C(t)}(t.rest)}(t),new A(t).contentType)}throw f()}(S.RAW,e).data:e.data_),n=0;t.forEach(e=>{n+=e.byteLength});let r=new Uint8Array(n),i=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]}),new N(r,!0)}}uploadData(){return this.data_}}function k(e){let t=e.lastIndexOf("/",e.length-2);return -1===t?e:e.slice(t+1)}function R(e,t){return t}class O{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||R}}let M=null;class L{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function P(e){if(!e)throw f()}function F(e){return function(t,n){var i,s;let a;return 401===t.getStatus()?a=t.getErrorText().includes("Firebase App Check token is invalid")?new h(r.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new h(r.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,a=new h(r.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,a=new h(r.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):a=n,a.status=t.getStatus(),a.serverResponse=n.serverResponse,a}}let V={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};class U extends null{initXhr(){this.xhr_.responseType="text"}}class B{constructor(e,t){this._service=e,t instanceof p?this._location=t:this._location=p.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new B(e,t)}get root(){let e=new p(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return k(this._location.path)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new p(this._location.bucket,e);return new B(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new h(r.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function q(e,t){let n=null==t?void 0:t.storageBucket;return null==n?null:p.makeFromBucketSpec(n,e)}class j{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=u,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=r?this._bucket=p.makeFromBucketSpec(r,this._host):this._bucket=q(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=p.makeFromBucketSpec(this._url,e):this._bucket=q(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){I("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){I("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new B(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new y(g());{let s=function(e,t,n,r,i,s,a=!0){let o=function(e){let t=encodeURIComponent,n="?";for(let r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n.slice(0,-1)}(e.urlParams),l=e.url+o,u=Object.assign({},e.headers);return t&&(u["X-Firebase-GMPID"]=t),null!==n&&n.length>0&&(u.Authorization="Firebase "+n),u["X-Firebase-Storage-Version"]="webjs/"+(null!=s?s:"AppManager"),null!==r&&(u["X-Firebase-AppCheck"]=r),new E(l,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,a)}(e,this._appId,n,r,t,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}let $="@firebase/storage",K="0.11.2",z="storage";(0,s.om)(new l.uA(z,function(e,{instanceIdentifier:t}){return new j(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,s.MF)},"PUBLIC").setMultipleInstances(!0)),(0,s.KO)($,K,""),(0,s.KO)($,K,"esm2017");let G=(0,s.Wp)({apiKey:"AIzaSyBgRjJShNJqWB2nq931kKobLRHUeejW0vo",authDomain:"milan-studio-b8b4b.firebaseapp.com",databaseURL:"https://milan-studio-b8b4b-default-rtdb.europe-west1.firebasedatabase.app",projectId:"milan-studio-b8b4b",storageBucket:"milan-studio-b8b4b.firebasestorage.app",messagingSenderId:"961084768524",appId:"1:961084768524:web:2cdbc3a67dc018d8058929",measurementId:"G-8XF83E9KQY"}),H=(0,a.aU)(G);!function(e=(0,s.Sx)(),t){e=(0,o.Ku)(e);let n=(0,s.j6)(e,z).getImmediate({identifier:void 0}),r=(0,o.yU)("storage");r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";let{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:(0,o.Fy)(i,e.app.options.projectId))}(e,t,n,r)}(n,...r)}(G)},7836:(e,t,n)=>{"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(5307)},6170:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(9847)}])},3683:()=>{},5307:e=>{!function(){var t={229:function(e){var t,n,r,i=e.exports={};function s(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var l=[],u=!1,h=-1;function c(){u&&r&&(u=!1,r.length?l=r.concat(l):h=-1,l.length&&f())}function f(){if(!u){var e=o(c);u=!0;for(var t=l.length;t;){for(r=l,l=[];++h<t;)r&&r[h].run();h=-1,t=l.length}r=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new d(e,t)),1!==l.length||u||o(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}},a=!0;try{t[e](s,s.exports,r),a=!1}finally{a&&delete n[e]}return s.exports}r.ab="//";var i=r(229);e.exports=i}()},9928:(e,t,n)=>{"use strict";let r,i;n.d(t,{MF:()=>O,j6:()=>N,om:()=>A,Sx:()=>L,Wp:()=>M,KO:()=>P});var s=n(5125),a=n(3424),o=n(6743);let l=(e,t)=>t.some(t=>e instanceof t),u=new WeakMap,h=new WeakMap,c=new WeakMap,f=new WeakMap,d=new WeakMap,g={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return h.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(m(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&u.set(t,e)}).catch(()=>{}),d.set(t,e),t}(e);if(f.has(e))return f.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),m(u.get(this))}:function(...e){return m(t.apply(p(this),e))}:function(e,...n){let r=t.call(p(this),e,...n);return c.set(r,e.sort?e.sort():[e]),m(r)}:(t instanceof IDBTransaction&&function(e){if(h.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});h.set(e,t)}(t),l(t,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,g):t;return n!==e&&(f.set(e,n),d.set(n,e)),n}let p=e=>d.get(e),y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],w=new Map;function b(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(w.get(t))return w.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||y.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&s.done]))[0]};return w.set(t,s),s}g=(e=>({...e,get:(t,n,r)=>b(t,n)||e.get(t,n,r),has:(t,n)=>!!b(t,n)||e.has(t,n)}))(g);class I{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let E="@firebase/app",T="0.9.13",x=new a.Vy("@firebase/app"),S="[DEFAULT]",_={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},C=new Map,D=new Map;function A(e){let t=e.name;if(D.has(t))return x.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(D.set(t,e),C.values()))!function(e,t){try{e.container.addComponent(t)}catch(n){x.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}(n,e);return!0}function N(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}let k=new o.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class R{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new s.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw k.create("app-deleted",{appName:this._name})}}let O="9.23.0";function M(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:S,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw k.create("bad-app-name",{appName:String(i)});if(n||(n=(0,o.T9)()),!n)throw k.create("no-options");let a=C.get(i);if(a){if((0,o.bD)(n,a.options)&&(0,o.bD)(r,a.config))return a;throw k.create("duplicate-app",{appName:i})}let l=new s.h1(i);for(let e of D.values())l.addComponent(e);let u=new R(n,r,l);return C.set(i,u),u}function L(e=S){let t=C.get(e);if(!t&&e===S&&(0,o.T9)())return M();if(!t)throw k.create("no-app",{appName:e});return t}function P(e,t,n){var r;let i=null!==(r=_[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);let a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){let e=[`Unable to register library "${i}" with version "${t}":`];a&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),x.warn(e.join(" "));return}A(new s.uA(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let F="firebase-heartbeat-store",V=null;function U(){return V||(V=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=m(a);return r&&a.addEventListener("upgradeneeded",e=>{r(m(a.result),e.oldVersion,e.newVersion,m(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{0===t&&e.createObjectStore(F)}}).catch(e=>{throw k.create("idb-open",{originalErrorMessage:e.message})})),V}async function B(e){try{let t=await U();return await t.transaction(F).objectStore(F).get(j(e))}catch(e){if(e instanceof o.g)x.warn(e.message);else{let t=k.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});x.warn(t.message)}}}async function q(e,t){try{let n=(await U()).transaction(F,"readwrite"),r=n.objectStore(F);await r.put(t,j(e)),await n.done}catch(e){if(e instanceof o.g)x.warn(e.message);else{let t=k.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});x.warn(t.message)}}}function j(e){return`${e.name}!${e.options.appId}`}class ${constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new z(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=K();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))?void 0:(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let e=K(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),G(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),G(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=(0,o.Uj)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function K(){return new Date().toISOString().substring(0,10)}class z{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.zW)()&&(0,o.eX)().then(()=>!0).catch(()=>!1)}async read(){return await this._canUseIndexedDBPromise&&await B(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return q(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return q(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function G(e){return(0,o.Uj)(JSON.stringify({version:2,heartbeats:e})).length}A(new s.uA("platform-logger",e=>new I(e),"PRIVATE")),A(new s.uA("heartbeat",e=>new $(e),"PRIVATE")),P(E,T,""),P(E,T,"esm2017"),P("fire-js","")},5125:(e,t,n)=>{"use strict";n.d(t,{h1:()=>o,uA:()=>i});var r=n(6743);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;let r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);let s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:e===s?void 0:e,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3424:(e,t,n)=>{"use strict";var r;n.d(t,{$b:()=>r,Vy:()=>u});let i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));let s={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},a=r.INFO,o={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=o[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class u{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}},6430:(e,t,n)=>{"use strict";n.d(t,{gS:()=>cb,C3:()=>cT,hq:()=>cE,rJ:()=>hE,kd:()=>cw,H9:()=>hT,x7:()=>cg,GG:()=>cp,aU:()=>h_,BN:()=>cy,mZ:()=>cv});var r,i,s,a,o,l,u,h=n(9928),c=n(5125),f=n(3424),d=n(6743),g={},m=m||{},p=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{})||self;function y(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function v(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function w(e,t,n){return e.call.apply(e.bind,arguments)}function b(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function I(e,t,n){return(I=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:b).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function T(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function x(){this.s=this.s,this.o=this.o}x.prototype.s=!1,x.prototype.sa=function(){this.s||(this.s=!0,this.N())},x.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let S=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return -1};function _(e){let t=e.length;if(0<t){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function C(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(y(n)){let t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function D(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}D.prototype.h=function(){this.defaultPrevented=!0};var A=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{p.addEventListener("test",()=>{},t),p.removeEventListener("test",()=>{},t)}catch(e){}return e}();function N(e){return/^[\s\xa0]*$/.test(e)}function k(){var e=p.navigator;return e&&(e=e.userAgent)?e:""}function R(e){return -1!=k().indexOf(e)}function O(e){return O[" "](e),e}O[" "]=function(){};var M=R("Opera"),L=R("Trident")||R("MSIE"),P=R("Edge"),F=P||L,V=R("Gecko")&&!(-1!=k().toLowerCase().indexOf("webkit")&&!R("Edge"))&&!(R("Trident")||R("MSIE"))&&!R("Edge"),U=-1!=k().toLowerCase().indexOf("webkit")&&!R("Edge");function B(){var e=p.document;return e?e.documentMode:void 0}e:{var q="",j=function(){var e=k();return V?/rv:([^\);]+)(\)|;)/.exec(e):P?/Edge\/([\d\.]+)/.exec(e):L?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):U?/WebKit\/(\S+)/.exec(e):M?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(j&&(q=j?j[1]:""),L){var $=B();if(null!=$&&$>parseFloat(q)){i=String($);break e}}i=q}var K=p.document&&L&&(B()||parseInt(i,10))||void 0;function z(e,t){if(D.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(V){e:{try{O(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:G[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&z.$.h.call(this)}}T(z,D);var G={2:"touch",3:"pen",4:"mouse"};z.prototype.h=function(){z.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),Q=0;function W(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=i,this.key=++Q,this.fa=this.ia=!1}function X(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function Y(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function J(e){let t={};for(let n in e)t[n]=e[n];return t}let Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ee(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<Z.length;t++)n=Z[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function et(e){this.src=e,this.g={},this.h=0}function en(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=S(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(X(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function er(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.fa&&s.listener==t&&!!n==s.capture&&s.la==r)return i}return -1}et.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=er(e,t,r,i);return -1<a?(t=e[a],n||(t.ia=!1)):((t=new W(t,this.src,s,!!r,i)).ia=n,e.push(t)),t};var ei="closure_lm_"+(1e6*Math.random()|0),es={};function ea(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=v(i)?!!i.capture:!!i,o=eh(e);if(o||(e[ei]=o=new et(e)),(n=o.add(t,n,r,a,s)).proxy)return n;if(r=function e(t){return eu.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)A||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(el(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function eo(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[H])en(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(el(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=eh(t))?(en(n,e),0==n.h&&(n.src=null,t[ei]=null)):X(e)}}}function el(e){return e in es?es[e]:es[e]="on"+e}function eu(e,t){if(e.fa)e=!0;else{t=new z(t,this);var n=e.listener,r=e.la||e.src;e.ia&&eo(e),e=n.call(r,t)}return e}function eh(e){return(e=e[ei])instanceof et?e:null}var ec="__closure_events_fn_"+(1e9*Math.random()>>>0);function ef(e){return"function"==typeof e?e:(e[ec]||(e[ec]=function(t){return e.handleEvent(t)}),e[ec])}function ed(){x.call(this),this.i=new et(this),this.S=this,this.J=null}function eg(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new D(t,e);else if(t instanceof D)t.target=t.target||e;else{var i=t;ee(t=new D(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=em(a,r,!0,t)&&i}if(i=em(a=t.g=e,r,!0,t)&&i,i=em(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=em(a=t.g=n[s],r,!1,t)&&i}function em(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.fa&&a.capture==n){var o=a.listener,l=a.la||a.src;a.ia&&en(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}T(ed,x),ed.prototype[H]=!0,ed.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);else(i=v(i)?!!i.capture:!!i,r=ef(r),t&&t[H])?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=er(a=t.g[n],r,i,s))&&(X(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=eh(t))&&(n=t.g[n.toString()],t=-1,n&&(t=er(n,r,i,s)),(r=-1<t?n[t]:null)&&eo(r))}(this,e,t,n,r)},ed.prototype.N=function(){if(ed.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)X(n[r]);delete t.g[e],t.h--}}this.J=null},ed.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ed.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var ep=p.JSON.stringify;class ey{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}class ev{constructor(){this.h=this.g=null}add(e,t){let n=ew.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var ew=new ey(()=>new eb,e=>e.reset());class eb{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let eI,eE=!1,eT=new ev,ex=()=>{let e=p.Promise.resolve(void 0);eI=()=>{e.then(eS)}};var eS=()=>{for(var e;e=function(){let e=null;return eT.g&&(e=eT.g,eT.g=eT.g.next,eT.g||(eT.h=null),e.next=null),e}();){try{e.h.call(e.g)}catch(e){!function(e){p.setTimeout(()=>{throw e},0)}(e)}ew.j(e),100>ew.h&&(ew.h++,e.next=ew.g,ew.g=e)}eE=!1};function e_(e,t){ed.call(this),this.h=e||1,this.g=t||p,this.j=I(this.qb,this),this.l=Date.now()}function eC(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function eD(e,t,n){if("function"==typeof e)n&&(e=I(e,n));else if(e&&"function"==typeof e.handleEvent)e=I(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:p.setTimeout(e,t||0)}T(e_,ed),(u=e_.prototype).ga=!1,u.T=null,u.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),eg(this,"tick"),this.ga&&(eC(this),this.start()))}},u.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},u.N=function(){e_.$.N.call(this),eC(this),delete this.g};class eA extends x{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eD(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(p.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eN(e){x.call(this),this.h=e,this.g={}}T(eN,x);var ek=[];function eR(e,t,n,r){Array.isArray(n)||(n&&(ek[0]=n.toString()),n=ek);for(var i=0;i<n.length;i++){var s=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ef(r),t&&t[H]?t.P(n,r,v(i)?!!i.capture:!!i,s):ea(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],r,i,s);return null}return r=ef(r),t&&t[H]?t.O(n,r,v(i)?!!i.capture:!!i,s):ea(t,n,r,!1,i,s)}(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function eO(e){Y(e.g,function(e,t){this.g.hasOwnProperty(t)&&eo(e)},e),e.g={}}function eM(){this.g=!0}function eL(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eN.prototype.N=function(){eN.$.N.call(this),eO(this)},eN.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},eM.prototype.Ea=function(){this.g=!1},eM.prototype.info=function(){};var eP={},eF=null;function eV(){return eF=eF||new ed}function eU(e){D.call(this,eP.Ta,e)}function eB(e){let t=eV();eg(t,new eU(t))}function eq(e,t){D.call(this,eP.STAT_EVENT,e),this.stat=t}function ej(e){let t=eV();eg(t,new eq(t,e))}function e$(e,t){D.call(this,eP.Ua,e),this.size=t}function eK(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){e()},t)}eP.Ta="serverreachability",T(eU,D),eP.STAT_EVENT="statevent",T(eq,D),eP.Ua="timingevent",T(e$,D);var ez={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},eG={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function eH(){}function eQ(e){return e.h||(e.h=e.i())}function eW(){}eH.prototype.h=null;var eX={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function eY(){D.call(this,"d")}function eJ(){D.call(this,"c")}function eZ(){}function e0(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new eN(this),this.P=e2,e=F?125:void 0,this.V=new e_(e),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new e1}function e1(){this.i=null,this.g="",this.h=!1}T(eY,D),T(eJ,D),T(eZ,eH),eZ.prototype.g=function(){return new XMLHttpRequest},eZ.prototype.i=function(){return{}},a=new eZ;var e2=45e3,e6={},e4={};function e3(e,t,n){e.L=1,e.v=td(tl(t)),e.s=n,e.S=!0,e5(e,null)}function e5(e,t){e.G=Date.now(),e7(e),e.A=tl(e.v);var n=e.A,r=e.W;Array.isArray(r)||(r=[String(r)]),t_(n.i,"t",r),e.C=0,n=e.l.J,e.h=new e1,e.g=nm(e.l,n?t:null,!e.s),0<e.O&&(e.M=new eA(I(e.Pa,e,e.g),e.O)),eR(e.U,e.g,"readystatechange",e.nb),t=e.I?J(e.I):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.A,e.u,e.s,t)):(e.u="GET",e.g.ha(e.A,e.u,null,t)),eB(),function(e,t,n,r,i,s){e.info(function(){if(e.g){if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var h=u[0];u=u[1];var c=h.split("_");a=2<=c.length&&"type"==c[1]?a+(h+"=")+u+"&":a+(h+"=redacted&")}}else a=null}else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}(e.j,e.u,e.A,e.m,e.W,e.s)}function e8(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.l.Ha}function e9(e,t,n){let r=!0,i;for(;!e.J&&e.C<n.length;)if((i=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?e4:isNaN(n=Number(t.substring(n,r)))?e6:(r+=1)+n>t.length?e4:(t=t.slice(r,r+n),e.C=r+n,t)}(e,n))==e4){4==t&&(e.o=4,ej(14),r=!1),eL(e.j,e.m,null,"[Incomplete Response]");break}else if(i==e6){e.o=4,ej(15),eL(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else eL(e.j,e.m,i,null),ti(e,i);e8(e)&&i!=e4&&i!=e6&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,ej(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),no(t),t.M=!0,ej(11))):(eL(e.j,e.m,n,"[Invalid Chunked Response]"),tr(e),tn(e))}function e7(e){e.Y=Date.now()+e.P,te(e,e.P)}function te(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eK(I(e.lb,e),t)}function tt(e){e.B&&(p.clearTimeout(e.B),e.B=null)}function tn(e){0==e.l.H||e.J||nh(e.l,e)}function tr(e){tt(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,eC(e.V),eO(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function ti(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||tO(n.i,e))){if(!e.K&&tO(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(n.g.G+3e3<e.G)nu(n),t7(n);else break e}na(n),ej(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=eK(I(n.ib,n),6e3));if(1>=tR(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else nf(n,11)}else if((e.K||n.g==e)&&nu(n),!N(t))for(i=n.Ja.g.parse(t),t=0;t<i.length;t++){let o=i[t];if(n.V=o[0],o=o[1],2==n.H){if("c"==o[0]){n.K=o[1],n.pa=o[2];let t=o[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));let i=o[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;let u=e.g;if(u){let e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(tM(s,s.h),s.h=null))}if(r.F){let e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,tf(r.I,r.F,e))}}if(n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms")),(r=n).wa=ng(r,r.J?r.pa:null,r.Y),e.K){tL(r.i,e);var a=r.L;a&&e.setTimeout(a),e.B&&(tt(e),e7(e)),r.g=e}else ns(r);0<n.j.length&&nt(n)}else"stop"!=o[0]&&"close"!=o[0]||nf(n,7)}else 3==n.H&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?nf(n,7):t9(n):"noop"!=o[0]&&n.h&&n.h.Aa(o),n.A=0)}}eB(4)}catch(e){}}function ts(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(y(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(y(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(y(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}(u=e0.prototype).setTimeout=function(e){this.P=e},u.nb=function(e){e=e.target;let t=this.M;t&&3==t2(e)?t.l():this.Pa(e)},u.Pa=function(e){try{if(e==this.g)e:{let h=t2(this.g);var t=this.g.Ia();let c=this.g.da();if(!(3>h)&&(3!=h||F||this.g&&(this.h.h||this.g.ja()||t6(this.g)))){this.J||4!=h||7==t||(8==t||0>=c?eB(3):eB(2)),tt(this);var n=this.g.da();this.ca=n;t:if(e8(this)){var r=t6(this.g);e="";var i=r.length,s=4==t2(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){tr(this),tn(this);var a="";break t}this.h.i=new p.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ja();if(this.i=200==n,function(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(o)){var u=o;break t}}u=null}if(n=u)eL(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ti(this,n);else{this.i=!1,this.o=3,ej(12),tr(this),tn(this);break e}}this.S?(e9(this,h,a),F&&this.i&&3==h&&(eR(this.U,this.V,"tick",this.mb),this.V.start())):(eL(this.j,this.m,a,null),ti(this,a)),4==h&&tr(this),this.i&&!this.J&&(4==h?nh(this.l,this):(this.i=!1,e7(this)))}else(function(e){let t={};e=(e.g&&2<=t2(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(N(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(let n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.o=3,ej(12)):(this.o=0,ej(13)),tr(this),tn(this)}}}catch(e){}finally{}},u.mb=function(){if(this.g){var e=t2(this.g),t=this.g.ja();this.C<t.length&&(tt(this),e9(this,e,t),this.i&&4!=e&&e7(this))}},u.cancel=function(){this.J=!0,tr(this)},u.lb=function(){this.B=null;let e=Date.now();0<=e-this.Y?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.j,this.A),2!=this.L&&(eB(),ej(17)),tr(this),this.o=2,tn(this)):te(this,this.Y-e)};var ta=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function to(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof to){this.h=e.h,tu(this,e.j),this.s=e.s,this.g=e.g,th(this,e.m),this.l=e.l;var t=e.i,n=new tE;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tc(this,n),this.o=e.o}else e&&(t=String(e).match(ta))?(this.h=!1,tu(this,t[1]||"",!0),this.s=tg(t[2]||""),this.g=tg(t[3]||"",!0),th(this,t[4]),this.l=tg(t[5]||"",!0),tc(this,t[6]||"",!0),this.o=tg(t[7]||"")):(this.h=!1,this.i=new tE(null,this.h))}function tl(e){return new to(e)}function tu(e,t,n){e.j=n?tg(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function th(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function tc(e,t,n){var r,i;t instanceof tE?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(tT(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tx(this,t),t_(this,n,e))},r)),r.j=i):(n||(t=tm(t,tb)),e.i=new tE(t,e.h))}function tf(e,t,n){e.i.set(t,n)}function td(e){return tf(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function tg(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tm(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,tp),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function tp(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}to.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tm(t,ty,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tm(t,ty,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tm(n,"/"==n.charAt(0)?tw:tv,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tm(n,tI)),e.join("")};var ty=/[#\/\?@]/g,tv=/[#\?:]/g,tw=/[#\?]/g,tb=/[#\?@]/g,tI=/#/g;function tE(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tT(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tx(e,t){tT(e),t=tC(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tS(e,t){return tT(e),t=tC(e,t),e.g.has(t)}function t_(e,t,n){tx(e,t),0<n.length&&(e.i=null,e.g.set(tC(e,t),_(n)),e.h+=n.length)}function tC(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(u=tE.prototype).add=function(e,t){tT(this),this.i=null,e=tC(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},u.forEach=function(e,t){tT(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},u.ta=function(){tT(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){let i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},u.Z=function(e){tT(this);let t=[];if("string"==typeof e)tS(this,e)&&(t=t.concat(this.g.get(tC(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},u.set=function(e,t){return tT(this),this.i=null,tS(this,e=tC(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},u.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},u.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];let s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")};var tD=class{constructor(e,t){this.g=e,this.map=t}};function tA(e){this.l=e||tN,e=p.PerformanceNavigationTiming?0<(e=p.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(p.g&&p.g.Ka&&p.g.Ka()&&p.g.Ka().ec),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tN=10;function tk(e){return!!e.h||!!e.g&&e.g.size>=e.j}function tR(e){return e.h?1:e.g?e.g.size:0}function tO(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function tM(e,t){e.g?e.g.add(t):e.h=t}function tL(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function tP(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.F);return t}return _(e.i)}tA.prototype.cancel=function(){if(this.i=tP(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var tF=class{stringify(e){return p.JSON.stringify(e,void 0)}parse(e){return p.JSON.parse(e,void 0)}};function tV(){this.g=new tF}function tU(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function tB(e){this.l=e.fc||null,this.j=e.ob||!1}function tq(e,t){ed.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=tj,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}T(tB,eH),tB.prototype.g=function(){return new tq(this.l,this.j)},tB.prototype.i=(r={},function(){return r}),T(tq,ed);var tj=0;function t$(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function tK(e){e.readyState=4,e.l=null,e.j=null,e.A=null,tz(e)}function tz(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(u=tq.prototype).open=function(e,t){if(this.readyState!=tj)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,tz(this)},u.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||p).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},u.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tK(this)),this.readyState=tj},u.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tz(this)),this.g&&(this.readyState=3,tz(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==p.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;t$(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))}},u.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tK(this):tz(this),3==this.readyState&&t$(this)}},u.Za=function(e){this.g&&(this.response=this.responseText=e,tK(this))},u.Ya=function(e){this.g&&(this.response=e,tK(this))},u.ka=function(){this.g&&tK(this)},u.setRequestHeader=function(e,t){this.v.append(e,t)},u.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},u.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tq.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var tG=p.JSON.parse;function tH(e){ed.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=tQ,this.L=this.M=!1}T(tH,ed);var tQ="",tW=/^https?$/i,tX=["POST","PUT"];function tY(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,tJ(e),t0(e)}function tJ(e){e.F||(e.F=!0,eg(e,"complete"),eg(e,"error"))}function tZ(e){if(e.h&&void 0!==m&&(!e.C[1]||4!=t2(e)||2!=e.da())){if(e.v&&4==t2(e))eD(e.La,0,e);else if(eg(e,"readystatechange"),4==t2(e)){e.h=!1;try{let a=e.da();switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===a){var i=String(e.I).match(ta)[1]||null;!i&&p.self&&p.self.location&&(i=p.self.location.protocol.slice(0,-1)),n=!tW.test(i?i.toLowerCase():"")}t=n}if(t)eg(e,"complete"),eg(e,"success");else{e.m=6;try{var s=2<t2(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.da()+"]",tJ(e)}}finally{t0(e)}}}}function t0(e,t){if(e.g){t1(e);let n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||eg(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function t1(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(p.clearTimeout(e.A),e.A=null)}function t2(e){return e.g?e.g.readyState:0}function t6(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case tQ:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function t4(e){let t="";return Y(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function t3(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=t4(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tf(e,t,n))}function t5(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function t8(e){this.Ga=0,this.j=[],this.l=new eM,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=t5("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=t5("baseRetryDelayMs",5e3,e),this.hb=t5("retryDelaySeedMs",1e4,e),this.eb=t5("forwardChannelMaxRetries",2,e),this.xa=t5("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.dc||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new tA(e&&e.concurrentRequestLimit),this.Ja=new tV,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function t9(e){if(ne(e),3==e.H){var t=e.W++,n=tl(e.I);if(tf(n,"SID",e.K),tf(n,"RID",t),tf(n,"TYPE","terminate"),nr(e,n),(t=new e0(e,e.l,t)).L=2,t.v=td(tl(n)),n=!1,p.navigator&&p.navigator.sendBeacon)try{n=p.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&p.Image&&((new Image).src=t.v,n=!0),n||(t.g=nm(t.l,null),t.g.ha(t.v)),t.G=Date.now(),e7(t)}nd(e)}function t7(e){e.g&&(no(e),e.g.cancel(),e.g=null)}function ne(e){t7(e),e.u&&(p.clearTimeout(e.u),e.u=null),nu(e),e.i.cancel(),e.m&&("number"==typeof e.m&&p.clearTimeout(e.m),e.m=null)}function nt(e){if(!tk(e.i)&&!e.m){e.m=!0;var t=e.Na;eI||ex(),eE||(eI(),eE=!0),eT.add(t,e),e.C=0}}function nn(e,t){var n;n=t?t.m:e.W++;let r=tl(e.I);tf(r,"SID",e.K),tf(r,"RID",n),tf(r,"AID",e.V),nr(e,r),e.o&&e.s&&t3(r,e.o,e.s),n=new e0(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=ni(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),tM(e.i,n),e3(n,r,t)}function nr(e,t){e.na&&Y(e.na,function(e,n){tf(t,n,e)}),e.h&&ts({},function(e,n){tf(t,n,e)})}function ni(e,t,n){n=Math.min(e.j.length,n);var r=e.h?I(e.h.Va,e.h,e):null;e:{var i=e.j;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g,o=i[a].map;if(0>(n-=t))t=Math.max(0,i[a].g-100),s=!1;else try{!function(e,t,n){let r=n||"";try{ts(e,function(e,n){let i=e;v(e)&&(i=ep(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){r&&r(o)}}if(s){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function ns(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;eI||ex(),eE||(eI(),eE=!0),eT.add(t,e),e.A=0}}function na(e){return!e.g&&!e.u&&!(3<=e.A)&&(e.ba++,e.u=eK(I(e.Ma,e),nc(e,e.A)),e.A++,!0)}function no(e){null!=e.B&&(p.clearTimeout(e.B),e.B=null)}function nl(e){e.g=new e0(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=tl(e.wa);tf(t,"RID","rpc"),tf(t,"SID",e.K),tf(t,"AID",e.V),tf(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&tf(t,"TO",e.qa),tf(t,"TYPE","xmlhttp"),nr(e,t),e.o&&e.s&&t3(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.v=td(tl(t)),n.s=null,n.S=!0,e5(n,e)}function nu(e){null!=e.v&&(p.clearTimeout(e.v),e.v=null)}function nh(e,t){var n=null;if(e.g==t){nu(e),no(e),e.g=null;var r=2}else{if(!tO(e.i,t))return;n=t.F,tL(e.i,t),r=1}if(0!=e.H){if(t.i){if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.G;var i,s=e.C;eg(r=eV(),new e$(r,n)),nt(e)}else ns(e)}else if(3==(s=t.o)||0==s&&0<t.ca||!(1==r&&(i=t,!(tR(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.j=i.F.concat(e.j),!0):1!=e.H&&2!=e.H&&!(e.C>=(e.cb?0:e.eb))&&(e.m=eK(I(e.Na,e,i),nc(e,e.C)),e.C++,!0)))||2==r&&na(e)))switch(n&&0<n.length&&((t=e.i).i=t.i.concat(n)),s){case 1:nf(e,5);break;case 4:nf(e,10);break;case 3:nf(e,6);break;default:nf(e,2)}}}function nc(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function nf(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=I(e.pb,e);n||(n=new to("//www.google.com/images/cleardot.gif"),p.location&&"http"==p.location.protocol||tu(n,"https"),td(n)),function(e,t){let n=new eM;if(p.Image){let r=new Image;r.onload=E(tU,n,r,"TestLoadImage: loaded",!0,t),r.onerror=E(tU,n,r,"TestLoadImage: error",!1,t),r.onabort=E(tU,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=E(tU,n,r,"TestLoadImage: timeout",!1,t),p.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else ej(2);e.H=0,e.h&&e.h.za(t),nd(e),ne(e)}function nd(e){if(e.H=0,e.ma=[],e.h){let t=tP(e.i);(0!=t.length||0!=e.j.length)&&(C(e.ma,t),C(e.ma,e.j),e.i.i.length=0,_(e.j),e.j.length=0),e.h.ya()}}function ng(e,t,n){var r=n instanceof to?tl(n):new to(n);if(""!=r.g)t&&(r.g=t+"."+r.g),th(r,r.m);else{var i=p.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;var s=new to(null);r&&tu(s,r),t&&(s.g=t),i&&th(s,i),n&&(s.l=n),r=s}return n=e.F,t=e.Da,n&&t&&tf(r,n,t),tf(r,"VER",e.ra),nr(e,r),r}function nm(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tH(n&&e.Ha&&!e.va?new tB({ob:!0}):e.va)).Oa(e.J),t}function np(){}function ny(){if(L&&!(10<=Number(K)))throw Error("Environmental error: no available transport.")}function nv(e,t){ed.call(this),this.g=new t8(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!N(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!N(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nI(this)}function nw(e){eY.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function nb(){eJ.call(this),this.status=1}function nI(e){this.g=e}function nE(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nT(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+0xd76aa478&0xffffffff;a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[1]+0xe8c7b756&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[2]+0x242070db&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[3]+0xc1bdceee&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[4]+0xf57c0faf&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[5]+0x4787c62a&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[6]+0xa8304613&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[7]+0xfd469501&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[8]+0x698098d8&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[9]+0x8b44f7af&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[10]+0xffff5bb1&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[11]+0x895cd7be&0xffffffff,a=t+(s^(n=i+(a<<22&0xffffffff|a>>>10))&(i^s))+r[12]+0x6b901122&0xffffffff,a=s+(i^(t=n+(a<<7&0xffffffff|a>>>25))&(n^i))+r[13]+0xfd987193&0xffffffff,a=i+(n^(s=t+(a<<12&0xffffffff|a>>>20))&(t^n))+r[14]+0xa679438e&0xffffffff,a=n+(t^(i=s+(a<<17&0xffffffff|a>>>15))&(s^t))+r[15]+0x49b40821&0xffffffff,n=i+(a<<22&0xffffffff|a>>>10),a=t+(i^s&(n^i))+r[1]+0xf61e2562&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[6]+0xc040b340&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[11]+0x265e5a51&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[0]+0xe9b6c7aa&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[5]+0xd62f105d&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[10]+0x2441453&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[15]+0xd8a1e681&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[4]+0xe7d3fbc8&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[9]+0x21e1cde6&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[14]+0xc33707d6&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[3]+0xf4d50d87&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[8]+0x455a14ed&0xffffffff,n=i+(a<<20&0xffffffff|a>>>12),a=t+(i^s&(n^i))+r[13]+0xa9e3e905&0xffffffff,t=n+(a<<5&0xffffffff|a>>>27),a=s+(n^i&(t^n))+r[2]+0xfcefa3f8&0xffffffff,s=t+(a<<9&0xffffffff|a>>>23),a=i+(t^n&(s^t))+r[7]+0x676f02d9&0xffffffff,i=s+(a<<14&0xffffffff|a>>>18),a=n+(s^t&(i^s))+r[12]+0x8d2a4c8a&0xffffffff,a=t+((n=i+(a<<20&0xffffffff|a>>>12))^i^s)+r[5]+0xfffa3942&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[8]+0x8771f681&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[11]+0x6d9d6122&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[14]+0xfde5380c&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[1]+0xa4beea44&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[4]+0x4bdecfa9&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[7]+0xf6bb4b60&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[10]+0xbebfbc70&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[13]+0x289b7ec6&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[0]+0xeaa127fa&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[3]+0xd4ef3085&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[6]+0x4881d05&0xffffffff,a=t+((n=i+(a<<23&0xffffffff|a>>>9))^i^s)+r[9]+0xd9d4d039&0xffffffff,a=s+((t=n+(a<<4&0xffffffff|a>>>28))^n^i)+r[12]+0xe6db99e5&0xffffffff,a=i+((s=t+(a<<11&0xffffffff|a>>>21))^t^n)+r[15]+0x1fa27cf8&0xffffffff,a=n+((i=s+(a<<16&0xffffffff|a>>>16))^s^t)+r[2]+0xc4ac5665&0xffffffff,n=i+(a<<23&0xffffffff|a>>>9),a=t+(i^(n|~s))+r[0]+0xf4292244&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[7]+0x432aff97&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[14]+0xab9423a7&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[5]+0xfc93a039&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[12]+0x655b59c3&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[3]+0x8f0ccc92&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[10]+0xffeff47d&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[1]+0x85845dd1&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[8]+0x6fa87e4f&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[15]+0xfe2ce6e0&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[6]+0xa3014314&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[13]+0x4e0811a1&0xffffffff,n=i+(a<<21&0xffffffff|a>>>11),a=t+(i^(n|~s))+r[4]+0xf7537e82&0xffffffff,t=n+(a<<6&0xffffffff|a>>>26),a=s+(n^(t|~i))+r[11]+0xbd3af235&0xffffffff,s=t+(a<<10&0xffffffff|a>>>22),a=i+(t^(s|~n))+r[2]+0x2ad7d2bb&0xffffffff,i=s+(a<<15&0xffffffff|a>>>17),a=n+(s^(i|~t))+r[9]+0xeb86d391&0xffffffff,e.g[0]=e.g[0]+t&0xffffffff,e.g[1]=e.g[1]+(i+(a<<21&0xffffffff|a>>>11))&0xffffffff,e.g[2]=e.g[2]+i&0xffffffff,e.g[3]=e.g[3]+s&0xffffffff}function nx(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}(u=tH.prototype).Oa=function(e){this.M=e},u.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():a.g(),this.C=this.u?eQ(this.u):eQ(a),this.g.onreadystatechange=I(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){tY(this,e);return}if(e=n||"",n=new Map(this.headers),r){if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())n.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r))}for(let[s,a]of(r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),i=p.FormData&&e instanceof p.FormData,!(0<=S(tX,t))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{var s;t1(this),0<this.B&&((this.L=(s=this.g,L&&"number"==typeof s.timeout&&void 0!==s.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=I(this.ua,this)):this.A=eD(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){tY(this,e)}},u.ua=function(){void 0!==m&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,eg(this,"timeout"),this.abort(8))},u.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,eg(this,"complete"),eg(this,"abort"),t0(this))},u.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),t0(this,!0)),tH.$.N.call(this)},u.La=function(){this.s||(this.G||this.v||this.l?tZ(this):this.kb())},u.kb=function(){tZ(this)},u.isActive=function(){return!!this.g},u.da=function(){try{return 2<t2(this)?this.g.status:-1}catch(e){return -1}},u.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},u.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),tG(t)}},u.Ia=function(){return this.m},u.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(u=t8.prototype).ra=8,u.H=1,u.Na=function(e){if(this.m){if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;let i=new e0(this,this.l,e),s=this.s;if(this.U&&(s?ee(s=J(s),this.U):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){t:{var r=this.j[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=ni(this,i,t),tf(n=tl(this.I),"RID",e),tf(n,"CVER",22),this.F&&tf(n,"X-HTTP-Session-Id",this.F),nr(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(t4(s)))+"&"+t:this.o&&t3(n,this.o,s)),tM(this.i,i),this.bb&&tf(n,"TYPE","init"),this.P?(tf(n,"$req",t),tf(n,"SID","null"),i.aa=!0,e3(i,n,null)):e3(i,n,t),this.H=2}}else 3==this.H&&(e?nn(this,e):0==this.j.length||tk(this.i)||nn(this))}},u.Ma=function(){if(this.u=null,nl(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=eK(I(this.jb,this),e)}},u.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,ej(10),t7(this),nl(this))},u.ib=function(){null!=this.v&&(this.v=null,t7(this),na(this),ej(19))},u.pb=function(e){e?(this.l.info("Successfully pinged google.com"),ej(2)):(this.l.info("Failed to ping google.com"),ej(1))},u.isActive=function(){return!!this.h&&this.h.isActive(this)},(u=np.prototype).Ba=function(){},u.Aa=function(){},u.za=function(){},u.ya=function(){},u.isActive=function(){return!0},u.Va=function(){},ny.prototype.g=function(e,t){return new nv(e,t)},T(nv,ed),nv.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;ej(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=ng(e,null,e.Y),nt(e)},nv.prototype.close=function(){t9(this.g)},nv.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=ep(e),e=n);t.j.push(new tD(t.fb++,e)),3==t.H&&nt(t)},nv.prototype.N=function(){this.g.h=null,delete this.j,t9(this.g),delete this.g,nv.$.N.call(this)},T(nw,eY),T(nb,eJ),T(nI,np),nI.prototype.Ba=function(){eg(this.g,"a")},nI.prototype.Aa=function(e){eg(this.g,new nw(e))},nI.prototype.za=function(e){eg(this.g,new nb)},nI.prototype.ya=function(){eg(this.g,"b")},T(nE,function(){this.blockSize=-1}),nE.prototype.reset=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.i=this.h=0},nE.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,i=this.h,s=0;s<t;){if(0==i)for(;s<=n;)nT(this,e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[i++]=e.charCodeAt(s++),i==this.blockSize){nT(this,r),i=0;break}}else for(;s<t;)if(r[i++]=e[s++],i==this.blockSize){nT(this,r),i=0;break}}this.h=i,this.i+=t},nE.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var nS={};function n_(e){var t;return -128<=e&&128>e?(t=function(e){return new nx([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(nS,e)?nS[e]:nS[e]=t(e)):new nx([0|e],0>e?-1:0)}function nC(e){if(isNaN(e)||!isFinite(e))return nA;if(0>e)return nM(nC(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=nD;return new nx(t,0)}var nD=0x100000000,nA=n_(0),nN=n_(1),nk=n_(0x1000000);function nR(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function nO(e){return -1==e.h}function nM(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new nx(n,~e.h).add(nN)}function nL(e,t){return e.add(nM(t))}function nP(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function nF(e,t){this.g=e,this.h=t}function nV(e,t){if(nR(t))throw Error("division by zero");if(nR(e))return new nF(nA,nA);if(nO(e))return t=nV(nM(e),t),new nF(nM(t.g),nM(t.h));if(nO(t))return t=nV(e,nM(t)),new nF(nM(t.g),t.h);if(30<e.g.length){if(nO(e)||nO(t))throw Error("slowDivide_ only works with positive integers.");for(var n=nN,r=t;0>=r.X(e);)n=nU(n),r=nU(r);var i=nB(n,1),s=nB(r,1);for(r=nB(r,2),n=nB(n,2);!nR(r);){var a=s.add(r);0>=a.X(e)&&(i=i.add(n),s=a),r=nB(r,1),n=nB(n,1)}return t=nL(e,i.R(t)),new nF(i,t)}for(i=nA;0<=e.X(t);){for(r=48>=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.ea()/t.ea())))/Math.LN2))?1:Math.pow(2,r-48),a=(s=nC(n)).R(t);nO(a)||0<a.X(e);)n-=r,a=(s=nC(n)).R(t);nR(s)&&(s=nN),i=i.add(s),e=nL(e,a)}return new nF(i,e)}function nU(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new nx(n,e.h)}function nB(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.D(s+n)>>>t|e.D(s+n+1)<<32-t:e.D(s+n);return new nx(i,e.h)}(u=nx.prototype).ea=function(){if(nO(this))return-nM(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:nD+r)*t,t*=nD}return e},u.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(nR(this))return"0";if(nO(this))return"-"+nM(this).toString(e);for(var t=nC(Math.pow(e,6)),n=this,r="";;){var i=nV(n,t).g,s=((0<(n=nL(n,i.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(nR(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},u.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},u.X=function(e){return nO(e=nL(this,e))?-1:nR(e)?0:1},u.abs=function(){return nO(this)?nM(this):this},u.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.D(i))+(65535&e.D(i)),a=(s>>>16)+(this.D(i)>>>16)+(e.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,n[i]=a<<16|s}return new nx(n,-0x80000000&n[n.length-1]?-1:0)},u.R=function(e){if(nR(this)||nR(e))return nA;if(nO(this))return nO(e)?nM(this).R(nM(e)):nM(nM(this).R(e));if(nO(e))return nM(this.R(nM(e)));if(0>this.X(nk)&&0>e.X(nk))return nC(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.D(r)>>>16,a=65535&this.D(r),o=e.D(i)>>>16,l=65535&e.D(i);n[2*r+2*i]+=a*l,nP(n,2*r+2*i),n[2*r+2*i+1]+=s*l,nP(n,2*r+2*i+1),n[2*r+2*i+1]+=a*o,nP(n,2*r+2*i+1),n[2*r+2*i+2]+=s*o,nP(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new nx(n,0)},u.gb=function(e){return nV(this,e).h},u.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new nx(n,this.h&e.h)},u.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new nx(n,this.h|e.h)},u.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new nx(n,this.h^e.h)},ny.prototype.createWebChannel=ny.prototype.g,nv.prototype.send=nv.prototype.u,nv.prototype.open=nv.prototype.m,nv.prototype.close=nv.prototype.close,ez.NO_ERROR=0,ez.TIMEOUT=8,ez.HTTP_ERROR=6,eG.COMPLETE="complete",eW.EventType=eX,eX.OPEN="a",eX.CLOSE="b",eX.ERROR="c",eX.MESSAGE="d",ed.prototype.listen=ed.prototype.O,tH.prototype.listenOnce=tH.prototype.P,tH.prototype.getLastError=tH.prototype.Sa,tH.prototype.getLastErrorCode=tH.prototype.Ia,tH.prototype.getStatus=tH.prototype.da,tH.prototype.getResponseJson=tH.prototype.Wa,tH.prototype.getResponseText=tH.prototype.ja,tH.prototype.send=tH.prototype.ha,tH.prototype.setWithCredentials=tH.prototype.Oa,nE.prototype.digest=nE.prototype.l,nE.prototype.reset=nE.prototype.reset,nE.prototype.update=nE.prototype.j,nx.prototype.add=nx.prototype.add,nx.prototype.multiply=nx.prototype.R,nx.prototype.modulo=nx.prototype.gb,nx.prototype.compare=nx.prototype.X,nx.prototype.toNumber=nx.prototype.ea,nx.prototype.toString=nx.prototype.toString,nx.prototype.getBits=nx.prototype.D,nx.fromNumber=nC,nx.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return nM(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=nC(Math.pow(n,8)),i=nA,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=nC(Math.pow(n,a)),i=i.R(a).add(nC(o))):i=(i=i.R(r)).add(nC(o))}return i};var nq=g.createWebChannelTransport=function(){return new ny},nj=g.getStatEventTarget=function(){return eV()},n$=g.ErrorCode=ez,nK=g.EventType=eG,nz=g.Event=eP,nG=g.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},nH=g.FetchXmlHttpFactory=tB,nQ=g.WebChannel=eW,nW=g.XhrIo=tH,nX=g.Md5=nE,nY=g.Integer=nx,nJ=n(7836);let nZ="@firebase/firestore";class n0{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}n0.UNAUTHENTICATED=new n0(null),n0.GOOGLE_CREDENTIALS=new n0("google-credentials-uid"),n0.FIRST_PARTY=new n0("first-party-uid"),n0.MOCK_USER=new n0("mock-user");let n1="9.23.0",n2=new f.Vy("@firebase/firestore");function n6(){return n2.logLevel}function n4(e,...t){if(n2.logLevel<=f.$b.DEBUG){let n=t.map(n8);n2.debug(`Firestore (${n1}): ${e}`,...n)}}function n3(e,...t){if(n2.logLevel<=f.$b.ERROR){let n=t.map(n8);n2.error(`Firestore (${n1}): ${e}`,...n)}}function n5(e,...t){if(n2.logLevel<=f.$b.WARN){let n=t.map(n8);n2.warn(`Firestore (${n1}): ${e}`,...n)}}function n8(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function n9(e="Unexpected state"){let t=`FIRESTORE (${n1}) INTERNAL ASSERTION FAILED: `+e;throw n3(t),Error(t)}let n7={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class re extends d.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class rt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class rn{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class rr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(n0.UNAUTHENTICATED))}shutdown(){}}class ri{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class rs{constructor(e){this.t=e,this.currentUser=n0.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new rt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new rt,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{n4("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(n4("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new rt)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(n4("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?("string"==typeof t.accessToken||n9(),new rn(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return null===e||"string"==typeof e||n9(),new n0(e)}}class ra{constructor(e,t,n){this.h=e,this.l=t,this.m=n,this.type="FirstParty",this.user=n0.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);let e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class ro{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new ra(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(n0.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ru{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){let n=e=>{null!=e.error&&n4("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.T;return this.T=e.token,n4("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{n4("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.I.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.I.getImmediate({optional:!0});e?r(e):n4("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?("string"==typeof e.token||n9(),this.T=e.token,new rl(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class rh{static A(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";for(;n.length<20;){let r=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function rc(e,t){return e<t?-1:e>t?1:0}function rf(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class rd{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new re(n7.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new re(n7.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return rd.fromMillis(Date.now())}static fromDate(e){return rd.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new rd(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?rc(this.nanoseconds,e.nanoseconds):rc(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rg{constructor(e){this.timestamp=e}static fromTimestamp(e){return new rg(e)}static min(){return new rg(new rd(0,0))}static max(){return new rg(new rd(0x3afff4417f,0x3b9ac9ff))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class rm{constructor(e,t,n){void 0===t?t=0:t>e.length&&n9(),void 0===n?n=e.length-t:n>e.length-t&&n9(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===rm.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof rm?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.get(r),i=t.get(r);if(n<i)return -1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class rp extends rm{construct(e,t,n){return new rp(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new re(n7.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new rp(t)}static emptyPath(){return new rp([])}}let ry=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rv extends rm{construct(e,t,n){return new rv(e,t,n)}static isValidIdentifier(e){return ry.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rv.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rv(["__name__"])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new re(n7.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new re(n7.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new re(n7.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new re(n7.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rv(t)}static emptyPath(){return new rv([])}}class rw{constructor(e){this.path=e}static fromPath(e){return new rw(rp.fromString(e))}static fromName(e){return new rw(rp.fromString(e).popFirst(5))}static empty(){return new rw(rp.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===rp.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return rp.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new rw(new rp(e.slice()))}}class rb{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function rI(e){return e.fields.find(e=>2===e.kind)}function rE(e){return e.fields.filter(e=>2!==e.kind)}rb.UNKNOWN_ID=-1;class rT{constructor(e,t){this.fieldPath=e,this.kind=t}}class rx{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new rx(0,rC.min())}}function rS(e,t){let n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return new rC(rg.fromTimestamp(1e9===r?new rd(n+1,0):new rd(n,r)),rw.empty(),t)}function r_(e){return new rC(e.readTime,e.key,-1)}class rC{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new rC(rg.min(),rw.empty(),-1)}static max(){return new rC(rg.max(),rw.empty(),-1)}}function rD(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=rw.comparator(e.documentKey,t.documentKey))?n:rc(e.largestBatchId,t.largestBatchId)}let rA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class rN{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function rk(e){if(e.code!==n7.FAILED_PRECONDITION||e.message!==rA)throw e;n4("LocalStore","Unexpectedly lost primary lease")}class rR{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&n9(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rR((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof rR?t:rR.resolve(t)}catch(e){return rR.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rR.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rR.reject(t)}static resolve(e){return new rR((t,n)=>{t(e)})}static reject(e){return new rR((t,n)=>{n(e)})}static waitFor(e){return new rR((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=rR.resolve(!1);for(let n of e)t=t.next(e=>e?rR.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new rR((n,r)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new rR((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}class rO{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new rt,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new rP(e,t.error)):this.v.resolve()},this.transaction.onerror=t=>{let n=rq(t.target.error);this.v.reject(new rP(e,n))}}static open(e,t,n,r){try{return new rO(t,e.transaction(r,n))}catch(e){throw new rP(t,e)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(n4("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new rV(this.transaction.objectStore(e))}}class rM{constructor(e,t,n){this.name=e,this.version=t,this.V=n,12.2===rM.S((0,d.ZQ)())&&n3("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return n4("SimpleDb","Removing database:",e),rU(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,d.zW)())return!1;if(rM.C())return!0;let e=(0,d.ZQ)(),t=rM.S(e),n=rM.N(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static C(){var e;return void 0!==nJ&&"YES"===(null===(e=nJ.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}static N(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}async $(e){return this.db||(n4("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{let r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{t(e.target.result)},r.onblocked=()=>{n(new rP(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{let r=t.target.error;"VersionError"===r.name?n(new re(n7.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new re(n7.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new rP(e,r))},r.onupgradeneeded=e=>{n4("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.V.O(t,r.transaction,e.oldVersion,this.version).next(()=>{n4("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.F&&(this.db.onversionchange=e=>this.F(e)),this.db}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.$(e);let t=rO.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next(e=>(t.P(),e)).catch(e=>(t.abort(e),rR.reject(e))).toPromise();return s.catch(()=>{}),await t.R,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(n4("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class rL{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return rU(this.L.delete())}}class rP extends re{constructor(e,t){super(n7.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rF(e){return"IndexedDbTransactionError"===e.name}class rV{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(n4("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(n4("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),rU(n)}add(e){return n4("SimpleDb","ADD",this.store.name,e,e),rU(this.store.add(e))}get(e){return rU(this.store.get(e)).next(t=>(void 0===t&&(t=null),n4("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return n4("SimpleDb","DELETE",this.store.name,e),rU(this.store.delete(e))}count(){return n4("SimpleDb","COUNT",this.store.name),rU(this.store.count())}j(e,t){let n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){let e=this.cursor(n),t=[];return this.W(e,(e,n)=>{t.push(n)}).next(()=>t)}{let e=this.store.getAll(n.range);return new rR((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}H(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new rR((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}J(e,t){n4("SimpleDb","DELETE ALL",this.store.name);let n=this.options(e,t);n.Y=!1;let r=this.cursor(n);return this.W(r,(e,t,n)=>n.delete())}X(e,t){let n;t?n=e:(n={},t=e);let r=this.cursor(n);return this.W(r,t)}Z(e){let t=this.cursor({});return new rR((n,r)=>{t.onerror=e=>{r(rq(e.target.error))},t.onsuccess=t=>{let r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():n()}):n()}})}W(e,t){let n=[];return new rR((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void r();let s=new rL(i),a=t(i.primaryKey,i.value,s);if(a instanceof rR){let e=a.catch(e=>(s.done(),rR.reject(e)));n.push(e)}s.isDone?r():null===s.K?i.continue():i.continue(s.K)}}).next(()=>rR.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function rU(e){return new rR((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(rq(e.target.error))}})}let rB=!1;function rq(e){let t=rM.S((0,d.ZQ)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new re("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return rB||(rB=!0,setTimeout(()=>{throw e},0)),e}}return e}class rj{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){n4("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{n4("IndexBackiller",`Documents written: ${await this.tt.nt()}`)}catch(e){rF(e)?n4("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e):await rk(e)}await this.et(6e4)})}}class r${constructor(e,t){this.localStore=e,this.persistence=t}async nt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.st(t,e))}st(e,t){let n=new Set,r=t,i=!0;return rR.doWhile(()=>!0===i&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return n4("IndexBackiller",`Processing collection: ${t}`),this.it(e,t,r).next(e=>{r-=e,n.add(t)});i=!1})).next(()=>t-r)}it(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next(n=>{let i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.rt(r,n)).next(n=>(n4("IndexBackiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>i.size)}))}rt(e,t){let n=e;return t.changes.forEach((e,t)=>{let r=r_(t);rD(r,n)>0&&(n=r)}),new rC(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class rK{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ot(e),this.ut=e=>t.writeSequenceNumber(e))}ot(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ut&&this.ut(e),e}}function rz(e){return null==e}function rG(e){return 0===e&&1/e==-1/0}function rH(e){return"number"==typeof e&&Number.isInteger(e)&&!rG(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function rQ(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"}function rW(e){let t=e.length;if(t>=2||n9(),2===t)return"\x01"===e.charAt(0)&&"\x01"===e.charAt(1)||n9(),rp.emptyPath();let n=t-2,r=[],i="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&n9(),e.charAt(t+1)){case"\x01":let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),r.push(a);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:n9()}s=t+2}return new rp(r)}rK.ct=-1;let rX=["userId","batchId"],rY={},rJ=["prefixPath","collectionGroup","readTime","documentId"],rZ=["prefixPath","collectionGroup","documentId"],r0=["collectionGroup","readTime","prefixPath","documentId"],r1=["canonicalId","targetId"],r2=["targetId","path"],r6=["path","targetId"],r4=["collectionId","parent"],r3=["indexId","uid"],r5=["uid","sequenceNumber"],r8=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],r9=["indexId","uid","orderedDocumentKey"],r7=["userId","collectionPath","documentId"],ie=["userId","collectionPath","largestBatchId"],it=["userId","collectionGroup","largestBatchId"],ir=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ii=[...ir,"documentOverlays"],is=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ia=[...is,"indexConfiguration","indexState","indexEntries"];class io extends rN{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function il(e,t){return rM.M(e.ht,t)}function iu(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ih(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ic(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class id{constructor(e,t){this.comparator=e,this.root=t||im.EMPTY}insert(e,t){return new id(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,im.BLACK,null,null))}remove(e){return new id(this.comparator,this.root.remove(e,this.comparator).copy(null,null,im.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ig(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ig(this.root,e,this.comparator,!1)}getReverseIterator(){return new ig(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ig(this.root,e,this.comparator,!0)}}class ig{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class im{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:im.RED,this.left=null!=r?r:im.EMPTY,this.right=null!=i?i:im.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new im(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return im.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return im.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,im.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,im.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw n9();let e=this.left.check();if(e!==this.right.check())throw n9();return e+(this.isRed()?0:1)}}im.EMPTY=null,im.RED=!0,im.BLACK=!1,im.EMPTY=new class{constructor(){this.size=0}get key(){throw n9()}get value(){throw n9()}get color(){throw n9()}get left(){throw n9()}get right(){throw n9()}copy(e,t,n,r,i){return this}insert(e,t,n){return new im(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ip{constructor(e){this.comparator=e,this.data=new id(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new iy(this.data.getIterator())}getIteratorFrom(e){return new iy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof ip)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new ip(this.comparator);return t.data=e,t}}class iy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function iv(e){return e.hasNext()?e.getNext():void 0}class iw{constructor(e){this.fields=e,e.sort(rv.comparator)}static empty(){return new iw([])}unionWith(e){let t=new ip(rv.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new iw(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return rf(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ib extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class iI{constructor(e){this.binaryString=e}static fromBase64String(e){return new iI(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new ib("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new iI(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return rc(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}iI.EMPTY_BYTE_STRING=new iI("");let iE=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function iT(e){if(e||n9(),"string"==typeof e){let t=0,n=iE.exec(e);if(n||n9(),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:ix(e.seconds),nanos:ix(e.nanos)}}function ix(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function iS(e){return"string"==typeof e?iI.fromBase64String(e):iI.fromUint8Array(e)}function i_(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function iC(e){let t=e.mapValue.fields.__previous_value__;return i_(t)?iC(t):t}function iD(e){let t=iT(e.mapValue.fields.__local_write_time__.timestampValue);return new rd(t.seconds,t.nanos)}class iA{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class iN{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new iN("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof iN&&e.projectId===this.projectId&&e.database===this.database}}let ik={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},iR={nullValue:"NULL_VALUE"};function iO(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?i_(e)?4:iG(e)?0x1fffffffffffff:10:n9()}function iM(e,t){if(e===t)return!0;let n=iO(e);if(n!==iO(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return iD(e).isEqual(iD(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=iT(e.timestampValue),r=iT(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return iS(e.bytesValue).isEqual(iS(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return ix(e.geoPointValue.latitude)===ix(t.geoPointValue.latitude)&&ix(e.geoPointValue.longitude)===ix(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ix(e.integerValue)===ix(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=ix(e.doubleValue),r=ix(t.doubleValue);return n===r?rG(n)===rG(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return rf(e.arrayValue.values||[],t.arrayValue.values||[],iM);case 10:return function(e,t){let n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(iu(n)!==iu(r))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!iM(n[e],r[e])))return!1;return!0}(e,t);default:return n9()}}function iL(e,t){return void 0!==(e.values||[]).find(e=>iM(e,t))}function iP(e,t){if(e===t)return 0;let n=iO(e),r=iO(t);if(n!==r)return rc(n,r);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return rc(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=ix(e.integerValue||e.doubleValue),r=ix(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return iF(e.timestampValue,t.timestampValue);case 4:return iF(iD(e),iD(t));case 5:return rc(e.stringValue,t.stringValue);case 6:return function(e,t){let n=iS(e),r=iS(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=rc(n[e],r[e]);if(0!==t)return t}return rc(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=rc(ix(e.latitude),ix(t.latitude));return 0!==n?n:rc(ix(e.longitude),ix(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=iP(n[e],r[e]);if(t)return t}return rc(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===ik.mapValue&&t===ik.mapValue)return 0;if(e===ik.mapValue)return 1;if(t===ik.mapValue)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=rc(r[e],s[e]);if(0!==t)return t;let a=iP(n[r[e]],i[s[e]]);if(0!==a)return a}return rc(r.length,s.length)}(e.mapValue,t.mapValue);default:throw n9()}}function iF(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return rc(e,t);let n=iT(e),r=iT(t),i=rc(n.seconds,r.seconds);return 0!==i?i:rc(n.nanos,r.nanos)}function iV(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=iT(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?iS(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,rw.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=iV(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${iV(e.fields[i])}`;return n+"}"}(e.mapValue):n9()}function iU(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function iB(e){return!!e&&"integerValue"in e}function iq(e){return!!e&&"arrayValue"in e}function ij(e){return!!e&&"nullValue"in e}function i$(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function iK(e){return!!e&&"mapValue"in e}function iz(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return ih(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=iz(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=iz(e.arrayValue.values[n]);return t}return Object.assign({},e)}function iG(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function iH(e,t){let n=iP(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function iQ(e,t){let n=iP(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class iW{constructor(e){this.value=e}static empty(){return new iW({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!iK(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=iz(t)}setAll(e){let t=rv.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=iz(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());iK(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return iM(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];iK(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(ih(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new iW(iz(this.value))}}class iX{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new iX(e,0,rg.min(),rg.min(),rg.min(),iW.empty(),0)}static newFoundDocument(e,t,n,r){return new iX(e,1,t,rg.min(),n,r,0)}static newNoDocument(e,t){return new iX(e,2,t,rg.min(),rg.min(),iW.empty(),0)}static newUnknownDocument(e,t){return new iX(e,3,t,rg.min(),rg.min(),iW.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(rg.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=iW.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=iW.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rg.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof iX&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new iX(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class iY{constructor(e,t){this.position=e,this.inclusive=t}}function iJ(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(r=s.field.isKeyField()?rw.comparator(rw.fromName(a.referenceValue),n.key):iP(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function iZ(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!iM(e.position[n],t.position[n]))return!1;return!0}class i0{constructor(e,t="asc"){this.field=e,this.dir=t}}class i1{}class i2 extends i1{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new i7(e,t,n):"array-contains"===t?new sr(e,n):"in"===t?new si(e,n):"not-in"===t?new ss(e,n):"array-contains-any"===t?new sa(e,n):new i2(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new se(e,n):new st(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(iP(t,this.value)):null!==t&&iO(this.value)===iO(t)&&this.matchesComparison(iP(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return n9()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class i6 extends i1{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new i6(e,t)}matches(e){return i4(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let e=this.ft(e=>e.isInequality());return null!==e?e.field:null}ft(e){for(let t of this.getFlattenedFilters())if(e(t))return t;return null}}function i4(e){return"and"===e.op}function i3(e){return"or"===e.op}function i5(e){return i8(e)&&i4(e)}function i8(e){for(let t of e.filters)if(t instanceof i6)return!1;return!0}function i9(e,t){let n=e.filters.concat(t);return i6.create(n,e.op)}class i7 extends i2{constructor(e,t,n){super(e,t,n),this.key=rw.fromName(n.referenceValue)}matches(e){let t=rw.comparator(e.key,this.key);return this.matchesComparison(t)}}class se extends i2{constructor(e,t){super(e,"in",t),this.keys=sn("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class st extends i2{constructor(e,t){super(e,"not-in",t),this.keys=sn("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function sn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>rw.fromName(e.referenceValue))}class sr extends i2{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return iq(t)&&iL(t.arrayValue,this.value)}}class si extends i2{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&iL(this.value.arrayValue,t)}}class ss extends i2{constructor(e,t){super(e,"not-in",t)}matches(e){if(iL(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&!iL(this.value.arrayValue,t)}}class sa extends i2{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!iq(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>iL(this.value.arrayValue,e))}}class so{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.dt=null}}function sl(e,t=null,n=[],r=[],i=null,s=null,a=null){return new so(e,t,n,r,i,s,a)}function su(e){if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof i2)return t.field.canonicalString()+t.op.toString()+iV(t.value);if(i5(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>iV(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>iV(e)).join(",")),e.dt=t}return e.dt}function sh(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof i2?n instanceof i2&&t.op===n.op&&t.field.isEqual(n.field)&&iM(t.value,n.value):t instanceof i6?n instanceof i6&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void n9()}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!iZ(e.startAt,t.startAt)&&iZ(e.endAt,t.endAt)}function sc(e){return rw.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function sf(e,t){return e.filters.filter(e=>e instanceof i2&&e.field.isEqual(t))}function sd(e,t,n){let r=iR,i=!0;for(let n of sf(e,t)){let e=iR,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?iR:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?iU(iN.empty(),rw.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?{mapValue:{}}:n9();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=iR}0>iH({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>iH({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}function sg(e,t,n){let r=ik,i=!0;for(let n of sf(e,t)){let e=ik,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?iU(iN.empty(),rw.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?{mapValue:{}}:"mapValue"in s?ik:n9(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=ik}iQ({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];iQ({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}}return{value:r,inclusive:i}}class sm{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.wt=null,this._t=null,this.startAt,this.endAt}}function sp(e){return new sm(e)}function sy(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function sv(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function sw(e){for(let t of e.filters){let e=t.getFirstInequalityField();if(null!==e)return e}return null}function sb(e){return null!==e.collectionGroup}function sI(e){if(null===e.wt){e.wt=[];let t=sw(e),n=sv(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new i0(t)),e.wt.push(new i0(rv.keyField(),"asc"));else{let t=!1;for(let n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){let t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new i0(rv.keyField(),t))}}}return e.wt}function sE(e){if(!e._t){if("F"===e.limitType)e._t=sl(e.path,e.collectionGroup,sI(e),e.filters,e.limit,e.startAt,e.endAt);else{let t=[];for(let n of sI(e)){let e="desc"===n.dir?"asc":"desc";t.push(new i0(n.field,e))}let n=e.endAt?new iY(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new iY(e.startAt.position,e.startAt.inclusive):null;e._t=sl(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}return e._t}function sT(e,t){t.getFirstInequalityField(),sw(e);let n=e.filters.concat([t]);return new sm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function sx(e,t,n){return new sm(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function sS(e,t){return sh(sE(e),sE(t))&&e.limitType===t.limitType}function s_(e){return`${su(sE(e))}|lt:${e.limitType}`}function sC(e){var t;let n;return`Query(target=${n=(t=sE(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof i2?`${t.field.canonicalString()} ${t.op} ${iV(t.value)}`:t instanceof i6?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>iV(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>iV(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function sD(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):rw.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of sI(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let r=iJ(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,sI(e),t))&&(!e.endAt||!!function(e,t,n){let r=iJ(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,sI(e),t))}function sA(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function sN(e){return(t,n)=>{let r=!1;for(let i of sI(e)){let e=function(e,t,n){let r=e.field.isKeyField()?rw.comparator(t.key,n.key):function(e,t,n){let r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?iP(r,i):n9()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return -1*r;default:return n9()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class sk{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){ih(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return ic(this.inner)}size(){return this.innerSize}}let sR=new id(rw.comparator),sO=new id(rw.comparator);function sM(...e){let t=sO;for(let n of e)t=t.insert(n.key,n);return t}function sL(e){let t=sO;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function sP(){return new sk(e=>e.toString(),(e,t)=>e.isEqual(t))}let sF=new id(rw.comparator),sV=new ip(rw.comparator);function sU(...e){let t=sV;for(let n of e)t=t.add(n);return t}let sB=new ip(rc);function sq(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rG(t)?"-0":t}}function sj(e){return{integerValue:""+e}}class s${constructor(){this._=void 0}}function sK(e,t){return e instanceof sX?iB(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class sz extends s${}class sG extends s${constructor(e){super(),this.elements=e}}function sH(e,t){let n=sJ(t);for(let t of e.elements)n.some(e=>iM(e,t))||n.push(t);return{arrayValue:{values:n}}}class sQ extends s${constructor(e){super(),this.elements=e}}function sW(e,t){let n=sJ(t);for(let t of e.elements)n=n.filter(e=>!iM(e,t));return{arrayValue:{values:n}}}class sX extends s${constructor(e,t){super(),this.serializer=e,this.gt=t}}function sY(e){return ix(e.integerValue||e.doubleValue)}function sJ(e){return iq(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sZ{constructor(e,t){this.field=e,this.transform=t}}class s0{constructor(e,t){this.version=e,this.transformResults=t}}class s1{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new s1}static exists(e){return new s1(void 0,e)}static updateTime(e){return new s1(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function s2(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class s6{}function s4(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new an(e.key,s1.none()):new s8(e.key,e.data,s1.none());{let n=e.data,r=iW.empty(),i=new ip(rv.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new s9(e.key,r,new iw(i.toArray()),s1.none())}}function s3(e,t,n,r){return e instanceof s8?function(e,t,n,r){if(!s2(e.precondition,t))return n;let i=e.value.clone(),s=at(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof s9?function(e,t,n,r){if(!s2(e.precondition,t))return n;let i=at(e.fieldTransforms,r,t),s=t.data;return(s.setAll(s7(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):s2(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function s5(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&rf(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof sG&&r instanceof sG||n instanceof sQ&&r instanceof sQ?rf(n.elements,r.elements,iM):n instanceof sX&&r instanceof sX?iM(n.gt,r.gt):n instanceof sz&&r instanceof sz)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class s8 extends s6{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class s9 extends s6{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function s7(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function ae(e,t,n){var r;let i=new Map;e.length===n.length||n9();for(let s=0;s<n.length;s++){let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof sG?sH(o,l):o instanceof sQ?sW(o,l):r))}return i}function at(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,e instanceof sz?function(e,t){let n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&i_(t)&&(t=iC(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(t,s):e instanceof sG?sH(e,s):e instanceof sQ?sW(e,s):function(e,t){let n=sK(e,t),r=sY(n)+sY(e.gt);return iB(n)&&iB(e.gt)?sj(r):sq(e.serializer,r)}(e,s))}return r}class an extends s6{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ar extends s6{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ai{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];if(i.key.isEqual(e.key)){var r;r=n[t],i instanceof s8?function(e,t,n){let r=e.value.clone(),i=ae(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(i,e,r):i instanceof s9?function(e,t,n){if(!s2(e.precondition,t))return void t.convertToUnknownDocument(n.version);let r=ae(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(s7(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(i,e,r):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,r)}}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=s3(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=s3(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=sP();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=s4(s,a=t.has(r.key)?null:a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(rg.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),sU())}isEqual(e){return this.batchId===e.batchId&&rf(this.mutations,e.mutations,(e,t)=>s5(e,t))&&rf(this.baseMutations,e.baseMutations,(e,t)=>s5(e,t))}}class as{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){e.mutations.length===n.length||n9();let r=sF,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new as(e,t,n,r)}}class aa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ao{constructor(e,t){this.count=e,this.unchangedNames=t}}function al(e){if(void 0===e)return n3("GRPC error has no .code"),n7.UNKNOWN;switch(e){case o.OK:return n7.OK;case o.CANCELLED:return n7.CANCELLED;case o.UNKNOWN:return n7.UNKNOWN;case o.DEADLINE_EXCEEDED:return n7.DEADLINE_EXCEEDED;case o.RESOURCE_EXHAUSTED:return n7.RESOURCE_EXHAUSTED;case o.INTERNAL:return n7.INTERNAL;case o.UNAVAILABLE:return n7.UNAVAILABLE;case o.UNAUTHENTICATED:return n7.UNAUTHENTICATED;case o.INVALID_ARGUMENT:return n7.INVALID_ARGUMENT;case o.NOT_FOUND:return n7.NOT_FOUND;case o.ALREADY_EXISTS:return n7.ALREADY_EXISTS;case o.PERMISSION_DENIED:return n7.PERMISSION_DENIED;case o.FAILED_PRECONDITION:return n7.FAILED_PRECONDITION;case o.ABORTED:return n7.ABORTED;case o.OUT_OF_RANGE:return n7.OUT_OF_RANGE;case o.UNIMPLEMENTED:return n7.UNIMPLEMENTED;case o.DATA_LOSS:return n7.DATA_LOSS;default:return n9()}}(l=o||(o={}))[l.OK=0]="OK",l[l.CANCELLED=1]="CANCELLED",l[l.UNKNOWN=2]="UNKNOWN",l[l.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",l[l.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",l[l.NOT_FOUND=5]="NOT_FOUND",l[l.ALREADY_EXISTS=6]="ALREADY_EXISTS",l[l.PERMISSION_DENIED=7]="PERMISSION_DENIED",l[l.UNAUTHENTICATED=16]="UNAUTHENTICATED",l[l.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",l[l.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",l[l.ABORTED=10]="ABORTED",l[l.OUT_OF_RANGE=11]="OUT_OF_RANGE",l[l.UNIMPLEMENTED=12]="UNIMPLEMENTED",l[l.INTERNAL=13]="INTERNAL",l[l.UNAVAILABLE=14]="UNAVAILABLE",l[l.DATA_LOSS=15]="DATA_LOSS";class au{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return ah}static getOrCreateInstance(){return null===ah&&(ah=new au),ah}onExistenceFilterMismatch(e){let t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let ah=null,ac=new nY([0xffffffff,0xffffffff],0);function af(e){let t=(new TextEncoder).encode(e),n=new nX;return n.update(t),new Uint8Array(n.digest())}function ad(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new nY([n,r],0),new nY([i,s],0)]}class ag{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new am(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new am(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new am(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=nY.fromNumber(this.It)}Et(e,t,n){let r=e.add(t.multiply(nY.fromNumber(n)));return 1===r.compare(ac)&&(r=new nY([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;let[t,n]=ad(af(e));for(let e=0;e<this.hashCount;e++){let r=this.Et(t,n,e);if(!this.At(r))return!1}return!0}static create(e,t,n){let r=new ag(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.It)return;let[t,n]=ad(af(e));for(let e=0;e<this.hashCount;e++){let r=this.Et(t,n,e);this.Rt(r)}}Rt(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class am extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ap{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,ay.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ap(rg.min(),r,new id(rc),sR,sU())}}class ay{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ay(n,t,sU(),sU(),sU())}}class av{constructor(e,t,n,r){this.Pt=e,this.removedTargetIds=t,this.key=n,this.bt=r}}class aw{constructor(e,t){this.targetId=e,this.Vt=t}}class ab{constructor(e,t,n=iI.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class aI{constructor(){this.St=0,this.Dt=ax(),this.Ct=iI.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=sU(),t=sU(),n=sU();return this.Dt.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:n9()}}),new ay(this.Ct,this.xt,e,t,n)}Ft(){this.Nt=!1,this.Dt=ax()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class aE{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=sR,this.zt=aT(),this.Wt=new id(rc)}Ht(e){for(let t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(let t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{let n=this.Zt(t);switch(e.state){case 0:this.te(t)&&n.$t(e.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(e.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(t);break;case 3:this.te(t)&&(n.Kt(),n.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),n.$t(e.resumeToken));break;default:n9()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((e,n)=>{this.te(n)&&t(n)})}ne(e){var t;let n=e.targetId,r=e.Vt.count,i=this.se(n);if(i){let s=i.target;if(sc(s)){if(0===r){let e=new rw(s.path);this.Yt(n,e,iX.newNoDocument(e,rg.min()))}else 1===r||n9()}else{let i=this.ie(n);if(i!==r){let r=this.re(e,i);0!==r&&(this.ee(n),this.Wt=this.Wt.insert(n,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=au.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(e,t,n){var r,i,s,a,o,l;let u={localCacheCount:t,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(u.bloomFilter={applied:0===e,hashCount:null!==(r=null==h?void 0:h.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(a=null===(s=null===(i=null==h?void 0:h.bits)||void 0===i?void 0:i.bitmap)||void 0===s?void 0:s.length)&&void 0!==a?a:0,padding:null!==(l=null===(o=null==h?void 0:h.bits)||void 0===o?void 0:o.padding)&&void 0!==l?l:0}),u}(r,i,e.Vt))}}}}re(e,t){let n,r;let{unchangedNames:i,count:s}=e.Vt;if(!i||!i.bits)return 1;let{bits:{bitmap:a="",padding:o=0},hashCount:l=0}=i;try{n=iS(a).toUint8Array()}catch(e){if(e instanceof ib)return n5("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw e}try{r=new ag(n,o,l)}catch(e){return n5(e instanceof am?"BloomFilter error: ":"Applying bloom filter failed: ",e),1}return 0===r.It?1:s!==t-this.oe(e.targetId,r)?2:0}oe(e,t){let n=this.Gt.getRemoteKeysForTarget(e),r=0;return n.forEach(n=>{let i=this.Gt.ue(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.vt(s)||(this.Yt(e,n,null),r++)}),r}ce(e){let t=new Map;this.Qt.forEach((n,r)=>{let i=this.se(r);if(i){if(n.current&&sc(i.target)){let t=new rw(i.target.path);null!==this.jt.get(t)||this.ae(r,t)||this.Yt(r,t,iX.newNoDocument(t,e))}n.Mt&&(t.set(r,n.Ot()),n.Ft())}});let n=sU();this.zt.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.se(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.jt.forEach((t,n)=>n.setReadTime(e));let r=new ap(e,t,this.Wt,this.jt,n);return this.jt=sR,this.zt=aT(),this.Wt=new id(rc),r}Jt(e,t){if(!this.te(e))return;let n=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,n),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,n){if(!this.te(e))return;let r=this.Zt(e);this.ae(e,t)?r.Bt(t,1):r.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),n&&(this.jt=this.jt.insert(t,n))}removeTarget(e){this.Qt.delete(e)}ie(e){let t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new aI,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new ip(rc),this.zt=this.zt.insert(e,t)),t}te(e){let t=null!==this.se(e);return t||n4("WatchChangeAggregator","Detected inactive target",e),t}se(e){let t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new aI),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function aT(){return new id(rw.comparator)}function ax(){return new id(rw.comparator)}let aS={asc:"ASCENDING",desc:"DESCENDING"},a_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aC={and:"AND",or:"OR"};class aD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function aA(e,t){return e.useProto3Json||null==t?t:{value:t}}function aN(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ak(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aR(e){return e||n9(),rg.fromTimestamp(function(e){let t=iT(e);return new rd(t.seconds,t.nanos)}(e))}function aO(e,t){return new rp(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function aM(e){let t=rp.fromString(e);return aX(t)||n9(),t}function aL(e,t){return aO(e.databaseId,t.path)}function aP(e,t){let n=aM(t);if(n.get(1)!==e.databaseId.projectId)throw new re(n7.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new re(n7.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new rw(aB(n))}function aF(e,t){return aO(e.databaseId,t)}function aV(e){let t=aM(e);return 4===t.length?rp.emptyPath():aB(t)}function aU(e){return new rp(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aB(e){return e.length>4&&"documents"===e.get(4)||n9(),e.popFirst(5)}function aq(e,t,n){return{name:aL(e,t),fields:n.value.mapValue.fields}}function aj(e,t,n){let r=aP(e,t.name),i=aR(t.updateTime),s=t.createTime?aR(t.createTime):rg.min(),a=new iW({mapValue:{fields:t.fields}}),o=iX.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function a$(e,t){var n;let r;if(t instanceof s8)r={update:aq(e,t.key,t.value)};else if(t instanceof an)r={delete:aL(e,t.key)};else if(t instanceof s9)r={update:aq(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ar))return n9();r={verify:aL(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof sz)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof sG)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof sQ)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof sX)return{fieldPath:t.field.canonicalString(),increment:n.gt};throw n9()})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:aN(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:n9()),r}function aK(e,t){var n;let r=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?s1.updateTime(aR(n.updateTime)):void 0!==n.exists?s1.exists(n.exists):s1.none():s1.none(),i=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?("REQUEST_TIME"===t.setToServerValue||n9(),n=new sz):"appendMissingElements"in t?n=new sG(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new sQ(t.removeAllFromArray.values||[]):"increment"in t?n=new sX(e,t.increment):n9(),new sZ(rv.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=aP(e,t.update.name),s=new iW({mapValue:{fields:t.update.fields}});return t.updateMask?new s9(n,s,new iw((t.updateMask.fieldPaths||[]).map(e=>rv.fromServerFormat(e))),r,i):new s8(n,s,r,i)}return t.delete?new an(aP(e,t.delete),r):t.verify?new ar(aP(e,t.verify),r):n9()}function az(e,t){return{documents:[aF(e,t.path)]}}function aG(e,t){var n,r;let i={structuredQuery:{}},s=t.path;null!==t.collectionGroup?(i.parent=aF(e,s),i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i.parent=aF(e,s.popLast()),i.structuredQuery.from=[{collectionId:s.lastSegment()}]);let a=function(e){if(0!==e.length)return function e(t){return t instanceof i2?function(e){if("=="===e.op){if(i$(e.value))return{unaryFilter:{field:aQ(e.field),op:"IS_NAN"}};if(ij(e.value))return{unaryFilter:{field:aQ(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(i$(e.value))return{unaryFilter:{field:aQ(e.field),op:"IS_NOT_NAN"}};if(ij(e.value))return{unaryFilter:{field:aQ(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aQ(e.field),op:a_[e.op],value:e.value}}}(t):t instanceof i6?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:aC[t.op],filters:n}}}(t):n9()}(i6.create(e,"and"))}(t.filters);a&&(i.structuredQuery.where=a);let o=function(e){if(0!==e.length)return e.map(e=>({field:aQ(e.field),direction:aS[e.dir]}))}(t.orderBy);o&&(i.structuredQuery.orderBy=o);let l=aA(e,t.limit);return null!==l&&(i.structuredQuery.limit=l),t.startAt&&(i.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(i.structuredQuery.endAt={before:!(r=t.endAt).inclusive,values:r.position}),i}function aH(e){var t;let n,r=aV(e.parent),i=e.structuredQuery,s=i.from?i.from.length:0,a=null;if(s>0){1===s||n9();let e=i.from[0];e.allDescendants?a=e.collectionId:r=r.child(e.collectionId)}let o=[];i.where&&(o=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=aW(e.unaryFilter.field);return i2.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=aW(e.unaryFilter.field);return i2.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=aW(e.unaryFilter.field);return i2.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aW(e.unaryFilter.field);return i2.create(i,"!=",{nullValue:"NULL_VALUE"});default:return n9()}}(t):void 0!==t.fieldFilter?i2.create(aW(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return n9()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?i6.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return n9()}}(t.compositeFilter.op)):n9()}(e);return t instanceof i6&&i5(t)?t.getFilters():[t]}(i.where));let l=[];i.orderBy&&(l=i.orderBy.map(e=>new i0(aW(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let u=null;i.limit&&(u=null==(n="object"==typeof(t=i.limit)?t.value:t)?null:n);let h=null;i.startAt&&(h=function(e){let t=!!e.before;return new iY(e.values||[],t)}(i.startAt));let c=null;return i.endAt&&(c=function(e){let t=!e.before;return new iY(e.values||[],t)}(i.endAt)),new sm(r,a,l,o,u,"F",h,c)}function aQ(e){return{fieldPath:e.canonicalString()}}function aW(e){return rv.fromServerFormat(e.fieldPath)}function aX(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aY{constructor(e,t,n,r,i=rg.min(),s=rg.min(),a=iI.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new aY(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aY(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class aJ{constructor(e){this.fe=e}}function aZ(e,t){let n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:a0(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var i;r.document={name:aL(i=e.fe,t.key),fields:t.data.value.mapValue.fields,updateTime:aN(i,t.version.toTimestamp()),createTime:aN(i,t.createTime.toTimestamp())}}else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:a1(t.version)};else{if(!t.isUnknownDocument())return n9();r.unknownDocument={path:n.path.toArray(),version:a1(t.version)}}return r}function a0(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function a1(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function a2(e){let t=new rd(e.seconds,e.nanoseconds);return rg.fromTimestamp(t)}function a6(e,t){let n=(t.baseMutations||[]).map(t=>aK(e.fe,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let r=t.mutations.map(t=>aK(e.fe,t)),i=rd.fromMillis(t.localWriteTimeMs);return new ai(t.batchId,i,n,r)}function a4(e){var t;let n;let r=a2(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?a2(e.lastLimboFreeSnapshotVersion):rg.min();return void 0!==e.query.documents?(1===(t=e.query).documents.length||n9(),n=sE(sp(aV(t.documents[0])))):n=sE(aH(e.query)),new aY(n,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,i,iI.fromBase64String(e.resumeToken))}function a3(e,t){let n;let r=a1(t.snapshotVersion),i=a1(t.lastLimboFreeSnapshotVersion);n=sc(t.target)?az(e.fe,t.target):aG(e.fe,t.target);let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:su(t.target),readTime:r,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function a5(e){let t=aH({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?sx(t,t.limit,"L"):t}function a8(e,t){return new aa(t.largestBatchId,aK(e.fe,t.overlayMutation))}function a9(e,t){let n=t.path.lastSegment();return[e,rQ(t.path.popLast()),n]}function a7(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:a1(r.readTime),documentKey:rQ(r.documentKey.path),largestBatchId:r.largestBatchId}}class oe{getBundleMetadata(e,t){return ot(e).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:a2(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return ot(e).put({bundleId:t.id,createTime:a1(aR(t.createTime)),version:t.version})}getNamedQuery(e,t){return on(e).get(t).next(e=>{if(e)return{name:e.name,query:a5(e.bundledQuery),readTime:a2(e.readTime)}})}saveNamedQuery(e,t){return on(e).put({name:t.name,readTime:a1(aR(t.readTime)),bundledQuery:t.bundledQuery})}}function ot(e){return il(e,"bundles")}function on(e){return il(e,"namedQueries")}class or{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){return new or(e,t.uid||"")}getOverlay(e,t){return oi(e).get(a9(this.userId,t)).next(e=>e?a8(this.serializer,e):null)}getOverlays(e,t){let n=sP();return rR.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let r=[];return n.forEach((n,i)=>{let s=new aa(t,i);r.push(this.we(e,s))}),rR.waitFor(r)}removeOverlaysForBatchId(e,t,n){let r=new Set;t.forEach(e=>r.add(rQ(e.getCollectionPath())));let i=[];return r.forEach(t=>{let r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(oi(e).J("collectionPathOverlayIndex",r))}),rR.waitFor(i)}getOverlaysForCollection(e,t,n){let r=sP(),i=rQ(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return oi(e).j("collectionPathOverlayIndex",s).next(e=>{for(let t of e){let e=a8(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,r){let i;let s=sP(),a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return oi(e).X({index:"collectionGroupOverlayIndex",range:a},(e,t,n)=>{let a=a8(this.serializer,t);s.size()<r||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):n.done()}).next(()=>s)}we(e,t){return oi(e).put(function(e,t,n){let[r,i,s]=a9(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:a$(e.fe,n.mutation)}}(this.serializer,this.userId,t))}}function oi(e){return il(e,"documentOverlays")}class os{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(ix(e.integerValue));else if("doubleValue"in e){let n=ix(e.doubleValue);isNaN(n)?this.ye(t,13):(this.ye(t,15),rG(n)?t.pe(0):t.pe(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ye(t,20),"string"==typeof n?t.Ie(n):(t.Ie(`${n.seconds||""}`),t.pe(n.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(iS(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.ye(t,45),t.pe(n.latitude||0),t.pe(n.longitude||0)}else"mapValue"in e?iG(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):n9()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){let n=e.fields||{};for(let e of(this.ye(t,55),Object.keys(n)))this.Te(e,t),this.me(n[e],t)}Pe(e,t){let n=e.values||[];for(let e of(this.ye(t,50),n))this.me(e,t)}ve(e,t){this.ye(t,37),rw.fromName(e).path.forEach(e=>{this.ye(t,60),this.be(e,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function oa(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[n]);if(t+=r,8!==r)break}return t}(e))/8)}os.Ve=new os;class oo{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.De(n.value),n=t.next();this.Ce()}xe(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Ne(n.value),n=t.next();this.ke()}Me(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.De(e);else if(e<2048)this.De(960|e>>>6),this.De(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.De(480|e>>>12),this.De(128|63&e>>>6),this.De(128|63&e);else{let e=t.codePointAt(0);this.De(240|e>>>18),this.De(128|63&e>>>12),this.De(128|63&e>>>6),this.De(128|63&e)}}this.Ce()}$e(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Ne(e);else if(e<2048)this.Ne(960|e>>>6),this.Ne(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e);else{let e=t.codePointAt(0);this.Ne(240|e>>>18),this.Ne(128|63&e>>>12),this.Ne(128|63&e>>>6),this.Ne(128|63&e)}}this.ke()}Oe(e){let t=this.Fe(e),n=oa(t);this.Be(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Le(e){let t=this.Fe(e),n=oa(t);this.Be(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}De(e){let t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){let t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ol{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class ou{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class oh{constructor(){this.je=new oo,this.ze=new ol(this.je),this.We=new ou(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class oc{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Je(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new oc(this.indexId,this.documentKey,this.arrayValue,n)}}function of(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=od(e.arrayValue,t.arrayValue))?n:0!==(n=od(e.directionalValue,t.directionalValue))?n:rw.comparator(e.documentKey,t.documentKey)}function od(e,t){for(let n=0;n<e.length&&n<t.length;++n){let r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class og{constructor(e){for(let t of(this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[],e.filters))t.isInequality()?this.Ze=t:this.Xe.push(t)}tn(e){e.collectionGroup===this.collectionId||n9();let t=rI(e);if(void 0!==t&&!this.en(t))return!1;let n=rE(e),r=new Set,i=0,s=0;for(;i<n.length&&this.en(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(void 0!==this.Ze){if(!r.has(this.Ze.field.canonicalString())){let e=n[i];if(!this.nn(this.Ze,e)||!this.sn(this.Ye[s++],e))return!1}++i}for(;i<n.length;++i){let e=n[i];if(s>=this.Ye.length||!this.sn(this.Ye[s++],e))return!1}return!0}en(e){for(let t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function om(e){return e instanceof i2}function op(e){return e instanceof i6&&i5(e)}function oy(e){return om(e)||op(e)||function(e){if(e instanceof i6&&i3(e)){for(let t of e.getFilters())if(!om(t)&&!op(t))return!1;return!0}return!1}(e)}function ov(e,t){return e instanceof i2||e instanceof i6||n9(),t instanceof i2||t instanceof i6||n9(),ob(e instanceof i2?t instanceof i2?i6.create([e,t],"and"):ow(e,t):t instanceof i2?ow(t,e):function(e,t){if(e.filters.length>0&&t.filters.length>0||n9(),i4(e)&&i4(t))return i9(e,t.getFilters());let n=i3(e)?e:t,r=i3(e)?t:e,i=n.filters.map(e=>ov(e,r));return i6.create(i,"or")}(e,t))}function ow(e,t){if(i4(t))return i9(t,e.getFilters());{let n=t.filters.map(t=>ov(e,t));return i6.create(n,"or")}}function ob(e){if(e instanceof i2||e instanceof i6||n9(),e instanceof i2)return e;let t=e.getFilters();if(1===t.length)return ob(t[0]);if(i8(e))return e;let n=t.map(e=>ob(e)),r=[];return n.forEach(t=>{t instanceof i2?r.push(t):t instanceof i6&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:i6.create(r,e.op)}class oI{constructor(){this.rn=new oE}addToCollectionParentIndex(e,t){return this.rn.add(t),rR.resolve()}getCollectionParents(e,t){return rR.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return rR.resolve()}deleteFieldIndex(e,t){return rR.resolve()}getDocumentsMatchingTarget(e,t){return rR.resolve(null)}getIndexType(e,t){return rR.resolve(0)}getFieldIndexes(e,t){return rR.resolve([])}getNextCollectionGroupToUpdate(e){return rR.resolve(null)}getMinOffset(e,t){return rR.resolve(rC.min())}getMinOffsetFromCollectionGroup(e,t){return rR.resolve(rC.min())}updateCollectionGroup(e,t,n){return rR.resolve()}updateIndexEntries(e,t){return rR.resolve()}}class oE{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ip(rp.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new ip(rp.comparator)).toArray()}}let oT=new Uint8Array(0);class ox{constructor(e,t){this.user=e,this.databaseId=t,this.on=new oE,this.un=new sk(e=>su(e),(e,t)=>sh(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){let n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});let i={collectionId:n,parent:rQ(r)};return oS(e).put(i)}return rR.resolve()}getCollectionParents(e,t){let n=[],r=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return oS(e).j(r).next(e=>{for(let r of e){if(r.collectionId!==t)break;n.push(rW(r.parent))}return n})}addFieldIndex(e,t){let n=oC(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete r.indexId;let i=n.add(r);if(t.indexState){let n=oD(e);return i.next(e=>{n.put(a7(e,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){let n=oC(e),r=oD(e),i=o_(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){let n=o_(e),r=!0,i=new Map;return rR.forEach(this.cn(t),t=>this.an(e,t).next(e=>{r&&(r=!!e),i.set(t,e)})).next(()=>{if(r){let e=sU(),r=[];return rR.forEach(i,(i,s)=>{n4("IndexedDbIndexManager",`Using index id=${i.indexId}|cg=${i.collectionGroup}|f=${i.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${su(t)}`);let a=function(e,t){let n=rI(t);if(void 0===n)return null;for(let t of sf(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),o=function(e,t){let n=new Map;for(let r of rE(t))for(let t of sf(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),l=function(e,t){let n=[],r=!0;for(let i of rE(t)){let t=0===i.kind?sd(e,i.fieldPath,e.startAt):sg(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new iY(n,r)}(s,i),u=function(e,t){let n=[],r=!0;for(let i of rE(t)){let t=0===i.kind?sg(e,i.fieldPath,e.endAt):sd(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new iY(n,r)}(s,i),h=this.hn(i,s,l),c=this.hn(i,s,u),f=this.ln(i,s,o),d=this.fn(i.indexId,a,h,l.inclusive,c,u.inclusive,f);return rR.forEach(d,i=>n.H(i,t.limit).next(t=>{t.forEach(t=>{let n=rw.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))})}))}).next(()=>r)}return rR.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(t instanceof i2||t instanceof i6||n9(),t instanceof i2)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),r=i6.create(n,t.op);return oy(r=ob(r))?r:(r instanceof i6||n9(),i4(r)||n9(),r.filters.length>1||n9(),r.filters.reduce((e,t)=>ov(e,t)))}(function e(t){var n,r;if(t instanceof i2||t instanceof i6||n9(),t instanceof i2){if(t instanceof si){let e=(null===(r=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>i2.create(t.field,"==",e)))||[];return i6.create(e,"or")}return t}let i=t.filters.map(t=>e(t));return i6.create(i,t.op)}(e));return oy(t)||n9(),om(t)||op(t)?[t]:t.getFilters()})(i6.create(e.filters,"and")).map(t=>sl(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t)),t}fn(e,t,n,r,i,s,a){let o=(null!=t?t.length:1)*Math.max(n.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let h=0;h<o;++h){let o=t?this.dn(t[h/l]):oT,c=this.wn(e,o,n[h%l],r),f=this._n(e,o,i[h%l],s),d=a.map(t=>this.wn(e,o,t,!0));u.push(...this.createRange(c,f,d))}return u}wn(e,t,n,r){let i=new oc(e,rw.empty(),t,n);return r?i:i.Je()}_n(e,t,n,r){let i=new oc(e,rw.empty(),t,n);return r?i.Je():i}an(e,t){let n=new og(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(let r of e)n.tn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let n=2,r=this.cn(t);return rR.forEach(r,t=>this.an(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new ip(rv.comparator),n=!1;for(let r of e.filters)for(let e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&r.length>1&&2===n?1:n)}mn(e,t){let n=new oh;for(let r of rE(e)){let e=t.data.field(r.fieldPath);if(null==e)return null;let i=n.He(r.kind);os.Ve._e(e,i)}return n.Qe()}dn(e){let t=new oh;return os.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){let n=new oh;return os.Ve._e(iU(this.databaseId,t),n.He(function(e){let t=rE(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Qe()}ln(e,t,n){if(null===n)return[];let r=[];r.push(new oh);let i=0;for(let s of rE(e)){let e=n[i++];for(let n of r)if(this.yn(t,s.fieldPath)&&iq(e))r=this.pn(r,s,e);else{let t=n.He(s.kind);os.Ve._e(e,t)}}return this.In(r)}hn(e,t,n){return this.ln(e,t,n.position)}In(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Qe();return t}pn(e,t,n){let r=[...e],i=[];for(let e of n.arrayValue.values||[])for(let n of r){let r=new oh;r.seed(n.Qe()),os.Ve._e(e,r.He(t.kind)),i.push(r)}return i}yn(e,t){return!!e.filters.find(e=>e instanceof i2&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=oC(e),r=oD(e);return(t?n.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.j()).next(e=>{let t=[];return rR.forEach(e,e=>r.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new rx(t.sequenceNumber,new rC(a2(t.readTime),new rw(rW(t.documentKey)),t.largestBatchId)):rx.empty(),r=e.fields.map(([e,t])=>new rT(rv.fromServerFormat(e),t));return new rb(e.indexId,e.collectionGroup,r,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:rc(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let r=oC(e),i=oD(e);return this.Tn(e).next(e=>r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(t=>rR.forEach(t,t=>i.put(a7(t.indexId,this.user,e,n)))))}updateIndexEntries(e,t){let n=new Map;return rR.forEach(t,(t,r)=>{let i=n.get(t.collectionGroup);return(i?rR.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(n.set(t.collectionGroup,i),rR.forEach(i,n=>this.En(e,t,n).next(t=>{let i=this.An(r,n);return t.isEqual(i)?rR.resolve():this.vn(e,r,n,t,i)}))))})}Rn(e,t,n,r){return o_(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.gn(n,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,n,r){return o_(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.gn(n,t.key),t.key.path.toArray()])}En(e,t,n){let r=o_(e),i=new ip(of);return r.X({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.gn(n,t)])},(e,r)=>{i=i.add(new oc(n.indexId,t,r.arrayValue,r.directionalValue))}).next(()=>i)}An(e,t){let n=new ip(of),r=this.mn(t,e);if(null==r)return n;let i=rI(t);if(null!=i){let s=e.data.field(i.fieldPath);if(iq(s))for(let i of s.arrayValue.values||[])n=n.add(new oc(t.indexId,e.key,this.dn(i),r))}else n=n.add(new oc(t.indexId,e.key,oT,r));return n}vn(e,t,n,r,i){n4("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,r,i){let s=e.getIterator(),a=t.getIterator(),o=iv(s),l=iv(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let r=n(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=iv(a)):t?(i(o),o=iv(s)):(o=iv(s),l=iv(a))}}(r,i,of,r=>{s.push(this.Rn(e,t,n,r))},r=>{s.push(this.Pn(e,t,n,r))}),rR.waitFor(s)}Tn(e){let t=1;return oD(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,r)=>{r.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>of(e,t)).filter((e,t,n)=>!t||0!==of(e,n[t-1]));let r=[];for(let i of(r.push(e),n)){let n=of(i,e),s=of(i,t);if(0===n)r[0]=e.Je();else if(n>0&&s<0)r.push(i),r.push(i.Je());else if(s>0)break}r.push(t);let i=[];for(let e=0;e<r.length;e+=2){if(this.bn(r[e],r[e+1]))return[];let t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,oT,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,oT,[]];i.push(IDBKeyRange.bound(t,n))}return i}bn(e,t){return of(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(oA)}getMinOffset(e,t){return rR.mapArray(this.cn(t),t=>this.an(e,t).next(e=>e||n9())).next(oA)}}function oS(e){return il(e,"collectionParents")}function o_(e){return il(e,"indexEntries")}function oC(e){return il(e,"indexConfiguration")}function oD(e){return il(e,"indexState")}function oA(e){0!==e.length||n9();let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){let i=e[r].indexState.offset;0>rD(i,t)&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new rC(t.readTime,t.documentKey,n)}let oN={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ok{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ok(e,ok.DEFAULT_COLLECTION_PERCENTILE,ok.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function oR(e,t,n){let r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId),o=0,l=r.X({range:a},(e,t,n)=>(o++,n.delete()));s.push(l.next(()=>{1===o||n9()}));let u=[];for(let e of n.mutations){var h,c;let r=(h=e.key.path,c=n.batchId,[t,rQ(h),c]);s.push(i.delete(r)),u.push(e.key)}return rR.waitFor(s).next(()=>u)}function oO(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw n9();t=e.noDocument}return JSON.stringify(t).length}ok.DEFAULT_COLLECTION_PERCENTILE=10,ok.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ok.DEFAULT=new ok(0x2800000,ok.DEFAULT_COLLECTION_PERCENTILE,ok.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ok.DISABLED=new ok(-1,0,0);class oM{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Vn={}}static de(e,t,n,r){return""!==e.uid||n9(),new oM(e.isAuthenticated()?e.uid:"",t,n,r)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return oP(e).X({index:"userMutationsIndex",range:n},(e,n,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,n,r){let i=oF(e),s=oP(e);return s.add({}).next(a=>{"number"==typeof a||n9();let o=new ai(a,t,n,r),l=function(e,t,n){let r=n.baseMutations.map(t=>a$(e.fe,t)),i=n.mutations.map(t=>a$(e.fe,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,o),u=[],h=new ip((e,t)=>rc(e.canonicalString(),t.canonicalString()));for(let e of r){let t=[this.userId,rQ(e.key.path),a];h=h.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,rY))}return h.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Vn[a]=o.keys()}),rR.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return oP(e).get(t).next(e=>e?(e.userId===this.userId||n9(),a6(this.serializer,e)):null)}Sn(e,t){return this.Vn[t]?rR.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.Vn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]),i=null;return oP(e).X({index:"userMutationsIndex",range:r},(e,t,r)=>{t.userId===this.userId&&(t.batchId>=n||n9(),i=a6(this.serializer,t)),r.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return oP(e).X({index:"userMutationsIndex",range:t,reverse:!0},(e,t,r)=>{n=t.batchId,r.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return oP(e).j("userMutationsIndex",t).next(e=>e.map(e=>a6(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,rQ(t.path)],r=IDBKeyRange.lowerBound(n),i=[];return oF(e).X({range:r},(n,r,s)=>{let[a,o,l]=n,u=rW(o);if(a===this.userId&&t.path.isEqual(u))return oP(e).get(l).next(e=>{if(!e)throw n9();e.userId===this.userId||n9(),i.push(a6(this.serializer,e))});s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ip(rc),r=[];return t.forEach(t=>{let i=[this.userId,rQ(t.path)],s=IDBKeyRange.lowerBound(i),a=oF(e).X({range:s},(e,r,i)=>{let[s,a,o]=e,l=rW(a);s===this.userId&&t.path.isEqual(l)?n=n.add(o):i.done()});r.push(a)}),rR.waitFor(r).next(()=>this.Dn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=[this.userId,rQ(n)],s=IDBKeyRange.lowerBound(i),a=new ip(rc);return oF(e).X({range:s},(e,t,i)=>{let[s,o,l]=e,u=rW(o);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(a=a.add(l)):i.done()}).next(()=>this.Dn(e,a))}Dn(e,t){let n=[],r=[];return t.forEach(t=>{r.push(oP(e).get(t).next(e=>{if(null===e)throw n9();e.userId===this.userId||n9(),n.push(a6(this.serializer,e))}))}),rR.waitFor(r).next(()=>n)}removeMutationBatch(e,t){return oR(e.ht,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),rR.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rR.resolve();let n=IDBKeyRange.lowerBound([this.userId]),r=[];return oF(e).X({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=rW(e[1]);r.push(t)}else n.done()}).next(()=>{0===r.length||n9()})})}containsKey(e,t){return oL(e,this.userId,t)}xn(e){return oV(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function oL(e,t,n){let r=[t,rQ(n.path)],i=r[1],s=IDBKeyRange.lowerBound(r),a=!1;return oF(e).X({range:s,Y:!0},(e,n,r)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),r.done()}).next(()=>a)}function oP(e){return il(e,"mutations")}function oF(e){return il(e,"documentMutations")}function oV(e){return il(e,"mutationQueues")}class oU{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new oU(0)}static Mn(){return new oU(-1)}}class oB{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next(t=>{let n=new oU(t.highestTargetId);return t.highestTargetId=n.next(),this.On(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.$n(e).next(e=>rg.fromTimestamp(new rd(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.$n(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.$n(e).next(r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.On(e,r)))}addTargetData(e,t){return this.Fn(e,t).next(()=>this.$n(e).next(n=>(n.targetCount+=1,this.Bn(t,n),this.On(e,n))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oq(e).delete(t.targetId)).next(()=>this.$n(e)).next(t=>(t.targetCount>0||n9(),t.targetCount-=1,this.On(e,t)))}removeTargets(e,t,n){let r=0,i=[];return oq(e).X((s,a)=>{let o=a4(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))}).next(()=>rR.waitFor(i)).next(()=>r)}forEachTarget(e,t){return oq(e).X((e,n)=>{t(a4(n))})}$n(e){return oj(e).get("targetGlobalKey").next(e=>(null!==e||n9(),e))}On(e,t){return oj(e).put("targetGlobalKey",t)}Fn(e,t){return oq(e).put(a3(this.serializer,t))}Bn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.$n(e).next(e=>e.targetCount)}getTargetData(e,t){let n=su(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return oq(e).X({range:r,index:"queryTargetsIndex"},(e,n,r)=>{let s=a4(n);sh(t,s.target)&&(i=s,r.done())}).next(()=>i)}addMatchingKeys(e,t,n){let r=[],i=o$(e);return t.forEach(t=>{let s=rQ(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))}),rR.waitFor(r)}removeMatchingKeys(e,t,n){let r=o$(e);return rR.forEach(t,t=>{let i=rQ(t.path);return rR.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=o$(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),r=o$(e),i=sU();return r.X({range:n,Y:!0},(e,t,n)=>{let r=new rw(rW(e[1]));i=i.add(r)}).next(()=>i)}containsKey(e,t){let n=rQ(t.path),r=IDBKeyRange.bound([n],[n+"\0"],!1,!0),i=0;return o$(e).X({index:"documentTargetsIndex",Y:!0,range:r},([e,t],n,r)=>{0!==e&&(i++,r.done())}).next(()=>i>0)}le(e,t){return oq(e).get(t).next(e=>e?a4(e):null)}}function oq(e){return il(e,"targets")}function oj(e){return il(e,"targetGlobal")}function o$(e){return il(e,"targetDocuments")}function oK([e,t],[n,r]){let i=rc(e,n);return 0===i?rc(t,r):i}class oz{constructor(e){this.Ln=e,this.buffer=new ip(oK),this.qn=0}Un(){return++this.qn}Kn(e){let t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>oK(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class oG{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){n4("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Gn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rF(e)?n4("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await rk(e)}await this.Qn(3e5)})}}class oH{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rR.resolve(rK.ct);let n=new oz(t);return this.jn.forEachTarget(e,e=>n.Kn(e.sequenceNumber)).next(()=>this.jn.Wn(e,e=>n.Kn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(n4("LruGarbageCollector","Garbage collection skipped; disabled"),rR.resolve(oN)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(n4("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oN):this.Hn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let n,r,i,s,a,o,l;let u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(n4("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),n6()<=f.$b.DEBUG&&n4("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-u}ms
	Determined least recently used ${r} in `+(a-s)+"ms\n"+`	Removed ${i} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-u}ms`),rR.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class oQ{constructor(e,t){this.db=e,this.garbageCollector=new oH(this,t)}zn(e){let t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Jn(e){let t=0;return this.Wn(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,(e,n)=>t(n))}addReference(e,t,n){return oW(e,n)}removeReference(e,t,n){return oW(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return oW(e,t)}Xn(e,t){let n;return n=!1,oV(e).Z(r=>oL(e,r,t).next(e=>(e&&(n=!0),rR.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[],i=0;return this.Yn(e,(s,a)=>{if(a<=t){let t=this.Xn(e,s).next(t=>{if(!t)return i++,n.getEntry(e,s).next(()=>(n.removeEntry(s,rg.min()),o$(e).delete([0,rQ(s.path)])))});r.push(t)}}).next(()=>rR.waitFor(r)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return oW(e,t)}Yn(e,t){let n=o$(e),r,i=rK.ct;return n.X({index:"documentTargetsIndex"},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==rK.ct&&t(new rw(rW(r)),i),i=a,r=s):i=rK.ct}).next(()=>{i!==rK.ct&&t(new rw(rW(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function oW(e,t){var n;return o$(e).put((n=e.currentSequenceNumber,{targetId:0,path:rQ(t.path),sequenceNumber:n}))}class oX{constructor(){this.changes=new sk(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,iX.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?rR.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class oY{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return o0(e).put(n)}removeEntry(e,t,n){return o0(e).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],a0(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.Zn(e,n)))}getEntry(e,t){let n=iX.newInvalidDocument(t);return o0(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(o1(t))},(e,r)=>{n=this.ts(t,r)}).next(()=>n)}es(e,t){let n={size:0,document:iX.newInvalidDocument(t)};return o0(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(o1(t))},(e,r)=>{n={document:this.ts(t,r),size:oO(r)}}).next(()=>n)}getEntries(e,t){let n=sR;return this.ns(e,t,(e,t)=>{let r=this.ts(e,t);n=n.insert(e,r)}).next(()=>n)}ss(e,t){let n=sR,r=new id(rw.comparator);return this.ns(e,t,(e,t)=>{let i=this.ts(e,t);n=n.insert(e,i),r=r.insert(e,oO(t))}).next(()=>({documents:n,rs:r}))}ns(e,t,n){if(t.isEmpty())return rR.resolve();let r=new ip(o6);t.forEach(e=>r=r.add(e));let i=IDBKeyRange.bound(o1(r.first()),o1(r.last())),s=r.getIterator(),a=s.getNext();return o0(e).X({index:"documentKeyIndex",range:i},(e,t,r)=>{let i=rw.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>o6(a,i);)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.G(o1(a)):r.done()}).next(()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,r){let i=t.path,s=[i.popLast().toArray(),i.lastSegment(),a0(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return o0(e).j(IDBKeyRange.bound(s,a,!0)).next(e=>{let n=sR;for(let i of e){let e=this.ts(rw.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(sD(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,r){let i=sR,s=o2(t,n),a=o2(t,rC.max());return o0(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},(e,t,n)=>{let s=this.ts(rw.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===r&&n.done()}).next(()=>i)}newChangeBuffer(e){return new oJ(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return oZ(e).get("remoteDocumentGlobalKey").next(e=>(e||n9(),e))}Zn(e,t){return oZ(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){let e=function(e,t){let n;if(t.document)n=aj(e.fe,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=rw.fromSegments(t.noDocument.path),r=a2(t.noDocument.readTime);n=iX.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return n9();{let e=rw.fromSegments(t.unknownDocument.path),r=a2(t.unknownDocument.version);n=iX.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){let t=new rd(e[0],e[1]);return rg.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(rg.min())))return e}return iX.newInvalidDocument(e)}}class oJ extends oX{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new sk(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,r=new ip((e,t)=>rc(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.us.get(i);if(t.push(this.os.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=aZ(this.os.serializer,s);r=r.add(i.path.popLast());let l=oO(o);n+=l-a.size,t.push(this.os.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){let n=aZ(this.os.serializer,s.convertToNoDocument(rg.min()));t.push(this.os.addEntry(e,i,n))}}),r.forEach(n=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.os.updateMetadata(e,n)),rR.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next(e=>(this.us.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.os.ss(e,t).next(({documents:e,rs:t})=>(t.forEach((t,n)=>{this.us.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function oZ(e){return il(e,"remoteDocumentGlobal")}function o0(e){return il(e,"remoteDocumentsV14")}function o1(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function o2(e,t){let n=t.documentKey.path.toArray();return[e,a0(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function o6(e,t){let n=e.path.toArray(),r=t.path.toArray(),i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=rc(n[e],r[e]))return i;return(i=rc(n.length,r.length))||(i=rc(n[n.length-2],r[r.length-2]))||rc(n[n.length-1],r[r.length-1])}class o4{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class o3{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&s3(n.mutation,e,iw.empty(),rd.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,sU()).next(()=>t))}getLocalViewOfDocuments(e,t,n=sU()){let r=sP();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=sM();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=sP();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,sU()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=sR,s=sP(),a=sP();return t.forEach((e,t)=>{let a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof s9)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),s3(a.mutation,t,a.mutation.getFieldMask(),rd.now())):s.set(t.key,iw.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new o4(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=sP(),r=new id((e,t)=>e-t),i=sU();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||iw.empty();a=i.applyToLocalView(s,a),n.set(e,a);let o=(r.get(i.batchId)||sU()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{let s=[],a=r.getReverseIterator();for(;a.hasNext();){let r=a.getNext(),o=r.key,l=r.value,u=sP();l.forEach(e=>{if(!i.has(e)){let r=s4(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return rR.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n){return rw.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):sb(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):rR.resolve(sP()),a=-1,o=i;return s.next(t=>rR.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?rR.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,sU())).next(e=>({batchId:a,changes:sL(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new rw(t)).next(e=>{let t=sM();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n){let r=t.collectionGroup,i=sM();return this.indexManager.getCollectionParents(e,r).next(s=>rR.forEach(s,s=>{let a=new sm(s.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r))).next(e=>{r.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,iX.newInvalidDocument(r)))});let n=sM();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&s3(s.mutation,i,iw.empty(),rd.now()),sD(t,i)&&(n=n.insert(e,i))}),n})}}class o5{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return rR.resolve(this.cs.get(t))}saveBundleMetadata(e,t){return this.cs.set(t.id,{id:t.id,version:t.version,createTime:aR(t.createTime)}),rR.resolve()}getNamedQuery(e,t){return rR.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,{name:t.name,query:a5(t.bundledQuery),readTime:aR(t.readTime)}),rR.resolve()}}class o8{constructor(){this.overlays=new id(rw.comparator),this.ls=new Map}getOverlay(e,t){return rR.resolve(this.overlays.get(t))}getOverlays(e,t){let n=sP();return rR.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.we(e,t,r)}),rR.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.ls.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.ls.delete(n)),rR.resolve()}getOverlaysForCollection(e,t,n){let r=sP(),i=t.length+1,s=new rw(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return rR.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new id((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=sP(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=sP(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return rR.resolve(a)}we(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.ls.get(r.largestBatchId).delete(n.key);this.ls.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new aa(t,n));let i=this.ls.get(t);void 0===i&&(i=sU(),this.ls.set(t,i)),this.ls.set(t,i.add(n.key))}}class o9{constructor(){this.fs=new ip(o7.ds),this.ws=new ip(o7._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){let n=new o7(e,t);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ys(new o7(e,t))}ps(e,t){e.forEach(e=>this.removeReference(e,t))}Is(e){let t=new rw(new rp([])),n=new o7(t,e),r=new o7(t,e+1),i=[];return this.ws.forEachInRange([n,r],e=>{this.ys(e),i.push(e.key)}),i}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){let t=new rw(new rp([])),n=new o7(t,e),r=new o7(t,e+1),i=sU();return this.ws.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new o7(e,0),n=this.fs.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class o7{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return rw.comparator(e.key,t.key)||rc(e.As,t.As)}static _s(e,t){return rc(e.As,t.As)||rw.comparator(e.key,t.key)}}class le{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new ip(o7.ds)}checkEmpty(e){return rR.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ai(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Rs=this.Rs.add(new o7(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return rR.resolve(s)}lookupMutationBatch(e,t){return rR.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.bs(t+1),r=n<0?0:n;return rR.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return rR.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return rR.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new o7(t,0),r=new o7(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,r],e=>{let t=this.Ps(e.As);i.push(t)}),rR.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new ip(rc);return t.forEach(e=>{let t=new o7(e,0),r=new o7(e,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([t,r],e=>{n=n.add(e.As)})}),rR.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;rw.isDocumentKey(i)||(i=i.child(""));let s=new o7(new rw(i),0),a=new ip(rc);return this.Rs.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.As)),!0)},s),rR.resolve(this.Vs(a))}Vs(e){let t=[];return e.forEach(e=>{let n=this.Ps(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){0===this.Ss(t.batchId,"removed")||n9(),this.mutationQueue.shift();let n=this.Rs;return rR.forEach(t.mutations,r=>{let i=new o7(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Rs=n})}Cn(e){}containsKey(e,t){let n=new o7(t,0),r=this.Rs.firstAfterOrEqual(n);return rR.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rR.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){let t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lt{constructor(e){this.Ds=e,this.docs=new id(rw.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Ds(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return rR.resolve(n?n.document.mutableCopy():iX.newInvalidDocument(t))}getEntries(e,t){let n=sR;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():iX.newInvalidDocument(e))}),rR.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=sR,s=t.path,a=new rw(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=rD(r_(a),n)||(r.has(a.key)||sD(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return rR.resolve(i)}getAllFromCollectionGroup(e,t,n,r){n9()}Cs(e,t){return rR.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ln(this)}getSize(e){return rR.resolve(this.size)}}class ln extends oX{constructor(e){super(),this.os=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.os.addEntry(e,r)):this.os.removeEntry(n)}),rR.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class lr{constructor(e){this.persistence=e,this.xs=new sk(e=>su(e),sh),this.lastRemoteSnapshotVersion=rg.min(),this.highestTargetId=0,this.Ns=0,this.ks=new o9,this.targetCount=0,this.Ms=oU.kn()}forEachTarget(e,t){return this.xs.forEach((e,n)=>t(n)),rR.resolve()}getLastRemoteSnapshotVersion(e){return rR.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rR.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),rR.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ns&&(this.Ns=t),rR.resolve()}Fn(e){this.xs.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Ms=new oU(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,rR.resolve()}updateTargetData(e,t){return this.Fn(t),rR.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,rR.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.xs.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.xs.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),rR.waitFor(i).next(()=>r)}getTargetCount(e){return rR.resolve(this.targetCount)}getTargetData(e,t){let n=this.xs.get(t)||null;return rR.resolve(n)}addMatchingKeys(e,t,n){return this.ks.gs(t,n),rR.resolve()}removeMatchingKeys(e,t,n){this.ks.ps(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),rR.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),rR.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ks.Es(t);return rR.resolve(n)}containsKey(e,t){return rR.resolve(this.ks.containsKey(t))}}class li{constructor(e,t){this.$s={},this.overlays={},this.Os=new rK(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new lr(this),this.indexManager=new oI,this.remoteDocumentCache=new lt(e=>this.referenceDelegate.Ls(e)),this.serializer=new aJ(t),this.qs=new o5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new o8,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.$s[e.toKey()];return n||(n=new le(t,this.referenceDelegate),this.$s[e.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,n){n4("MemoryPersistence","Starting transaction:",e);let r=new ls(this.Os.next());return this.referenceDelegate.Us(),n(r).next(e=>this.referenceDelegate.Ks(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Gs(e,t){return rR.or(Object.values(this.$s).map(n=>()=>n.containsKey(e,t)))}}class ls extends rN{constructor(e){super(),this.currentSequenceNumber=e}}class la{constructor(e){this.persistence=e,this.Qs=new o9,this.js=null}static zs(e){return new la(e)}get Ws(){if(this.js)return this.js;throw n9()}addReference(e,t,n){return this.Qs.addReference(n,t),this.Ws.delete(n.toString()),rR.resolve()}removeReference(e,t,n){return this.Qs.removeReference(n,t),this.Ws.add(n.toString()),rR.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),rR.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(e=>this.Ws.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Ws.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rR.forEach(this.Ws,n=>{let r=rw.fromPath(n);return this.Hs(e,r).next(e=>{e||t.removeEntry(r,rg.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(e=>{e?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return rR.or([()=>rR.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class lo{constructor(e,t){this.persistence=e,this.Js=new sk(e=>rQ(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new oH(this,t)}static zs(e,t){return new lo(e,t)}Us(){}Ks(e){return rR.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}zn(e){let t=this.Jn(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Jn(e){let t=0;return this.Wn(e,e=>{t++}).next(()=>t)}Wn(e,t){return rR.forEach(this.Js,(n,r)=>this.Xn(e,n,r).next(e=>e?rR.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.Cs(e,r=>this.Xn(e,r,t).next(e=>{e||(n++,i.removeEntry(r,rg.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Js.set(t,e.currentSequenceNumber),rR.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Js.set(n,e.currentSequenceNumber),rR.resolve()}removeReference(e,t,n){return this.Js.set(n,e.currentSequenceNumber),rR.resolve()}updateLimboDocument(e,t){return this.Js.set(t,e.currentSequenceNumber),rR.resolve()}Ls(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(iO(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=iC(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return iS(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:var r;let i;return r=t.mapValue,i=0,ih(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw n9()}}(e.data.value)),t}Xn(e,t,n){return rR.or([()=>this.persistence.Gs(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Js.get(t);return rR.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class ll{constructor(e){this.serializer=e}O(e,t,n,r){let i=new rO("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rX,{unique:!0}),e.createObjectStore("documentMutations"),lu(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=rR.resolve();return n<3&&r>=3&&(0!==n&&(e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal"),lu(e)),s=s.next(()=>(function(e){let t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:rg.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)})(i))),n<4&&r>=4&&(0!==n&&(s=s.next(()=>i.store("mutations").j().next(t=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rX,{unique:!0});let n=i.store("mutations"),r=t.map(e=>n.put(e));return rR.waitFor(r)}))),s=s.next(()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&r>=5&&(s=s.next(()=>this.Ys(i))),n<6&&r>=6&&(s=s.next(()=>((function(e){e.createObjectStore("remoteDocumentGlobal")})(e),this.Xs(i)))),n<7&&r>=7&&(s=s.next(()=>this.Zs(i))),n<8&&r>=8&&(s=s.next(()=>this.ti(e,i))),n<9&&r>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&r>=10&&(s=s.next(()=>this.ei(i))),n<11&&r>=11&&(s=s.next(()=>{(function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&r>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore("documentOverlays",{keyPath:r7});t.createIndex("collectionPathOverlayIndex",ie,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",it,{unique:!1})}(e)})),n<13&&r>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore("remoteDocumentsV14",{keyPath:rJ});t.createIndex("documentKeyIndex",rZ),t.createIndex("collectionGroupIndex",r0)})(e)).next(()=>this.ni(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&r>=14&&(s=s.next(()=>this.si(e,i))),n<15&&r>=15&&(s=s.next(()=>{e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:r3}).createIndex("sequenceNumberIndex",r5,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:r8}).createIndex("documentKeyIndex",r9,{unique:!1})})),s}Xs(e){let t=0;return e.store("remoteDocuments").X((e,n)=>{t+=oO(n)}).next(()=>{let n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Ys(e){let t=e.store("mutationQueues"),n=e.store("mutations");return t.j().next(t=>rR.forEach(t,t=>{let r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.j("userMutationsIndex",r).next(n=>rR.forEach(n,n=>{n.userId===t.userId||n9();let r=a6(this.serializer,n);return oR(e,t.userId,r).next(()=>{})}))}))}Zs(e){let t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(e=>{let r=[];return n.X((n,i)=>{let s=new rp(n),a=[0,rQ(s)];r.push(t.get(a).next(n=>n?rR.resolve():t.put({targetId:0,path:rQ(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>rR.waitFor(r))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:r4});let n=t.store("collectionParents"),r=new oE,i=e=>{if(r.add(e)){let t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:rQ(r)})}};return t.store("remoteDocuments").X({Y:!0},(e,t)=>i(new rp(e).popLast())).next(()=>t.store("documentMutations").X({Y:!0},([e,t,n],r)=>i(rW(t).popLast())))}ei(e){let t=e.store("targets");return t.X((e,n)=>{let r=a4(n),i=a3(this.serializer,r);return t.put(i)})}ni(e,t){let n=t.store("remoteDocuments"),r=[];return n.X((e,n)=>{let i=t.store("remoteDocumentsV14"),s=(n.document?new rw(rp.fromString(n.document.name).popFirst(5)):n.noDocument?rw.fromSegments(n.noDocument.path):n.unknownDocument?rw.fromSegments(n.unknownDocument.path):n9()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))}).next(()=>rR.waitFor(r))}si(e,t){let n=t.store("mutations"),r=new oY(this.serializer),i=new li(la.zs,this.serializer.fe);return n.j().next(e=>{let n=new Map;return e.forEach(e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:sU();a6(this.serializer,e).keys().forEach(e=>r=r.add(e)),n.set(e.userId,r)}),rR.forEach(n,(e,n)=>{let s=new n0(n),a=or.de(this.serializer,s),o=i.getIndexManager(s);return new o3(r,oM.de(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new io(t,rK.ct),e).next()})})}}function lu(e){e.createObjectStore("targetDocuments",{keyPath:r2}).createIndex("documentTargetsIndex",r6,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",r1,{unique:!0}),e.createObjectStore("targetGlobal")}let lh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class lc{constructor(e,t,n,r,i,s,a,o,l,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ii=i,this.window=s,this.document=a,this.ri=l,this.oi=u,this.ui=h,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!lc.D())throw new re(n7.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new oQ(this,r),this.di=t+"main",this.serializer=new aJ(o),this.wi=new rM(this.di,this.ui,new ll(this.serializer)),this.Bs=new oB(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new oY(this.serializer),this.qs=new oe,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===u&&n3("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new re(n7.FAILED_PRECONDITION,lh);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Bs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new rK(e,this.ri)}).then(()=>{this.Fs=!0}).catch(e=>(this.wi&&this.wi.close(),Promise.reject(e)))}Ii(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ld(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ti(e).next(e=>{e||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Ei(e)).next(t=>this.isPrimary&&!t?this.Ai(e).next(()=>!1):!!t&&this.vi(e).next(()=>!0))).catch(e=>{if(rF(e))return n4("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return n4("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Ti(e){return lf(e).get("owner").next(e=>rR.resolve(this.Ri(e)))}Pi(e){return ld(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Vi(this.li,18e5)){this.li=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=il(e,"clientMetadata");return t.j().next(e=>{let n=this.Si(e,18e5),r=e.filter(e=>-1===n.indexOf(e));return rR.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this._i)for(let t of e)this._i.removeItem(this.Di(t.clientId))}}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.bi()).then(()=>this.pi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?rR.resolve(!0):lf(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new re(n7.FAILED_PRECONDITION,lh);return!1}}return!(!this.networkEnabled||!this.inForeground)||ld(e).j().next(e=>void 0===this.Si(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&n4("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.Fs=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Ni(),this.ki(),await this.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new io(e,rK.ct);return this.Ai(t).next(()=>this.Pi(t))}),this.wi.close(),this.Mi()}Si(e,t){return e.filter(e=>this.Vi(e.updateTimeMs,t)&&!this.Ci(e.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>ld(e).j().next(e=>this.Si(e,18e5).map(e=>e.clientId)))}get started(){return this.Fs}getMutationQueue(e,t){return oM.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new ox(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return or.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,n){var r;let i;n4("IndexedDbPersistence","Starting transaction:",e);let s=15===(r=this.ui)?ia:14===r?is:13===r?is:12===r?ii:11===r?ir:void n9();return this.wi.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,r=>(i=new io(r,this.Os?this.Os.next():rK.ct),"readwrite-primary"===t?this.Ti(i).next(e=>!!e||this.Ei(i)).next(t=>{if(!t)throw n3(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)),new re(n7.FAILED_PRECONDITION,rA);return n(i)}).next(e=>this.vi(i).next(()=>e)):this.Oi(i).next(()=>n(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}Oi(e){return lf(e).get("owner").next(e=>{if(null!==e&&this.Vi(e.leaseTimestampMs,5e3)&&!this.Ci(e.ownerId)&&!this.Ri(e)&&!(this.oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new re(n7.FAILED_PRECONDITION,lh)})}vi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return lf(e).put("owner",t)}static D(){return rM.D()}Ai(e){let t=lf(e);return t.get("owner").next(e=>this.Ri(e)?(n4("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):rR.resolve())}Vi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(n3(`Detected an update time that is in the future: ${e} > ${n}`),!1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;(0,d.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{let n=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return n4("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return n3("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){n3("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch(e){}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function lf(e){return il(e,"owner")}function ld(e){return il(e,"clientMetadata")}function lg(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class lm{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Fi=n,this.Bi=r}static Li(e,t){let n=sU(),r=sU();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lm(e,t.fromCache,n,r)}}class lp{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,n,r){return this.Ki(e,t).next(i=>i||this.Gi(e,t,r,n)).next(n=>n||this.Qi(e,t))}Ki(e,t){if(sy(t))return rR.resolve(null);let n=sE(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=sE(t=sx(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=sU(...r);return this.Ui.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.ji(t,r);return this.zi(t,s,i,n.readTime)?this.Ki(e,sx(t,null,"F")):this.Wi(e,s,t,n)}))})))}Gi(e,t,n,r){return sy(t)||r.isEqual(rg.min())?this.Qi(e,t):this.Ui.getDocuments(e,n).next(i=>{let s=this.ji(t,i);return this.zi(t,s,n,r)?this.Qi(e,t):(n6()<=f.$b.DEBUG&&n4("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),sC(t)),this.Wi(e,s,t,rS(r,-1)))})}ji(e,t){let n=new ip(sN(e));return t.forEach((t,r)=>{sD(e,r)&&(n=n.add(r))}),n}zi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Qi(e,t){return n6()<=f.$b.DEBUG&&n4("QueryEngine","Using full collection scan to execute query:",sC(t)),this.Ui.getDocumentsMatchingQuery(e,t,rC.min())}Wi(e,t,n,r){return this.Ui.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class ly{constructor(e,t,n,r){this.persistence=e,this.Hi=t,this.serializer=r,this.Ji=new id(rc),this.Yi=new sk(e=>su(e),sh),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(n)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new o3(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}async function lv(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.tr(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],a=sU();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({er:e,removedBatchIds:i,addedBatchIds:s}))})})}function lw(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function lb(e,t,n){let r=sU(),i=sU();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=sR;return n.forEach((n,s)=>{let a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(rg.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):n4("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{nr:r,sr:i}})}function lI(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let r;return e.Bs.getTargetData(n,t).next(i=>i?(r=i,rR.resolve(r)):e.Bs.allocateTargetId(n).next(i=>(r=new aY(t,i,"TargetPurposeListen",n.currentSequenceNumber),e.Bs.addTargetData(n,r).next(()=>r))))}).then(n=>{let r=e.Ji.get(n.targetId);return(null===r||n.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(e.Ji=e.Ji.insert(n.targetId,n),e.Yi.set(t,n.targetId)),n})}async function lE(e,t,n){let r=e.Ji.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!rF(e))throw e;n4("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ji=e.Ji.remove(t),e.Yi.delete(r.target)}function lT(e,t,n){let r=rg.min(),i=sU();return e.persistence.runTransaction("Execute query","readonly",s=>(function(e,t,n){let r=e.Yi.get(n);return void 0!==r?rR.resolve(e.Ji.get(r)):e.Bs.getTargetData(t,n)})(e,s,sE(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Bs.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Hi.getDocumentsMatchingQuery(s,t,n?r:rg.min(),n?i:sU())).next(n=>(l_(e,sA(t),n),{documents:n,ir:i})))}function lx(e,t){let n=e.Bs,r=e.Ji.get(t);return r?Promise.resolve(r.target):e.persistence.runTransaction("Get target data","readonly",e=>n.le(e,t).next(e=>e?e.target:null))}function lS(e,t){let n=e.Xi.get(t)||rg.min();return e.persistence.runTransaction("Get new document changes","readonly",r=>e.Zi.getAllFromCollectionGroup(r,t,rS(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(l_(e,t,n),n))}function l_(e,t,n){let r=e.Xi.get(t)||rg.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Xi.set(t,r)}function lC(e,t){return`firestore_clients_${e}_${t}`}function lD(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function lA(e,t){return`firestore_targets_${e}_${t}`}class lN{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static ar(e,t,n){let r=JSON.parse(n),i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new re(r.error.code,r.error.message)),s?new lN(e,t,r.state,i):(n3("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}hr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lk{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static ar(e,t){let n=JSON.parse(t),r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new re(n.error.code,n.error.message)),i?new lk(e,n.state,r):(n3("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class lR{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){let n=JSON.parse(t),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=sB;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=rH(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new lR(e,i):(n3("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class lO{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new lO(t.clientId,t.onlineState):(n3("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lM{constructor(){this.activeTargetIds=sB}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lL{constructor(e,t,n,r,i){var s,a,o;this.window=e,this.ii=t,this.persistenceKey=n,this.wr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new id(rc),this.started=!1,this.yr=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pr=lC(this.persistenceKey,this.wr),this.Ir=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.gr=this.gr.insert(this.wr,new lM),this.Tr=RegExp(`^firestore_clients_${l}_([^_]*)$`),this.Er=RegExp(`^firestore_mutations_${l}_(\\d+)(?:_(.*))?$`),this.Ar=RegExp(`^firestore_targets_${l}_(\\d+)$`),this.vr=(a=this.persistenceKey,`firestore_online_state_${a}`),this.Rr=(o=this.persistenceKey,`firestore_bundle_loaded_v2_${o}`),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.$i())){if(e===this.wr)continue;let t=this.getItem(lC(this.persistenceKey,e));if(t){let n=lR.ar(e,t);n&&(this.gr=this.gr.insert(n.clientId,n))}}this.Pr();let e=this.storage.getItem(this.vr);if(e){let t=this.br(e);t&&this.Vr(t)}for(let e of this.yr)this.mr(e);this.yr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,n){this.Dr(e,t,n),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let n=this.storage.getItem(lA(this.persistenceKey,e));if(n){let r=lk.ar(e,n);r&&(t=r.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lA(this.persistenceKey,e))}updateQueryState(e,t,n){this.kr(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Cr(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return n4("SharedClientState","READ",e,t),t}setItem(e,t){n4("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){n4("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){if(e.storageArea===this.storage){if(n4("SharedClientState","EVENT",e.key,e.newValue),e.key===this.pr)return void n3("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.Tr.test(e.key)){if(null==e.newValue){let t=this.Or(e.key);return this.Fr(t,null)}{let t=this.Br(e.key,e.newValue);if(t)return this.Fr(t.clientId,t)}}else if(this.Er.test(e.key)){if(null!==e.newValue){let t=this.Lr(e.key,e.newValue);if(t)return this.qr(t)}}else if(this.Ar.test(e.key)){if(null!==e.newValue){let t=this.Ur(e.key,e.newValue);if(t)return this.Kr(t)}}else if(e.key===this.vr){if(null!==e.newValue){let t=this.br(e.newValue);if(t)return this.Vr(t)}}else if(e.key===this.Ir){let t=function(e){let t=rK.ct;if(null!=e)try{let n=JSON.parse(e);"number"==typeof n||n9(),t=n}catch(e){n3("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==rK.ct&&this.sequenceNumberHandler(t)}else if(e.key===this.Rr){let t=this.Gr(e.newValue);await Promise.all(t.map(e=>this.syncEngine.Qr(e)))}}}else this.yr.push(e)})}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,n){let r=new lN(this.currentUser,e,t,n),i=lD(this.persistenceKey,this.currentUser,e);this.setItem(i,r.hr())}Cr(e){let t=lD(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){let t={clientId:this.wr,onlineState:e};this.storage.setItem(this.vr,JSON.stringify(t))}kr(e,t,n){let r=lA(this.persistenceKey,e),i=new lk(e,t,n);this.setItem(r,i.hr())}$r(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){let t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){let n=this.Or(e);return lR.ar(n,t)}Lr(e,t){let n=this.Er.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return lN.ar(new n0(i),r,t)}Ur(e,t){let n=Number(this.Ar.exec(e)[1]);return lk.ar(n,t)}br(e){return lO.ar(e)}Gr(e){return JSON.parse(e)}async qr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.jr(e.batchId,e.state,e.error);n4("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){let n=t?this.gr.insert(e,t):this.gr.remove(e),r=this.Sr(this.gr),i=this.Sr(n),s=[],a=[];return i.forEach(e=>{r.has(e)||s.push(e)}),r.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.Wr(s,a).then(()=>{this.gr=n})}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=sB;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class lP{constructor(){this.Hr=new lM,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,n){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new lM,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lF{Yr(e){}shutdown(){}}class lV{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){for(let e of(n4("ConnectivityMonitor","Network connectivity changed: AVAILABLE"),this.so))e(0)}no(){for(let e of(n4("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE"),this.so))e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lU=null;function lB(){return null===lU?lU=0x10000000+Math.round(0x80000000*Math.random()):lU++,"0x"+lU.toString(16)}let lq={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lj{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}let l$="WebChannelConnection";class lK extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http";this.mo=t+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,n,r,i){let s=lB(),a=this.To(e,t);n4("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);let o={};return this.Eo(o,r,i),this.Ao(e,a,o,n).then(t=>(n4("RestConnection",`Received RPC '${e}' ${s}: `,t),t),t=>{throw n5("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}vo(e,t,n,r,i,s){return this.Io(e,t,n,r,i)}Eo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+n1,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}To(e,t){let n=lq[e];return`${this.mo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,n,r){let i=lB();return new Promise((s,a)=>{let o=new nW;o.setWithCredentials(!0),o.listenOnce(nK.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case n$.NO_ERROR:let t=o.getResponseJson();n4(l$,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case n$.TIMEOUT:n4(l$,`RPC '${e}' ${i} timed out`),a(new re(n7.DEADLINE_EXCEEDED,"Request time out"));break;case n$.HTTP_ERROR:let n=o.getStatus();if(n4(l$,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(n7).indexOf(t)>=0?t:n7.UNKNOWN}(t.status);a(new re(e,t.message))}else a(new re(n7.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new re(n7.UNAVAILABLE,"Connection failed."));break;default:n9()}}finally{n4(l$,`RPC '${e}' ${i} completed.`)}});let l=JSON.stringify(r);n4(l$,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,n,15)})}Ro(e,t,n){let r=lB(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=nq(),a=nj(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.xmlHttpFactory=new nH({})),this.Eo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let h=i.join("");n4(l$,`Creating RPC '${e}' stream ${r}: ${h}`,l);let c=s.createWebChannel(h,l),f=!1,d=!1,g=new lj({ro:t=>{d?n4(l$,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(f||(n4(l$,`Opening RPC '${e}' stream ${r} transport.`),c.open(),f=!0),n4(l$,`RPC '${e}' stream ${r} sending:`,t),c.send(t))},oo:()=>c.close()}),m=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(c,nQ.EventType.OPEN,()=>{d||n4(l$,`RPC '${e}' stream ${r} transport opened.`)}),m(c,nQ.EventType.CLOSE,()=>{d||(d=!0,n4(l$,`RPC '${e}' stream ${r} transport closed`),g.wo())}),m(c,nQ.EventType.ERROR,t=>{d||(d=!0,n5(l$,`RPC '${e}' stream ${r} transport errored:`,t),g.wo(new re(n7.UNAVAILABLE,"The operation could not be completed")))}),m(c,nQ.EventType.MESSAGE,t=>{var n;if(!d){let i=t.data[0];i||n9();let s=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(s){n4(l$,`RPC '${e}' stream ${r} received error:`,s);let t=s.status,n=function(e){let t=o[e];if(void 0!==t)return al(t)}(t),i=s.message;void 0===n&&(n=n7.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),d=!0,g.wo(new re(n,i)),c.close()}else n4(l$,`RPC '${e}' stream ${r} received:`,i),g._o(i)}}),m(a,nz.STAT_EVENT,t=>{t.stat===nG.PROXY?n4(l$,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===nG.NOPROXY&&n4(l$,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{g.fo()},0),g}}function lz(){return"undefined"!=typeof window?window:null}function lG(){return"undefined"!=typeof document?document:null}function lH(e){return new aD(e,!0)}class lQ{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=n,this.bo=r,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();let t=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),r=Math.max(0,t-n);r>0&&n4("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,r,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class lW{constructor(e,t,n,r,i,s,a,o){this.ii=e,this.$o=n,this.Oo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new lQ(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(e,t){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==e?this.qo.reset():t&&t.code===n7.RESOURCE_EXHAUSTED?(n3(t.toString()),n3("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):t&&t.code===n7.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.ao(t)}Yo(){}auth(){this.state=1;let e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.Fo===t&&this.Zo(e,n)},t=>{e(()=>{let e=new re(n7.UNKNOWN,"Fetching auth token failed: "+t.message);return this.tu(e)})})}Zo(e,t){let n=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{n(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(e=>{n(()=>this.tu(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}Go(){this.state=5,this.qo.No(async()=>{this.state=0,this.start()})}tu(e){return n4("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(n4("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lX extends lW{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:n9(),a=t.targetChange.targetIds||[],o=(i=t.targetChange.resumeToken,e.useProto3Json?(void 0===i||"string"==typeof i||n9(),iI.fromBase64String(i||"")):(void 0===i||i instanceof Uint8Array||n9(),iI.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new ab(s,a,o,l&&new re(void 0===l.code?n7.UNKNOWN:al(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=aP(e,r.document.name),s=aR(r.document.updateTime),a=r.document.createTime?aR(r.document.createTime):rg.min(),o=new iW({mapValue:{fields:r.document.fields}}),l=iX.newFoundDocument(i,s,a,o);n=new av(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=aP(e,r.document),s=r.readTime?aR(r.readTime):rg.min(),a=iX.newNoDocument(i,s);n=new av([],r.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=aP(e,r.document);n=new av([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return n9();{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ao(r,i);n=new aw(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return rg.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?rg.min():t.readTime?aR(t.readTime):rg.min()}(e);return this.listener.nu(t,n)}su(e){let t={};t.database=aU(this.serializer),t.addTarget=function(e,t){let n;let r=t.target;if((n=sc(r)?{documents:az(e,r)}:{query:aG(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=ak(e,t.resumeToken);let r=aA(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(rg.min())>0){n.readTime=aN(e,t.snapshotVersion.toTimestamp());let r=aA(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return n9()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.Wo(t)}iu(e){let t={};t.database=aU(this.serializer),t.removeTarget=e,this.Wo(t)}}class lY extends lW{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){var t,n;if(e.streamToken||n9(),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(void 0!==n||n9(),t.map(e=>{let t;return(t=e.updateTime?aR(e.updateTime):aR(n)).isEqual(rg.min())&&(t=aR(n)),new s0(t,e.transformResults||[])})):[]),i=aR(e.commitTime);return this.listener.cu(i,r)}return e.writeResults&&0!==e.writeResults.length&&n9(),this.ru=!0,this.listener.au()}hu(){let e={};e.database=aU(this.serializer),this.Wo(e)}uu(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>a$(this.serializer,e))};this.Wo(t)}}class lJ extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.lu=!1}fu(){if(this.lu)throw new re(n7.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Io(e,t,n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===n7.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new re(n7.UNKNOWN,e.toString())})}vo(e,t,n,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.vo(e,t,n,i,s,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===n7.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new re(n7.UNKNOWN,e.toString())})}terminate(){this.lu=!0}}class lZ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(n3(t),this.mu=!1):n4("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class l0{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr(e=>{n.enqueueAndForget(async()=>{l7(this)&&(n4("RemoteStore","Restarting streams for network reachability change."),await async function(e){e.vu.add(4),await l2(e),e.bu.set("Unknown"),e.vu.delete(4),await l1(e)}(this))})}),this.bu=new lZ(n,r)}}async function l1(e){if(l7(e))for(let t of e.Ru)await t(!0)}async function l2(e){for(let t of e.Ru)await t(!1)}function l6(e,t){e.Au.has(t.targetId)||(e.Au.set(t.targetId,t),l9(e)?l8(e):ug(e).Ko()&&l3(e,t))}function l4(e,t){let n=ug(e);e.Au.delete(t),n.Ko()&&l5(e,t),0===e.Au.size&&(n.Ko()?n.jo():l7(e)&&e.bu.set("Unknown"))}function l3(e,t){if(e.Vu.qt(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(rg.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}ug(e).su(t)}function l5(e,t){e.Vu.qt(t),ug(e).iu(t)}function l8(e){e.Vu=new aE({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),le:t=>e.Au.get(t)||null,ue:()=>e.datastore.serializer.databaseId}),ug(e).start(),e.bu.gu()}function l9(e){return l7(e)&&!ug(e).Uo()&&e.Au.size>0}function l7(e){return 0===e.vu.size}async function ue(e){e.Au.forEach((t,n)=>{l3(e,t)})}async function ut(e,t){e.Vu=void 0,l9(e)?(e.bu.Iu(t),l8(e)):e.bu.set("Unknown")}async function un(e,t,n){if(e.bu.set("Online"),t instanceof ab&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Au.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Au.delete(r),e.Vu.removeTarget(r))}(e,t)}catch(n){n4("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ur(e,n)}else if(t instanceof av?e.Vu.Ht(t):t instanceof aw?e.Vu.ne(t):e.Vu.Xt(t),!n.isEqual(rg.min()))try{let t=await lw(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.Vu.ce(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){let i=e.Au.get(r);i&&e.Au.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let r=e.Au.get(t);if(!r)return;e.Au.set(t,r.withResumeToken(iI.EMPTY_BYTE_STRING,r.snapshotVersion)),l5(e,t);let i=new aY(r.target,t,n,r.sequenceNumber);l3(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){n4("RemoteStore","Failed to raise snapshot:",t),await ur(e,t)}}async function ur(e,t,n){if(!rF(t))throw t;e.vu.add(1),await l2(e),e.bu.set("Offline"),n||(n=()=>lw(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{n4("RemoteStore","Retrying IndexedDB access"),await n(),e.vu.delete(1),await l1(e)})}function ui(e,t){return t().catch(n=>ur(e,n,t))}async function us(e){let t=um(e),n=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;l7(e)&&e.Eu.length<10;)try{let r=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,n);if(null===r){0===e.Eu.length&&t.jo();break}n=r.batchId,function(e,t){e.Eu.push(t);let n=um(e);n.Ko()&&n.ou&&n.uu(t.mutations)}(e,r)}catch(t){await ur(e,t)}ua(e)&&uo(e)}function ua(e){return l7(e)&&!um(e).Uo()&&e.Eu.length>0}function uo(e){um(e).start()}async function ul(e){um(e).hu()}async function uu(e){let t=um(e);for(let n of e.Eu)t.uu(n.mutations)}async function uh(e,t,n){let r=e.Eu.shift(),i=as.from(r,t,n);await ui(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await us(e)}async function uc(e,t){t&&um(e).ou&&await async function(e,t){var n;if(function(e){switch(e){default:return n9();case n7.CANCELLED:case n7.UNKNOWN:case n7.DEADLINE_EXCEEDED:case n7.RESOURCE_EXHAUSTED:case n7.INTERNAL:case n7.UNAVAILABLE:case n7.UNAUTHENTICATED:return!1;case n7.INVALID_ARGUMENT:case n7.NOT_FOUND:case n7.ALREADY_EXISTS:case n7.PERMISSION_DENIED:case n7.FAILED_PRECONDITION:case n7.ABORTED:case n7.OUT_OF_RANGE:case n7.UNIMPLEMENTED:case n7.DATA_LOSS:return!0}}(n=t.code)&&n!==n7.ABORTED){let n=e.Eu.shift();um(e).Qo(),await ui(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await us(e)}}(e,t),ua(e)&&uo(e)}async function uf(e,t){e.asyncQueue.verifyOperationInProgress(),n4("RemoteStore","RemoteStore received new credentials");let n=l7(e);e.vu.add(3),await l2(e),n&&e.bu.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.vu.delete(3),await l1(e)}async function ud(e,t){t?(e.vu.delete(2),await l1(e)):t||(e.vu.add(2),await l2(e),e.bu.set("Unknown"))}function ug(e){var t,n,r;return e.Su||(e.Su=(t=e.datastore,n=e.asyncQueue,r={uo:ue.bind(null,e),ao:ut.bind(null,e),nu:un.bind(null,e)},t.fu(),new lX(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r)),e.Ru.push(async t=>{t?(e.Su.Qo(),l9(e)?l8(e):e.bu.set("Unknown")):(await e.Su.stop(),e.Vu=void 0)})),e.Su}function um(e){var t,n,r;return e.Du||(e.Du=(t=e.datastore,n=e.asyncQueue,r={uo:ul.bind(null,e),ao:uc.bind(null,e),au:uu.bind(null,e),cu:uh.bind(null,e)},t.fu(),new lY(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r)),e.Ru.push(async t=>{t?(e.Du.Qo(),await us(e)):(await e.Du.stop(),e.Eu.length>0&&(n4("RemoteStore",`Stopping write stream with ${e.Eu.length} pending writes`),e.Eu=[]))})),e.Du}class up{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,i){let s=new up(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new re(n7.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uy(e,t){if(n3("AsyncQueue",`${t}: ${e}`),rF(e))return new re(n7.UNAVAILABLE,`${t}: ${e}`);throw e}class uv{constructor(e){this.comparator=e?(t,n)=>e(t,n)||rw.comparator(t.key,n.key):(e,t)=>rw.comparator(e.key,t.key),this.keyedMap=sM(),this.sortedSet=new id(this.comparator)}static emptySet(e){return new uv(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof uv)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new uv;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class uw{constructor(){this.Cu=new id(rw.comparator)}track(e){let t=e.doc.key,n=this.Cu.get(t);n?0!==e.type&&3===n.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==n.type?this.Cu=this.Cu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Cu=this.Cu.remove(t):1===e.type&&2===n.type?this.Cu=this.Cu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):n9():this.Cu=this.Cu.insert(t,e)}xu(){let e=[];return this.Cu.inorderTraversal((t,n)=>{e.push(n)}),e}}class ub{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new ub(e,t,uv.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class uI{constructor(){this.Nu=void 0,this.listeners=[]}}class uE{constructor(){this.queries=new sk(e=>s_(e),sS),this.onlineState="Unknown",this.ku=new Set}}async function uT(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i||(r=!0,i=new uI),r)try{i.Nu=await e.onListen(n)}catch(n){let e=uy(n,`Initialization of query '${sC(t.query)}' failed`);return void t.onError(e)}e.queries.set(n,i),i.listeners.push(t),t.Mu(e.onlineState),i.Nu&&t.$u(i.Nu)&&uC(e)}async function ux(e,t){let n=t.query,r=!1,i=e.queries.get(n);if(i){let e=i.listeners.indexOf(t);e>=0&&(i.listeners.splice(e,1),r=0===i.listeners.length)}if(r)return e.queries.delete(n),e.onUnlisten(n)}function uS(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.listeners)e.$u(r)&&(n=!0);i.Nu=r}}n&&uC(e)}function u_(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.listeners)e.onError(n);e.queries.delete(t)}function uC(e){e.ku.forEach(e=>{e.next()})}class uD{constructor(e,t,n){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new ub(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){if(e.docChanges.length>0)return!0;let t=this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Uu(e){e=ub.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class uA{constructor(e){this.key=e}}class uN{constructor(e){this.key=e}}class uk{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=sU(),this.mutatedKeys=sU(),this.tc=sN(e),this.ec=new uv(this.tc)}get nc(){return this.Yu}sc(e,t){let n=t?t.ic:new uw,r=t?t.ec:this.ec,i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1,o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let u=r.get(e),h=sD(this.query,t)?t:null,c=!!u&&this.mutatedKeys.has(u.key),f=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations),d=!1;u&&h?u.data.isEqual(h.data)?c!==f&&(n.track({type:3,doc:h}),d=!0):this.rc(u,h)||(n.track({type:2,doc:h}),d=!0,(o&&this.tc(h,o)>0||l&&0>this.tc(h,l))&&(a=!0)):!u&&h?(n.track({type:0,doc:h}),d=!0):u&&!h&&(n.track({type:1,doc:u}),d=!0,(o||l)&&(a=!0)),d&&(h?(s=s.add(h),i=f?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{ec:s,ic:n,zi:a,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){let r=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;let i=e.ic.xu();i.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return n9()}};return n(e)-n(t)})(e.type,t.type)||this.tc(e.doc,t.doc)),this.oc(n);let s=t?this.uc():[],a=0===this.Zu.size&&this.current?1:0,o=a!==this.Xu;return(this.Xu=a,0!==i.length||o)?{snapshot:new ub(this.query,e.ec,r,i,e.mutatedKeys,0===a,o,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:s}:{cc:s}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new uw,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(e=>this.Yu=this.Yu.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Yu=this.Yu.delete(e)),this.current=e.current)}uc(){if(!this.current)return[];let e=this.Zu;this.Zu=sU(),this.ec.forEach(e=>{this.ac(e.key)&&(this.Zu=this.Zu.add(e.key))});let t=[];return e.forEach(e=>{this.Zu.has(e)||t.push(new uN(e))}),this.Zu.forEach(n=>{e.has(n)||t.push(new uA(n))}),t}hc(e){this.Yu=e.ir,this.Zu=sU();let t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return ub.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class uR{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class uO{constructor(e){this.key=e,this.fc=!1}}class uM{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.dc={},this.wc=new sk(e=>s_(e),sS),this._c=new Map,this.mc=new Set,this.gc=new id(rw.comparator),this.yc=new Map,this.Ic=new o9,this.Tc={},this.Ec=new Map,this.Ac=oU.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function uL(e,t){let n,r;let i=u9(e),s=i.wc.get(t);if(s)n=s.targetId,i.sharedClientState.addLocalQueryTarget(n),r=s.view.lc();else{let e=await lI(i.localStore,sE(t)),s=i.sharedClientState.addLocalQueryTarget(e.targetId);n=e.targetId,r=await uP(i,t,n,"current"===s,e.resumeToken),i.isPrimaryClient&&l6(i.remoteStore,e)}return r}async function uP(e,t,n,r,i){e.Rc=(t,n,r)=>(async function(e,t,n,r){let i=t.view.sc(n);i.zi&&(i=await lT(e.localStore,t.query,!1).then(({documents:e})=>t.view.sc(e,i)));let s=r&&r.targetChanges.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s);return uQ(e,t.targetId,a.cc),a.snapshot})(e,t,n,r);let s=await lT(e.localStore,t,!0),a=new uk(t,s.ir),o=a.sc(s.documents),l=ay.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);uQ(e,n,u.cc);let h=new uR(t,n,a);return e.wc.set(t,h),e._c.has(n)?e._c.get(n).push(t):e._c.set(n,[t]),u.snapshot}async function uF(e,t){let n=e.wc.get(t),r=e._c.get(n.targetId);if(r.length>1)return e._c.set(n.targetId,r.filter(e=>!sS(e,t))),void e.wc.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)||await lE(e.localStore,n.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(n.targetId),l4(e.remoteStore,n.targetId),uG(e,n.targetId)}).catch(rk)):(uG(e,n.targetId),await lE(e.localStore,n.targetId,!0))}async function uV(e,t,n){let r=u7(e);try{var i;let e;let s=await function(e,t){let n,r;let i=rd.now(),s=t.reduce((e,t)=>e.add(t.key),sU());return e.persistence.runTransaction("Locally write mutations","readwrite",a=>{let o=sR,l=sU();return e.Zi.getEntries(a,s).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(a,o)).next(r=>{n=r;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=sK(r.transform,e||null);null!=i&&(null===n&&(n=iW.empty()),n.set(r.field,i))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new s9(e.key,t,function e(t){let n=[];return ih(t.fields,(t,r)=>{let i=new rv([t]);if(iK(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new iw(n)}(t.value.mapValue),s1.exists(!0)))}return e.mutationQueue.addMutationBatch(a,i,s,t)}).next(t=>{r=t;let i=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(a,t.batchId,i)})}).then(()=>({batchId:r.batchId,changes:sL(n)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),i=s.batchId,(e=r.Tc[r.currentUser.toKey()])||(e=new id(rc)),e=e.insert(i,n),r.Tc[r.currentUser.toKey()]=e,await uX(r,s.changes),await us(r.remoteStore)}catch(t){let e=uy(t,"Failed to persist write");n.reject(e)}}async function uU(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,r=e.Ji;return e.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{let s=e.Zi.newChangeBuffer({trackRemovals:!0});r=e.Ji;let a=[];t.targetChanges.forEach((s,o)=>{var l;let u=r.get(o);if(!u)return;a.push(e.Bs.removeMatchingKeys(i,s.removedDocuments,o).next(()=>e.Bs.addMatchingKeys(i,s.addedDocuments,o)));let h=u.withSequenceNumber(i.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(iI.EMPTY_BYTE_STRING,rg.min()).withLastLimboFreeSnapshotVersion(rg.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,n)),r=r.insert(o,h),l=h,(0===u.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-u.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&a.push(e.Bs.updateTargetData(i,h))});let o=sR,l=sU();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(i,n))}),a.push(lb(i,s,t.documentUpdates).next(e=>{o=e.nr,l=e.sr})),!n.isEqual(rg.min())){let t=e.Bs.getLastRemoteSnapshotVersion(i).next(t=>e.Bs.setTargetsMetadata(i,i.currentSequenceNumber,n));a.push(t)}return rR.waitFor(a).next(()=>s.apply(i)).next(()=>e.localDocuments.getLocalViewOfDocuments(i,o,l)).next(()=>o)}).then(t=>(e.Ji=r,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let r=e.yc.get(n);r&&(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1||n9(),t.addedDocuments.size>0?r.fc=!0:t.modifiedDocuments.size>0?r.fc||n9():t.removedDocuments.size>0&&(r.fc||n9(),r.fc=!1))}),await uX(e,n,t)}catch(e){await rk(e)}}function uB(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n;let i=[];e.wc.forEach((e,n)=>{let r=n.view.Mu(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.listeners)e.Mu(t)&&(n=!0)}),n&&uC(r),i.length&&e.dc.nu(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function uq(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.yc.get(t),i=r&&r.key;if(i){let n=new id(rw.comparator);n=n.insert(i,iX.newNoDocument(i,rg.min()));let r=sU().add(i),s=new ap(rg.min(),new Map,new id(rc),n,r);await uU(e,s),e.gc=e.gc.remove(i),e.yc.delete(t),uW(e)}else await lE(e.localStore,t,!1).then(()=>uG(e,t,n)).catch(rk)}async function uj(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r=t.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,r){let i=n.batch,s=i.keys(),a=rR.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);null!==s||n9(),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))})(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=sU();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))});uz(e,r,null),uK(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await uX(e,i)}catch(e){await rk(e)}}async function u$(e,t,n){var r;try{let i=await (r=e.localStore).persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(null!==t||n9(),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))});uz(e,t,n),uK(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await uX(e,i)}catch(e){await rk(e)}}function uK(e,t){(e.Ec.get(t)||[]).forEach(e=>{e.resolve()}),e.Ec.delete(t)}function uz(e,t,n){let r=e.Tc[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Tc[e.currentUser.toKey()]=r}}function uG(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e._c.get(t)))e.wc.delete(r),n&&e.dc.Pc(r,n);e._c.delete(t),e.isPrimaryClient&&e.Ic.Is(t).forEach(t=>{e.Ic.containsKey(t)||uH(e,t)})}function uH(e,t){e.mc.delete(t.path.canonicalString());let n=e.gc.get(t);null!==n&&(l4(e.remoteStore,n),e.gc=e.gc.remove(t),e.yc.delete(n),uW(e))}function uQ(e,t,n){for(let r of n)r instanceof uA?(e.Ic.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.gc.get(n)||e.mc.has(r)||(n4("SyncEngine","New document in limbo: "+n),e.mc.add(r),uW(e))}(e,r)):r instanceof uN?(n4("SyncEngine","Document no longer in limbo: "+r.key),e.Ic.removeReference(r.key,t),e.Ic.containsKey(r.key)||uH(e,r.key)):n9()}function uW(e){for(;e.mc.size>0&&e.gc.size<e.maxConcurrentLimboResolutions;){let t=e.mc.values().next().value;e.mc.delete(t);let n=new rw(rp.fromString(t)),r=e.Ac.next();e.yc.set(r,new uO(n)),e.gc=e.gc.insert(n,r),l6(e.remoteStore,new aY(sE(sp(n.path)),r,"TargetPurposeLimboResolution",rK.ct))}}async function uX(e,t,n){let r=[],i=[],s=[];e.wc.isEmpty()||(e.wc.forEach((a,o)=>{s.push(e.Rc(o,t,n).then(t=>{if((t||n)&&e.isPrimaryClient&&e.sharedClientState.updateQueryState(o.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);let e=lm.Li(o.targetId,t);i.push(e)}}))}),await Promise.all(s),e.dc.nu(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>rR.forEach(t,t=>rR.forEach(t.Fi,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>rR.forEach(t.Bi,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!rF(e))throw e;n4("LocalStore","Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ji.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ji=e.Ji.insert(t,i)}}}(e.localStore,i))}async function uY(e,t){var n;if(!e.currentUser.isEqual(t)){n4("SyncEngine","User change. New user:",t.toKey());let r=await lv(e.localStore,t);e.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",e.Ec.forEach(e=>{e.forEach(e=>{e.reject(new re(n7.CANCELLED,n))})}),e.Ec.clear(),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await uX(e,r.er)}}function uJ(e,t){let n=e.yc.get(t);if(n&&n.fc)return sU().add(n.key);{let n=sU(),r=e._c.get(t);if(!r)return n;for(let t of r){let r=e.wc.get(t);n=n.unionWith(r.view.nc)}return n}}async function uZ(e,t){let n=await lT(e.localStore,t.query,!0),r=t.view.hc(n);return e.isPrimaryClient&&uQ(e,t.targetId,r.cc),r}async function u0(e,t){return lS(e.localStore,t).then(t=>uX(e,t))}async function u1(e,t,n,r){let i=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",r=>n.Sn(r,t).next(t=>t?e.localDocuments.getDocuments(r,t):rR.resolve(null)))}(e.localStore,t);null!==i?("pending"===n?await us(e.remoteStore):"acknowledged"===n||"rejected"===n?(uz(e,t,r||null),uK(e,t),function(e,t){e.mutationQueue.Cn(t)}(e.localStore,t)):n9(),await uX(e,i)):n4("SyncEngine","Cannot apply mutation batch with id: "+t)}async function u2(e,t){if(u9(e),u7(e),!0===t&&!0!==e.vc){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await u6(e,t.toArray());for(let t of(e.vc=!0,await ud(e.remoteStore,!0),n))l6(e.remoteStore,t)}else if(!1===t&&!1!==e.vc){let t=[],n=Promise.resolve();e._c.forEach((r,i)=>{e.sharedClientState.isLocalQueryTarget(i)?t.push(i):n=n.then(()=>(uG(e,i),lE(e.localStore,i,!0))),l4(e.remoteStore,i)}),await n,await u6(e,t),e.yc.forEach((t,n)=>{l4(e.remoteStore,n)}),e.Ic.Ts(),e.yc=new Map,e.gc=new id(rw.comparator),e.vc=!1,await ud(e.remoteStore,!1)}}async function u6(e,t,n){let r=[],i=[];for(let n of t){let t;let s=e._c.get(n);if(s&&0!==s.length)for(let n of(t=await lI(e.localStore,sE(s[0])),s)){let t=e.wc.get(n),r=await uZ(e,t);r.snapshot&&i.push(r.snapshot)}else{let r=await lx(e.localStore,n);t=await lI(e.localStore,r),await uP(e,u4(r),n,!1,t.resumeToken)}r.push(t)}return e.dc.nu(i),r}function u4(e){var t,n,r,i;return t=e.path,n=e.collectionGroup,r=e.orderBy,i=e.filters,new sm(t,n,r,i,e.limit,"F",e.startAt,e.endAt)}function u3(e){return e.localStore.persistence.$i()}async function u5(e,t,n,r){if(e.vc)return void n4("SyncEngine","Ignoring unexpected query state notification.");let i=e._c.get(t);if(i&&i.length>0)switch(n){case"current":case"not-current":{let r=await lS(e.localStore,sA(i[0])),s=ap.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,iI.EMPTY_BYTE_STRING);await uX(e,r,s);break}case"rejected":await lE(e.localStore,t,!0),uG(e,t,r);break;default:n9()}}async function u8(e,t,n){let r=u9(e);if(r.vc){for(let e of t){if(r._c.has(e)){n4("SyncEngine","Adding an already active target "+e);continue}let t=await lx(r.localStore,e),n=await lI(r.localStore,t);await uP(r,u4(t),n.targetId,!1,n.resumeToken),l6(r.remoteStore,n)}for(let e of n)r._c.has(e)&&await lE(r.localStore,e,!1).then(()=>{l4(r.remoteStore,e),uG(r,e)}).catch(rk)}}function u9(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=uU.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uJ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=uq.bind(null,e),e.dc.nu=uS.bind(null,e.eventManager),e.dc.Pc=u_.bind(null,e.eventManager),e}function u7(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=uj.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=u$.bind(null,e),e}class he{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=lH(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){var t;return t=this.persistence,new ly(t,new lp,e.initialUser,this.serializer)}createPersistence(e){return new li(la.zs,this.serializer)}createSharedClientState(e){return new lP}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ht extends he{constructor(e,t,n){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Vc.initialize(this,e),await u7(this.Vc.syncEngine),await us(this.Vc.remoteStore),await this.persistence.Ii(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){var t;return t=this.persistence,new ly(t,new lp,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new oG(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let n=new r$(t,this.persistence);return new rj(e.asyncQueue,n)}createPersistence(e){let t=lg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ok.withCacheSize(this.cacheSizeBytes):ok.DEFAULT;return new lc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,lz(),lG(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new lP}}class hn{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>uB(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=uY.bind(null,this.syncEngine),await ud(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new uE}createDatastore(e){let t=lH(e.databaseInfo.databaseId),n=new lK(e.databaseInfo);return new lJ(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){var t;return t=this.localStore,new l0(t,this.datastore,e.asyncQueue,e=>uB(this.syncEngine,e,0),lV.D()?new lV:new lF)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){let o=new uM(e,t,n,r,i,s);return a&&(o.vc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){n4("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await l2(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class hr{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):n3("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hi{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=n0.UNAUTHENTICATED,this.clientId=rh.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{n4("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(n4("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new re(n7.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=uy(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function hs(e,t){e.asyncQueue.verifyOperationInProgress(),n4("FirestoreClient","Initializing OfflineComponentProvider");let n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await lv(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function ha(e,t){e.asyncQueue.verifyOperationInProgress();let n=await ho(e);n4("FirestoreClient","Initializing OnlineComponentProvider");let r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener(e=>uf(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>uf(t.remoteStore,n)),e._onlineComponents=t}async function ho(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){n4("FirestoreClient","Using user provided OfflineComponentProvider");try{await hs(e,e._uninitializedComponentsProvider._offline)}catch(n){var t;if(!("FirebaseError"===(t=n).name?t.code===n7.FAILED_PRECONDITION||t.code===n7.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw n;n5("Error using user provided cache. Falling back to memory cache: "+n),await hs(e,new he)}}else n4("FirestoreClient","Using default OfflineComponentProvider"),await hs(e,new he)}return e._offlineComponents}async function hl(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(n4("FirestoreClient","Using user provided OnlineComponentProvider"),await ha(e,e._uninitializedComponentsProvider._online)):(n4("FirestoreClient","Using default OnlineComponentProvider"),await ha(e,new hn))),e._onlineComponents}async function hu(e){let t=await hl(e),n=t.eventManager;return n.onListen=uL.bind(null,t.syncEngine),n.onUnlisten=uF.bind(null,t.syncEngine),n}function hh(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let hc=new Map;function hf(e,t,n){if(!n)throw new re(n7.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function hd(e){if(!rw.isDocumentKey(e))throw new re(n7.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function hg(e){if(rw.isDocumentKey(e))throw new re(n7.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function hm(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":n9()}function hp(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new re(n7.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=hm(e);throw new re(n7.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class hy{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new re(n7.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new re(n7.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new re(n7.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new re(n7.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new re(n7.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new re(n7.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class hv{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new hy({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new re(n7.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new re(n7.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new hy(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new rr;switch(e.type){case"firstParty":return new ro(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new re(n7.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=hc.get(e);t&&(n4("ComponentProvider","Removing Datastore"),hc.delete(e),t.terminate())}(this),Promise.resolve()}}class hw{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new hI(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new hw(this.firestore,e,this._key)}}class hb{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hb(this.firestore,e,this._query)}}class hI extends hb{constructor(e,t,n){super(e,t,sp(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new hw(this.firestore,null,new rw(e))}withConverter(e){return new hI(this.firestore,e,this._path)}}function hE(e,t,...n){if(e=(0,d.Ku)(e),hf("collection","path",t),e instanceof hv){let r=rp.fromString(t,...n);return hg(r),new hI(e,null,r)}{if(!(e instanceof hw||e instanceof hI))throw new re(n7.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rp.fromString(t,...n));return hg(r),new hI(e.firestore,null,r)}}function hT(e,t,...n){if(e=(0,d.Ku)(e),1==arguments.length&&(t=rh.A()),hf("doc","path",t),e instanceof hv){let r=rp.fromString(t,...n);return hd(r),new hw(e,null,new rw(r))}{if(!(e instanceof hw||e instanceof hI))throw new re(n7.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(rp.fromString(t,...n));return hd(r),new hw(e.firestore,e instanceof hI?e.converter:null,new rw(r))}}class hx{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new lQ(this,"async_queue_retry"),this.Xc=()=>{let e=lG();e&&n4("AsyncQueue","Visibility state changed to "+e.visibilityState),this.qo.Mo()};let e=lG();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;let t=lG();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});let t=new rt;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(e){if(!rF(e))throw e;n4("AsyncQueue","Operation failed with retryable error: "+e)}this.Qc.length>0&&this.qo.No(()=>this.ea())}}ta(e){let t=this.Gc.then(()=>(this.Hc=!0,e().catch(e=>{let t;throw this.Wc=e,this.Hc=!1,n3("INTERNAL UNHANDLED ERROR: ",(t=e.message||"",e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t)),e}).then(e=>(this.Hc=!1,e))));return this.Gc=t,t}enqueueAfterDelay(e,t,n){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);let r=up.createAndSchedule(this,e,t,n,e=>this.na(e));return this.zc.push(r),r}Zc(){this.Wc&&n9()}verifyOperationInProgress(){}async sa(){let e;do e=this.Gc,await e;while(e!==this.Gc)}ia(e){for(let t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{for(let t of(this.zc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.zc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){let t=this.zc.indexOf(e);this.zc.splice(t,1)}}class hS extends hv{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new hx,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||hD(this),this._firestoreClient.terminate()}}function h_(e,t){let n="object"==typeof e?e:(0,h.Sx)(),r=(0,h.j6)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||"(default)"});if(!r._initialized){let e=(0,d.yU)("firestore");e&&function(e,t,n,r={}){var i;let s=(e=hp(e,hv))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&n5("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=n0.MOCK_USER;else{t=(0,d.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);let s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new re(n7.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new n0(s)}e._authCredentials=new ri(new rn(t,n))}}(r,...e)}return r}function hC(e){return e._firestoreClient||hD(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function hD(e){var t,n,r,i;let s=e._freezeSettings(),a=(i=e._databaseId,new iA(i,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,hh(s.experimentalLongPollingOptions),s.useFetchStreams));e._firestoreClient=new hi(e._authCredentials,e._appCheckCredentials,e._queue,a),(null===(n=s.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.cache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}class hA{constructor(e){this._byteString=e}static fromBase64String(e){try{return new hA(iI.fromBase64String(e))}catch(e){throw new re(n7.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new hA(iI.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class hN{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new re(n7.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rv(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class hk{constructor(e){this._methodName=e}}class hR{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new re(n7.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new re(n7.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return rc(this._lat,e._lat)||rc(this._long,e._long)}}let hO=/^__.*__$/;class hM{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new s9(e,this.data,this.fieldMask,t,this.fieldTransforms):new s8(e,this.data,t,this.fieldTransforms)}}class hL{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new s9(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hP(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw n9()}}class hF{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new hF(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.fa(e),r}da(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.aa({path:n,la:!1});return r.ua(),r}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return h0(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(hP(this.ca)&&hO.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class hV{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lH(e)}ya(e,t,n,r=!1){return new hF({ca:e,methodName:t,ga:n,path:rv.emptyPath(),la:!1,ma:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hU(e){let t=e._freezeSettings(),n=lH(e._databaseId);return new hV(e._databaseId,!!t.ignoreUndefinedProperties,n)}function hB(e,t,n,r,i,s={}){let a,o;let l=e.ya(s.merge||s.mergeFields?2:0,t,n,i);hX("Data must be an object, but it was:",l,r);let u=hQ(r,l);if(s.merge)a=new iw(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=hY(t,r,n);if(!l.contains(i))throw new re(n7.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);h1(e,i)||e.push(i)}a=new iw(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new hM(new iW(u),a,o)}class hq extends hk{_toFieldTransform(e){if(2!==e.ca)throw 1===e.ca?e._a(`${this._methodName}() can only appear at the top level of your update data`):e._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hq}}function hj(e,t,n){return new hF({ca:3,ga:t.settings.ga,methodName:e._methodName,la:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class h$ extends null{_toFieldTransform(e){return new sZ(e.path,new sz)}isEqual(e){return e instanceof h$}}class hK extends hk{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){let t=hj(this,e,!0),n=new sG(this.pa.map(e=>hH(e,t)));return new sZ(e.path,n)}isEqual(e){return this===e}}class hz extends hk{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){let t=hj(this,e,!0),n=new sQ(this.pa.map(e=>hH(e,t)));return new sZ(e.path,n)}isEqual(e){return this===e}}function hG(e,t,n,r=!1){return hH(n,e.ya(r?4:3,t))}function hH(e,t){if(hW(e=(0,d.Ku)(e)))return hX("Unsupported field value:",t,e),hQ(e,t);if(e instanceof hk)return function(e,t){if(!hP(t.ca))throw t._a(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t._a(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.la&&4!==t.ca)throw t._a("Nested arrays are not supported");return function(e,t){let n=[],r=0;for(let i of e){let e=hH(i,t.wa(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,d.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e){var n,r;return n=t.serializer,rH(r=e)?sj(r):sq(n,r)}if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=rd.fromDate(e);return{timestampValue:aN(t.serializer,n)}}if(e instanceof rd){let n=new rd(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:aN(t.serializer,n)}}if(e instanceof hR)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof hA)return{bytesValue:ak(t.serializer,e._byteString)};if(e instanceof hw){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t._a(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:aO(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t._a(`Unsupported field value: ${hm(e)}`)}(e,t)}function hQ(e,t){let n={};return ic(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ih(e,(e,r)=>{let i=hH(r,t.ha(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function hW(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof rd||e instanceof hR||e instanceof hA||e instanceof hw||e instanceof hk)}function hX(e,t,n){if(!hW(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){let r=hm(n);throw"an object"===r?t._a(e+" a custom object"):t._a(e+" "+r)}}function hY(e,t,n){if((t=(0,d.Ku)(t))instanceof hN)return t._internalPath;if("string"==typeof t)return hZ(e,t);throw h0("Field path arguments must be of type string or ",e,!1,void 0,n)}let hJ=RegExp("[~\\*/\\[\\]]");function hZ(e,t,n){if(t.search(hJ)>=0)throw h0(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new hN(...t.split("."))._internalPath}catch(r){throw h0(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function h0(e,t,n,r,i){let s=r&&!r.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${i}`),l+=")"),new re(n7.INVALID_ARGUMENT,o+e+l)}function h1(e,t){return e.some(e=>e.isEqual(t))}class h2{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new hw(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new h6(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(h4("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class h6 extends h2{data(){return super.data()}}function h4(e,t){return"string"==typeof t?hZ(e,t):t instanceof hN?t._internalPath:t._delegate._internalPath}class h3{}class h5 extends h3{}class h8 extends h5{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new h8(e,t,n)}_apply(e){let t=this._parse(e);return ca(e._query,t),new hb(e.firestore,e.converter,sT(e._query,t))}_parse(e){let t=hU(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new re(n7.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){cs(a,s);let t=[];for(let n of a)t.push(ci(r,e,n));o={arrayValue:{values:t}}}else o=ci(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||cs(a,s),o=hG(n,t,a,"in"===s||"not-in"===s);return i2.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class h9 extends h3{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new h9(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:i6.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())ca(n,e),n=sT(n,e)}(e._query,t),new hb(e.firestore,e.converter,sT(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class h7 extends h5{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new h7(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new re(n7.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new re(n7.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");let r=new i0(t,n);return function(e,t){if(null===sv(e)){let n=sw(e);null!==n&&co(e,n,t.field)}}(e,r),r}(e._query,this._field,this._direction);return new hb(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new sm(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class ce extends h5{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ce(e,t,n)}_apply(e){return new hb(e.firestore,e.converter,sx(e._query,this._limit,this._limitType))}}class ct extends h5{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new ct(e,t,n)}_apply(e){var t;let n=cr(e,this.type,this._docOrFields,this._inclusive);return new hb(e.firestore,e.converter,new sm((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt))}}class cn extends h5{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new cn(e,t,n)}_apply(e){var t;let n=cr(e,this.type,this._docOrFields,this._inclusive);return new hb(e.firestore,e.converter,new sm((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n))}}function cr(e,t,n,r){if(n[0]=(0,d.Ku)(n[0]),n[0]instanceof h2)return function(e,t,n,r,i){if(!r)throw new re(n7.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of sI(e))if(n.field.isKeyField())s.push(iU(t,r.key));else{let e=r.data.field(n.field);if(i_(e))throw new re(n7.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new re(n7.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new iY(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{let i=hU(e.firestore);return function(e,t,n,r,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new re(n7.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new re(n7.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof l}`);if(!sb(e)&&-1!==l.indexOf("/"))throw new re(n7.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(rp.fromString(l));if(!rw.isDocumentKey(n))throw new re(n7.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let i=new rw(n);o.push(iU(t,i))}else{let e=hG(n,r,l);o.push(e)}}return new iY(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function ci(e,t,n){if("string"==typeof(n=(0,d.Ku)(n))){if(""===n)throw new re(n7.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!sb(t)&&-1!==n.indexOf("/"))throw new re(n7.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let r=t.path.child(rp.fromString(n));if(!rw.isDocumentKey(r))throw new re(n7.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return iU(e,new rw(r))}if(n instanceof hw)return iU(e,n._key);throw new re(n7.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${hm(n)}.`)}function cs(e,t){if(!Array.isArray(e)||0===e.length)throw new re(n7.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ca(e,t){if(t.isInequality()){let n=sw(e),r=t.field;if(null!==n&&!n.isEqual(r))throw new re(n7.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${r.toString()}'`);let i=sv(e);null!==i&&co(e,r,i)}let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new re(n7.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new re(n7.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}function co(e,t,n){if(!n.isEqual(t))throw new re(n7.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class cl{convertValue(e,t="none"){switch(iO(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ix(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(iS(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw n9()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return ih(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertGeoPoint(e){return new hR(ix(e.latitude),ix(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=iC(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(iD(e));default:return null}}convertTimestamp(e){let t=iT(e);return new rd(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=rp.fromString(e);aX(n)||n9();let r=new iN(n.get(1),n.get(3)),i=new rw(n.popFirst(5));return r.isEqual(t)||n3(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function cu(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class ch{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class cc extends h2{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new cf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(h4("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class cf extends cc{data(e={}){return super.data(e)}}class cd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new ch(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new cf(this._firestore,this._userDataWriter,n.key,n,new ch(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new re(n7.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new cf(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ch(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new cf(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ch(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return n9()}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function cg(e){e=hp(e,hw);let t=hp(e.firestore,hS);return(function(e,t,n={}){let r=new rt;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new hr({next:s=>{t.enqueueAndForget(()=>ux(e,a));let o=s.docs.has(n);!o&&s.fromCache?i.reject(new re(n7.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&s.fromCache&&r&&"server"===r.source?i.reject(new re(n7.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),a=new uD(sp(n.path),s,{includeMetadataChanges:!0,Ku:!0});return uT(e,a)})(await hu(e),e.asyncQueue,t,n,r)),r.promise})(hC(t),e._key).then(n=>(function(e,t,n){let r=n.docs.get(t._key),i=new cm(e);return new cc(e,i,t._key,r,new ch(n.hasPendingWrites,n.fromCache),t.converter)})(t,e,n))}class cm extends cl{constructor(e){super(),this.firestore=e}convertBytes(e){return new hA(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new hw(this.firestore,null,t)}}function cp(e){e=hp(e,hb);let t=hp(e.firestore,hS),n=hC(t),r=new cm(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new re(n7.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,n={}){let r=new rt;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,r,i){let s=new uD(n,new hr({next:n=>{t.enqueueAndForget(()=>ux(e,s)),n.fromCache&&"server"===r.source?i.reject(new re(n7.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),{includeMetadataChanges:!0,Ku:!0});return uT(e,s)})(await hu(e),e.asyncQueue,t,n,r)),r.promise})(n,e._query).then(n=>new cd(t,r,e,n))}function cy(e,t,n){e=hp(e,hw);let r=hp(e.firestore,hS),i=cu(e.converter,t,n);return cI(r,[hB(hU(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,s1.none())])}function cv(e,t,n,...r){e=hp(e,hw);let i=hp(e.firestore,hS),s=hU(i);return cI(i,[("string"==typeof(t=(0,d.Ku)(t))||t instanceof hN?function(e,t,n,r,i,s){let a=e.ya(1,t,n),o=[hY(t,r,n)],l=[i];if(s.length%2!=0)throw new re(n7.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(hY(t,s[e])),l.push(s[e+1]);let u=[],h=iW.empty();for(let e=o.length-1;e>=0;--e)if(!h1(u,o[e])){let t=o[e],n=l[e];n=(0,d.Ku)(n);let r=a.da(t);if(n instanceof hq)u.push(t);else{let e=hH(n,r);null!=e&&(u.push(t),h.set(t,e))}}return new hL(h,new iw(u),a.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){let i=e.ya(1,t,n);hX("Data must be an object, but it was:",i,r);let s=[],a=iW.empty();return ih(r,(e,r)=>{let o=hZ(t,e,n);r=(0,d.Ku)(r);let l=i.da(o);if(r instanceof hq)s.push(o);else{let e=hH(r,l);null!=e&&(s.push(o),a.set(o,e))}}),new hL(a,new iw(s),i.fieldTransforms)}(s,"updateDoc",e._key,t)).toMutation(e._key,s1.exists(!0))])}function cw(e){return cI(hp(e.firestore,hS),[new an(e._key,s1.none())])}function cb(e,t){let n=hp(e.firestore,hS),r=hT(e),i=cu(e.converter,t);return cI(n,[hB(hU(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,s1.exists(!1))]).then(()=>r)}function cI(e,t){return function(e,t){let n=new rt;return e.asyncQueue.enqueueAndForget(async()=>uV(await hl(e).then(e=>e.syncEngine),t,n)),n.promise}(hC(e),t)}function cE(...e){return new hK("arrayUnion",e)}function cT(...e){return new hz("arrayRemove",e)}!function(e,t=!0){n1=h.MF,(0,h.om)(new c.uA("firestore",(e,{instanceIdentifier:n,options:r})=>{let i=e.getProvider("app").getImmediate(),s=new hS(new rs(e.getProvider("auth-internal")),new ru(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new re(n7.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new iN(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),(0,h.KO)(nZ,"3.13.0",void 0),(0,h.KO)(nZ,"3.13.0","esm2017")}()}},e=>{var t=t=>e(e.s=t);e.O(0,[593,792],()=>(t(6170),t(8767))),_N_E=e.O()}]);