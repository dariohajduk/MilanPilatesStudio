(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[944],{8320:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var t=a(6540),n=a(5150),i=a(9416),r=a(4848);let d=()=>{let[e,s]=(0,t.useState)({name:"",phone:"",isAdmin:!1,membership:"",remainingLessons:0,registeredLessons:[],completedLessons:0,joinDate:new Date().toISOString().split("T")[0]}),[a,d]=(0,t.useState)(""),[l,c]=(0,t.useState)(""),[o,m]=(0,t.useState)(""),[h,p]=(0,t.useState)(!1),[u,b]=(0,t.useState)(null),[x,g]=(0,t.useState)([])||{},{refreshUserData:w}=(0,i.J)()||{};(0,t.useEffect)(()=>{y()},[]);let y=async()=>{try{let e=await (0,n.hU)();g(e)}catch(e){j("שגיאה בטעינת המשתמשים")}},j=e=>{console.error(e),m(e)},f=async()=>{if(!e.name||!e.phone||!e.membership){j("אנא מלא את כל השדות החובה");return}try{await (0,n.nu)(e),g(s=>[...s,{id:e.phone,...e}]),p(!1),m(""),S()}catch(e){j("שגיאה בהוספת המשתמש")}},v=async()=>{if(!u.name||!u.phone||!u.membership){m("אנא מלא את כל השדות החובה");return}try{await (0,n.gw)(u.id,u),g(e=>e.map(e=>e.id===u.id?{...u}:e)),b(null),p(!1),m("")}catch(e){console.error("Error editing user:",e),m("שגיאה בעדכון המשתמש")}},N=async e=>{if(window.confirm("האם אתה בטוח שברצונך למחוק את המשתמש?"))try{await (0,n.hG)(e),g(s=>s.filter(s=>s.id!==e))}catch(e){j("שגיאה במחיקת המשתמש")}},S=()=>{s({name:"",phone:"",isAdmin:!1,membership:"",remainingLessons:0,registeredLessons:[],completedLessons:0,joinDate:new Date().toISOString().split("T")[0]})},L=x.filter(e=>(!a||e.name.includes(a)||e.phone.includes(a))&&(!l||e.membership===l));return(0,r.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4",children:[(0,r.jsx)("input",{type:"text",placeholder:"חפש לפי שם או טלפון",value:a,onChange:e=>d(e.target.value),className:"p-2 border rounded-lg w-full sm:w-1/2 mb-2 sm:mb-0"}),(0,r.jsx)("button",{onClick:()=>{S(),p(!0)},className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 mb-4 w-full sm:w-auto",children:"הוסף משתמש"})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:"רשימת משתמשים"}),(0,r.jsx)("ul",{className:"space-y-3",children:L.map(e=>(0,r.jsxs)("li",{className:"flex justify-between items-center p-3 rounded-md bg-gray-100",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:e.name}),(0,r.jsx)("p",{children:e.phone})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("button",{onClick:()=>{b(e),p(!0)},className:"bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-600",children:"ערוך"}),(0,r.jsx)("button",{onClick:()=>N(e.id),className:"bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600",children:"מחק"})]})]},e.id))})]}),h&&(0,r.jsx)("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center",children:(0,r.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-lg max-w-md w-full",children:[(0,r.jsx)("h2",{className:"text-lg font-bold mb-4",children:u?"ערוך משתמש":"הוסף משתמש"}),o&&(0,r.jsx)("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4",children:o}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("input",{type:"text",name:"name",placeholder:"שם מלא",value:u?u.name:e.name,onChange:e=>u?b(s=>({...s,name:e.target.value})):s(s=>({...s,name:e.target.value})),className:"w-full p-2 border rounded-md"}),(0,r.jsx)("input",{type:"tel",name:"phone",placeholder:"טלפון",value:u?u.phone:e.phone,onChange:e=>u?b(s=>({...s,phone:e.target.value})):s(s=>({...s,phone:e.target.value})),className:"w-full p-2 border rounded-md"}),(0,r.jsxs)("select",{name:"membership",value:u?u.membership:e.membership,onChange:e=>{let a=e.target.value;u?b(e=>({...e,membership:a})):s(e=>({...e,membership:a}))},className:"w-full p-2 border rounded-md",children:[(0,r.jsx)("option",{value:"",children:"בחר מנוי"}),(0,r.jsx)("option",{value:"כרטיסייה",children:"כרטיסייה"}),(0,r.jsx)("option",{value:"מנוי חודשי",children:"מנוי חודשי"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-2 rtl:space-x-reverse",children:[(0,r.jsx)("button",{onClick:()=>p(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-md",children:"ביטול"}),(0,r.jsx)("button",{onClick:u?v:f,className:"px-4 py-2 bg-green-500 text-white rounded-md",children:u?"שמור שינויים":"הוסף"})]})]})]})})]})}},5150:(e,s,a)=>{"use strict";a.d(s,{Nn:()=>d,R0:()=>c,Ry:()=>o,gw:()=>p,hG:()=>u,hU:()=>m,nu:()=>h,t9:()=>i,tI:()=>r,yo:()=>l});var t=a(6430),n=a(2942);let i=async e=>(await (0,t.GG)((0,t.rJ)(n.db,e))).docs.map(e=>({id:e.id,...e.data()})),r=async(e,s)=>({id:(await (0,t.gS)((0,t.rJ)(n.db,e),s)).id,...s}),d=async(e,s)=>{await (0,t.kd)((0,t.H9)(n.db,e,s))},l=async()=>(await (0,t.GG)((0,t.rJ)(n.db,"Lessons"))).docs.map(e=>({id:e.id,...e.data()})),c=async e=>{let s=(0,t.H9)(n.db,"Users",e),a=await (0,t.x7)(s);return a.exists()&&a.data().registeredLessons||[]},o=async(e,s,a)=>{let i=(0,t.H9)(n.db,"Lessons",e),r=(0,t.H9)(n.db,"Users",s.phone),d=a?{waitingList:(0,t.hq)(s.phone),registeredParticipants:(s.registeredParticipants||0)+1}:{waitingList:(0,t.C3)(s.phone),registeredParticipants:Math.max((s.registeredParticipants||0)-1,0)},l=a?{registeredLessons:(0,t.hq)({id:e,date:new Date().toISOString(),type:"Lesson Type"})}:{registeredLessons:(0,t.C3)({id:e,date:new Date().toISOString()})};await (0,t.mZ)(i,d),await (0,t.mZ)(r,l)},m=async()=>(await (0,t.GG)((0,t.rJ)(n.db,"Users"))).docs.map(e=>({id:e.id,...e.data()})),h=async e=>{let s=(0,t.H9)(n.db,"Users",e.phone);await (0,t.BN)(s,e)},p=async(e,s)=>{let a=(0,t.H9)(n.db,"Users",e);await (0,t.mZ)(a,s)},u=async e=>{let s=(0,t.H9)(n.db,"Users",e);await (0,t.kd)(s)}},4722:(e,s,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/UserManagement",function(){return a(8320)}])}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(4722)),_N_E=e.O()}]);