"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{8966:(e,s,t)=>{t.r(s),t.d(s,{default:()=>g});var a=t(6540),r=t(2942),l=t(6430),i=t(8916),n=t(5093),d=t.n(n),c=t(4731),o=t(155),m=t(8320),u=t(9767),x=t(2646);t(7154);var h=t(4848);let p=()=>{let[e,s]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{{s(window.innerWidth<=768);let e=()=>{s(window.innerWidth<=768)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}},[]),e},b={responsive:!0,plugins:{legend:{position:"top"}}},g=({setCurrentScreen:e})=>{let[s,t]=(0,a.useState)(null),[n,g]=(0,a.useState)(null),[j,f]=(0,a.useState)(null),[y,v]=(0,a.useState)(null),[w,N]=(0,a.useState)(!0),{setLogoUrl:S}=(0,i.x)(),[C,k]=(0,a.useState)("dashboard"),[L,E]=(0,a.useState)(!1),M=p();(0,a.useEffect)(()=>{P(),G(),O(),T(),D()},[]);let P=async()=>{try{let e=(await (0,l.GG)((0,l.rJ)(r.db,"Lessons"))).docs.map(e=>e.data()),s=d()().startOf("week"),a=d()().startOf("month"),i=0,n=0,c=0;e.forEach(e=>{let t=d()(`${e.date} ${e.time}`,"YYYY-MM-DD HH:mm");t.isSameOrAfter(s)&&(i+=e.registeredParticipants||0),t.isSameOrAfter(a)&&(n+=e.registeredParticipants||0),e.isActive&&c++}),t({activeLessons:c,weeklyRegistrations:i,monthlyRegistrations:n})}catch(e){console.error("Error loading stats:",e)}finally{N(!1)}},G=async()=>{try{let e=(await (0,l.GG)((0,l.rJ)(r.db,"Lessons"))).docs.map(e=>e.data()),s={};[void 0,void 0,void 0,void 0].map((e,s)=>d()().subtract(s,"months").format("MMMM")).reverse().forEach(e=>s[e]=0),e.forEach(e=>{let t=d()(e.date,"YYYY-MM-DD").format("MMMM");void 0!==s[t]&&(s[t]+=e.registeredParticipants||0)}),g({labels:Object.keys(s),datasets:[{label:"הרשמות חודשיות",data:Object.values(s),borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",tension:.1}]})}catch(e){console.error("Error loading chart data:",e)}},O=async()=>{try{let e=(await (0,l.GG)((0,l.rJ)(r.db,"Users"))).docs.map(e=>e.data()).reduce((e,s)=>{let t=s.type||s.subscriptionType||s.membershipType;return t&&(e[t]=(e[t]||0)+1),e},{});f({labels:Object.keys(e),datasets:[{label:"סוגי מנויים",data:Object.values(e),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)"],borderWidth:1}]})}catch(e){console.error("Error loading pie chart data:",e)}},T=async()=>{try{let e=(await (0,l.GG)((0,l.rJ)(r.db,"Users"))).docs.map(e=>e.data()),s={};[void 0,void 0,void 0,void 0].map((e,s)=>d()().subtract(s,"months").format("MMMM")).reverse().forEach(e=>s[e]=0),e.forEach(e=>{let t=d()(e.joinDate,"YYYY-MM-DD").format("MMMM");void 0!==s[t]&&s[t]++}),v({labels:Object.keys(s),datasets:[{label:"משתמשים חדשים",data:Object.values(s),backgroundColor:"rgba(54, 162, 235, 0.6)"}]})}catch(e){console.error("Error loading bar chart data:",e)}},D=async()=>{try{let e=(0,l.H9)(r.db,"StudioInfo","Logo"),s=await (0,l.x7)(e);s.exists()&&S(s.data()?.logoBase64)}catch(e){console.error("Error fetching logo:",e)}},J=async e=>{let s=e.target.files[0];if(s)try{let e=new FileReader;e.onloadend=async()=>{let s=e.result,t=(0,l.H9)(r.db,"StudioInfo","Logo");await (0,l.BN)(t,{logoBase64:s}),S(s)},e.readAsDataURL(s)}catch(e){console.error("Error uploading logo:",e),alert("אירעה שגיאה בהעלאת הלוגו")}},$=[{id:"dashboard",label:"לוח בקרה",icon:"\uD83D\uDCCA"},{id:"users",label:"ניהול משתמשים",icon:"\uD83D\uDC65"},{id:"lessons",label:"ניהול שיעורים",icon:"\uD83D\uDCC5"},{id:"manager",label:"ניהול מנהלים",icon:"⚙️"},{id:"tests",label:"ניהול בדיקות (Jest)",icon:"\uD83E\uDDEA"}];return(0,h.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,h.jsxs)("div",{className:"bg-white shadow-lg md:w-1/4 w-full md:block",children:[(0,h.jsx)("div",{className:"p-4 border-b",children:(0,h.jsx)("h1",{className:"text-xl font-bold",children:"ניהול מערכת"})}),M?(0,h.jsxs)("div",{className:"relative",children:[(0,h.jsxs)("button",{onClick:()=>E(!L),className:"flex items-center p-3 mx-auto w-full text-gray-600 bg-gray-50 rounded-lg shadow-md md:hidden",children:["תפריט",(0,h.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 ml-2 transition-transform ${L?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,h.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),L&&(0,h.jsx)("div",{className:"absolute w-full bg-white shadow-lg z-10 rounded-lg",children:$.map(e=>(0,h.jsxs)("button",{onClick:()=>{k(e.id),E(!1)},className:`flex items-center p-3 w-full text-left ${C===e.id?"bg-blue-50 text-blue-700":"text-gray-600 hover:bg-gray-50"}`,children:[(0,h.jsx)("span",{className:"mr-3",children:e.icon}),e.label]},e.id))})]}):(0,h.jsx)("nav",{className:"p-4 flex flex-col hidden md:block",children:$.map(e=>(0,h.jsxs)("button",{onClick:()=>k(e.id),className:`flex items-center p-3 rounded-lg transition-colors ${C===e.id?"bg-blue-50 text-blue-700":"text-gray-600 hover:bg-gray-50"}`,children:[(0,h.jsx)("span",{className:"mr-3",children:e.icon}),e.label]},e.id))})]}),(0,h.jsx)("div",{className:"flex-1 p-8 overflow-auto",children:(()=>{switch(C){case"dashboard":return(0,h.jsx)("div",{className:"space-y-3",children:(0,h.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-xl font-bold mb-4",children:"סטטיסטיקות מהירות"}),w?(0,h.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,h.jsx)("div",{className:"h- bg-gray-200 rounded"}),(0,h.jsx)("div",{className:"h-25 bg-gray-200 rounded"}),(0,h.jsx)("div",{className:"h-25 bg-gray-200 rounded"})]}):(0,h.jsxs)("div",{className:"space-y-4",children:[(0,h.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,h.jsx)("span",{className:"text-gray-600",children:"שיעורים פעילים"}),(0,h.jsx)("span",{className:"font-semibold",children:s?.activeLessons||0})]}),(0,h.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,h.jsx)("span",{className:"text-gray-600",children:"נרשמים השבוע"}),(0,h.jsx)("span",{className:"font-semibold",children:s?.weeklyRegistrations||0})]}),(0,h.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg",children:[(0,h.jsx)("span",{className:"text-gray-600",children:"נרשמים החודש"}),(0,h.jsx)("span",{className:"font-semibold",children:s?.monthlyRegistrations||0})]})]})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg p-2 shadow-sm",children:[(0,h.jsxs)("div",{className:"bg-white rounded-lg p-2 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-xl font-bold mb-1",children:"העלאת לוגו"}),(0,h.jsx)("input",{type:"file",onChange:J,accept:"image/*",className:"file:mr-4 file:py-2 file:px-4\r file:rounded-full file:border-0\r file:text-sm file:font-semibold\r file:bg-blue-50 file:text-blue-700\r hover:file:bg-blue-100"})]}),(0,h.jsx)("h2",{className:"text-xl font-bold mb-2",children:"מגמת הרשמות"}),(0,h.jsx)("div",{className:"w-full",children:n&&(0,h.jsx)(c.N1,{data:n,options:b})})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg p-1 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-xl font-bold mb-1",children:"התפלגות סוגי מנויים"}),(0,h.jsx)("div",{className:"h-64 w-64 mx-auto",children:j&&(0,h.jsx)(c.Fq,{data:j,options:b})})]}),(0,h.jsxs)("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[(0,h.jsx)("h2",{className:"text-xl font-bold mb-4",children:"משתמשים חדשים"}),(0,h.jsx)("div",{className:"h-full w-full mx-auto",children:y&&(0,h.jsx)(c.yP,{data:y,options:b})})]})]})});case"users":return(0,h.jsx)(m.default,{});case"lessons":return(0,h.jsx)(o.default,{});case"manager":return(0,h.jsx)(u.default,{});case"tests":return(0,h.jsx)(x.default,{});default:return null}})()})]})}},155:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var a=t(6540),r=t(2942),l=t(6430),i=t(4848);let n=(0,a.createContext)(),d=()=>(0,a.useContext)(n);var c=t(3909),o=t(5093),m=t.n(o);t(4924),(0,c.ye)(m());let u=()=>{let[e,s]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{{s(window.innerWidth<1024);let e=()=>s(window.innerWidth<1024);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}},[]),e},x=()=>{let{lessons:e=[],addLesson:s,removeLesson:t}=d()||{},[n,c]=(0,a.useState)([]),o=u(),[x,h]=(0,a.useState)(!1),[p,b]=(0,a.useState)({instructor:"",type:"",maxParticipants:0,date:"",time:""});(0,a.useEffect)(()=>{let t=!0;return(async()=>{try{let a=await (0,l.GG)((0,l.rJ)(r.db,"LessonTypes"));if(!t)return;c(a.docs.map(e=>({id:e.id,...e.data()})));let i=(0,l.rJ)(r.db,"Lessons"),n=await (0,l.GG)(i);if(!t)return;let d=n.docs.map(e=>({id:e.id,...e.data()})),o=e.map(e=>e.id);d.forEach(e=>{e.id&&!o.includes(e.id)&&s(e)})}catch(e){console.error("Error fetching data:",e)}})(),()=>{t=!1}},[e,s]);let g=async()=>{if(""===p.instructor.trim()||""===p.type.trim()||p.maxParticipants<=0||o&&(""===p.date||""===p.time)){alert("אנא מלא את כל השדות בטופס");return}let e={date:p.date,time:p.time,instructor:p.instructor,type:p.type,maxParticipants:p.maxParticipants.toString(),registeredParticipants:0,createdAt:m()().toISOString(),title:`${p.type} - ${p.instructor}`,isActive:m()(`${p.date}T${p.time}`).isAfter(m()()),waitingList:[]};try{let t=await (0,l.gS)((0,l.rJ)(r.db,"Lessons"),e);s({id:t.id,...e}),b({instructor:"",type:"",maxParticipants:0,date:"",time:""}),h(!1)}catch(e){console.error("Error adding lesson:",e),alert("אירעה שגיאה בהוספת השיעור")}};return(0,i.jsxs)("div",{className:"container mx-auto p-4",children:[(0,i.jsx)("h1",{className:"text-xl font-bold mb-4",children:"ניהול שיעורים"}),(0,i.jsx)("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-blue-500 text-white rounded-lg",children:"הוסף שיעור"}),x&&(0,i.jsx)("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-75 flex justify-center items-center",children:(0,i.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md w-full",children:[(0,i.jsx)("h2",{className:"text-lg font-bold mb-4",children:"הוסף שיעור"}),(0,i.jsx)("input",{type:"text",placeholder:"שם המדריך",value:p.instructor,onChange:e=>b({...p,instructor:e.target.value}),className:"w-full p-2 border rounded-lg mb-2",required:!0}),(0,i.jsxs)("select",{value:p.type,onChange:e=>b({...p,type:e.target.value}),className:"w-full p-2 border rounded-lg mb-2",children:[(0,i.jsx)("option",{value:"",disabled:!0,children:"בחר סוג שיעור"}),n.map(e=>(0,i.jsx)("option",{value:e.type,children:e.type},e.id))]}),(0,i.jsx)("input",{type:"number",placeholder:"מספר משתתפים מקסימלי",value:p.maxParticipants,onChange:e=>b({...p,maxParticipants:parseInt(e.target.value)||0}),className:"w-full p-2 border rounded-lg mb-2",min:"1",required:!0}),o&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"date",value:p.date,onChange:e=>b({...p,date:e.target.value}),className:"w-full p-2 border rounded-lg mb-2",required:!0}),(0,i.jsx)("input",{type:"time",value:p.time,onChange:e=>b({...p,time:e.target.value}),className:"w-full p-2 border rounded-lg mb-2",required:!0})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,i.jsx)("button",{onClick:()=>h(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-lg",children:"ביטול"}),(0,i.jsx)("button",{onClick:g,className:"px-4 py-2 bg-green-500 text-white rounded-lg",children:"הוסף"})]})]})})]})}},9767:(e,s,t)=>{t.r(s),t.d(s,{default:()=>n});var a=t(6540),r=t(5150),l=t(4848);let i=({items:e,onDelete:s})=>(0,l.jsx)("ul",{className:"mt-4 space-y-2",children:e.map(e=>(0,l.jsxs)("li",{className:"flex justify-between items-center border p-2 rounded",children:[(0,l.jsx)("span",{children:e.name}),(0,l.jsx)("button",{onClick:()=>s(e.id),className:"text-red-500",children:"מחק"})]},e.id))}),n=()=>{let[e,s]=(0,a.useState)([]),[t,n]=(0,a.useState)(""),[d,c]=(0,a.useState)([]),[o,m]=(0,a.useState)(""),[u,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)("");(0,a.useEffect)(()=>{b(),g()},[]);let b=async()=>{try{let e=await (0,r.t9)("LessonTypes");s(e)}catch(e){j(e)}},g=async()=>{try{let e=await (0,r.t9)("Memberships");c(e)}catch(e){j(e)}},j=e=>{console.error(e),p("אירעה שגיאה, נסו שוב מאוחר יותר.")},f=async()=>{if(!t.trim()){p("שם סוג שיעור אינו יכול להיות ריק.");return}x(!0);try{let a=await (0,r.tI)("LessonTypes",{name:t.trim()});s([...e,a]),n("")}catch(e){j(e)}finally{x(!1)}},y=async()=>{if(!o.trim()){p("שם מנוי אינו יכול להיות ריק.");return}x(!0);try{let e=await (0,r.tI)("Memberships",{name:o.trim()});c([...d,e]),m("")}catch(e){j(e)}finally{x(!1)}},v=async t=>{x(!0);try{await (0,r.Nn)("LessonTypes",t),s(e.filter(e=>e.id!==t))}catch(e){j(e)}finally{x(!1)}},w=async e=>{x(!0);try{await (0,r.Nn)("Memberships",e),c(d.filter(s=>s.id!==e))}catch(e){j(e)}finally{x(!1)}};return(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"ניהול סוגי שיעורים ומנויים"}),h&&(0,l.jsx)("div",{className:"bg-red-100 text-red-700 p-4 rounded-lg mb-4",children:h}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"ניהול סוגי שיעורים"}),(0,l.jsx)("input",{type:"text",value:t,onChange:e=>n(e.target.value),placeholder:"הוסף סוג שיעור חדש",className:"p-2 border rounded w-full"}),(0,l.jsx)("button",{onClick:f,disabled:u||!t.trim(),className:`bg-blue-500 text-white px-4 py-2 rounded mt-2 ${u?"opacity-50":""}`,children:u?"מוסיף...":"הוסף סוג שיעור"}),(0,l.jsx)(i,{items:e,onDelete:v})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"ניהול מנויים"}),(0,l.jsx)("input",{type:"text",value:o,onChange:e=>m(e.target.value),placeholder:"הוסף מנוי חדש",className:"p-2 border rounded w-full"}),(0,l.jsx)("button",{onClick:y,disabled:u||!o.trim(),className:`bg-green-500 text-white px-4 py-2 rounded mt-2 ${u?"opacity-50":""}`,children:u?"מוסיף...":"הוסף מנוי"}),(0,l.jsx)(i,{items:d,onDelete:w})]})]})}},2646:(e,s,t)=>{t.r(s),t.d(s,{default:()=>c});var a=t(6540),r=t(4848),l=t(7836);let i=e=>e.split(/(\\|\/)/).pop(),n=({passed:e,failed:s,total:t})=>(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg text-center",children:[(0,r.jsx)("div",{className:"text-lg font-bold",children:t}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:'סה"כ בדיקות'})]}),(0,r.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg text-center",children:[(0,r.jsx)("div",{className:"text-lg font-bold text-green-700",children:e}),(0,r.jsx)("div",{className:"text-sm text-green-600",children:"עברו"})]}),(0,r.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg text-center",children:[(0,r.jsx)("div",{className:"text-lg font-bold text-red-700",children:s}),(0,r.jsx)("div",{className:"text-sm text-red-600",children:"נכשלו"})]})]}),d=({suite:e})=>{let s="passed"===e.status;return(0,r.jsxs)("div",{className:"border rounded-lg p-4 mb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsx)("h3",{className:"font-bold",children:i(e.name)}),(0,r.jsx)("span",{className:`px-2 py-1 text-sm rounded-full ${s?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s?"עבר":"נכשל"})]}),e.assertionResults?.map((e,s)=>r.jsxs("div",{className:`border-l-4 pl-3 py-2 mb-2 ${"passed"===e.status?"border-green-500 bg-green-50":"border-red-500 bg-red-50"}`,children:[r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:`w-3 h-3 rounded-full mr-2 ${"passed"===e.status?"bg-green-500":"bg-red-500"}`}),r.jsx("span",{children:e.title})]}),"failed"===e.status&&e.failureMessages?.map((e,s)=>r.jsx("div",{className:"mt-2 text-sm text-red-600 bg-red-50 p-2 rounded",children:e.split("\n")[0]},s))]},s))]})},c=()=>{let[e,s]=(0,a.useState)(null),[t,i]=(0,a.useState)(!1),[c,o]=(0,a.useState)(null);l.env.REACT_APP_API_URL;let m=async()=>{i(!0),o(null),s(null);try{let e;let t=await fetch("api/tests/run-tests",{method:"POST",headers:{"Content-Type":"application/json"}}),a=await t.text();try{e=a?JSON.parse(a):{}}catch(e){throw Error("Invalid JSON response from server")}if(!t.ok)throw Error(e.details||e.error||"Server error occurred");console.log("Received test results:",e),s(e)}catch(e){console.error("Test run error:",e),o(`Error running tests: ${e.message}`)}finally{i(!1)}};return(0,r.jsxs)("div",{className:"relative min-h-screen",children:[(0,r.jsx)("div",{className:"sticky top-0 bg-white shadow-md z-50 p-4 border-b",children:(0,r.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"ניהול בדיקות (Jest)"}),(0,r.jsx)("button",{onClick:m,disabled:t,className:`px-4 py-2 rounded-lg ${t?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"} text-white transition-colors`,children:t?"מריץ בדיקות...":"הרץ בדיקות"})]})}),(0,r.jsxs)("div",{className:"container mx-auto p-4",children:[t&&(0,r.jsxs)("div",{className:"flex justify-center items-center p-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),(0,r.jsx)("span",{className:"mr-3",children:"טוען בדיקות..."})]}),c&&(0,r.jsx)("div",{className:"bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6",children:(0,r.jsx)("div",{className:"flex",children:(0,r.jsxs)("div",{className:"mr-3",children:[(0,r.jsx)("p",{className:"font-bold",children:"שגיאה בהרצת הבדיקות"}),(0,r.jsx)("p",{className:"text-sm",children:c})]})})}),!t&&!c&&e&&(0,r.jsxs)("div",{children:[(0,r.jsx)(n,{...e?{total:e.numTotalTests||0,passed:e.numPassedTests||0,failed:e.numFailedTests||0}:{total:0,passed:0,failed:0}}),(0,r.jsx)("div",{className:"space-y-4",children:e.testResults?.map((e,s)=>r.jsx(d,{suite:e},s))})]}),!t&&!c&&!e&&(0,r.jsx)("div",{className:"text-center text-gray-500 p-8",children:(0,r.jsx)("p",{className:"text-lg",children:'לחץ על "הרץ בדיקות" כדי להתחיל'})})]})]})}},8320:(e,s,t)=>{t.r(s),t.d(s,{default:()=>n});var a=t(6540),r=t(5150),l=t(9416),i=t(4848);let n=()=>{let[e,s]=(0,a.useState)({name:"",phone:"",isAdmin:!1,membership:"",remainingLessons:0,registeredLessons:[],completedLessons:0,joinDate:new Date().toISOString().split("T")[0]}),[t,n]=(0,a.useState)(""),[d,c]=(0,a.useState)(""),[o,m]=(0,a.useState)(""),[u,x]=(0,a.useState)(!1),[h,p]=(0,a.useState)(null),[b,g]=(0,a.useState)([])||{},{refreshUserData:j}=(0,l.J)()||{};(0,a.useEffect)(()=>{f()},[]);let f=async()=>{try{let e=await (0,r.hU)();g(e)}catch(e){y("שגיאה בטעינת המשתמשים")}},y=e=>{console.error(e),m(e)},v=async()=>{if(!e.name||!e.phone||!e.membership){y("אנא מלא את כל השדות החובה");return}try{await (0,r.nu)(e),g(s=>[...s,{id:e.phone,...e}]),x(!1),m(""),S()}catch(e){y("שגיאה בהוספת המשתמש")}},w=async()=>{if(!h.name||!h.phone||!h.membership){m("אנא מלא את כל השדות החובה");return}try{await (0,r.gw)(h.id,h),g(e=>e.map(e=>e.id===h.id?{...h}:e)),p(null),x(!1),m("")}catch(e){console.error("Error editing user:",e),m("שגיאה בעדכון המשתמש")}},N=async e=>{if(window.confirm("האם אתה בטוח שברצונך למחוק את המשתמש?"))try{await (0,r.hG)(e),g(s=>s.filter(s=>s.id!==e))}catch(e){y("שגיאה במחיקת המשתמש")}},S=()=>{s({name:"",phone:"",isAdmin:!1,membership:"",remainingLessons:0,registeredLessons:[],completedLessons:0,joinDate:new Date().toISOString().split("T")[0]})},C=b.filter(e=>(!t||e.name.includes(t)||e.phone.includes(t))&&(!d||e.membership===d));return(0,i.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6",children:[(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-4",children:[(0,i.jsx)("input",{type:"text",placeholder:"חפש לפי שם או טלפון",value:t,onChange:e=>n(e.target.value),className:"p-2 border rounded-lg w-full sm:w-1/2 mb-2 sm:mb-0"}),(0,i.jsx)("button",{onClick:()=>{S(),x(!0)},className:"bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 mb-4 w-full sm:w-auto",children:"הוסף משתמש"})]}),(0,i.jsxs)("div",{className:"bg-white rounded-lg p-4 shadow-sm",children:[(0,i.jsx)("h2",{className:"text-lg font-bold mb-4",children:"רשימת משתמשים"}),(0,i.jsx)("ul",{className:"space-y-3",children:C.map(e=>(0,i.jsxs)("li",{className:"flex justify-between items-center p-3 rounded-md bg-gray-100",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{children:e.name}),(0,i.jsx)("p",{children:e.phone})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("button",{onClick:()=>{p(e),x(!0)},className:"bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-600",children:"ערוך"}),(0,i.jsx)("button",{onClick:()=>N(e.id),className:"bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600",children:"מחק"})]})]},e.id))})]}),u&&(0,i.jsx)("div",{className:"fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center",children:(0,i.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-lg max-w-md w-full",children:[(0,i.jsx)("h2",{className:"text-lg font-bold mb-4",children:h?"ערוך משתמש":"הוסף משתמש"}),o&&(0,i.jsx)("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-4",children:o}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsx)("input",{type:"text",name:"name",placeholder:"שם מלא",value:h?h.name:e.name,onChange:e=>h?p(s=>({...s,name:e.target.value})):s(s=>({...s,name:e.target.value})),className:"w-full p-2 border rounded-md"}),(0,i.jsx)("input",{type:"tel",name:"phone",placeholder:"טלפון",value:h?h.phone:e.phone,onChange:e=>h?p(s=>({...s,phone:e.target.value})):s(s=>({...s,phone:e.target.value})),className:"w-full p-2 border rounded-md"}),(0,i.jsxs)("select",{name:"membership",value:h?h.membership:e.membership,onChange:e=>{let t=e.target.value;h?p(e=>({...e,membership:t})):s(e=>({...e,membership:t}))},className:"w-full p-2 border rounded-md",children:[(0,i.jsx)("option",{value:"",children:"בחר מנוי"}),(0,i.jsx)("option",{value:"כרטיסייה",children:"כרטיסייה"}),(0,i.jsx)("option",{value:"מנוי חודשי",children:"מנוי חודשי"})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-2 rtl:space-x-reverse",children:[(0,i.jsx)("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-md",children:"ביטול"}),(0,i.jsx)("button",{onClick:h?w:v,className:"px-4 py-2 bg-green-500 text-white rounded-md",children:h?"שמור שינויים":"הוסף"})]})]})]})})]})}},5150:(e,s,t)=>{t.d(s,{Nn:()=>n,R0:()=>c,Ry:()=>o,gw:()=>x,hG:()=>h,hU:()=>m,nu:()=>u,t9:()=>l,tI:()=>i,yo:()=>d});var a=t(6430),r=t(2942);let l=async e=>(await (0,a.GG)((0,a.rJ)(r.db,e))).docs.map(e=>({id:e.id,...e.data()})),i=async(e,s)=>({id:(await (0,a.gS)((0,a.rJ)(r.db,e),s)).id,...s}),n=async(e,s)=>{await (0,a.kd)((0,a.H9)(r.db,e,s))},d=async()=>(await (0,a.GG)((0,a.rJ)(r.db,"Lessons"))).docs.map(e=>({id:e.id,...e.data()})),c=async e=>{let s=(0,a.H9)(r.db,"Users",e),t=await (0,a.x7)(s);return t.exists()&&t.data().registeredLessons||[]},o=async(e,s,t)=>{let l=(0,a.H9)(r.db,"Lessons",e),i=(0,a.H9)(r.db,"Users",s.phone),n=t?{waitingList:(0,a.hq)(s.phone),registeredParticipants:(s.registeredParticipants||0)+1}:{waitingList:(0,a.C3)(s.phone),registeredParticipants:Math.max((s.registeredParticipants||0)-1,0)},d=t?{registeredLessons:(0,a.hq)({id:e,date:new Date().toISOString(),type:"Lesson Type"})}:{registeredLessons:(0,a.C3)({id:e,date:new Date().toISOString()})};await (0,a.mZ)(l,n),await (0,a.mZ)(i,d)},m=async()=>(await (0,a.GG)((0,a.rJ)(r.db,"Users"))).docs.map(e=>({id:e.id,...e.data()})),u=async e=>{let s=(0,a.H9)(r.db,"Users",e.phone);await (0,a.BN)(s,e)},x=async(e,s)=>{let t=(0,a.H9)(r.db,"Users",e);await (0,a.mZ)(t,s)},h=async e=>{let s=(0,a.H9)(r.db,"Users",e);await (0,a.kd)(s)}}}]);